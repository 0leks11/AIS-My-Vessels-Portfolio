import{_ as ha}from"./main-17f2d9e3.js";import{g as ot,a as Br,r as cc,w as fo,s as js,h as ye,m as we,l as qt,t as uc,c as ae,u as at,v as go,x as dc,y as Wr,z as ul,A as Bn,B as Kt,C as $e,D as fc,E as vn,F as gc,G as dl,H as _o,I as _c,i as je,J as hn,K as mc,L as mo,N as pc,O as it,P as cn,q as di,Q as po,R as yc,S as zr,T as Yr,U as Ur,V as fl,W as jr,M as gl,X as xc,Y as fi,Z as vc,_ as Wn,$ as _l,a0 as Ec,a1 as ws,e as Ts,a2 as ml,o as yo,a3 as Cc,a4 as wc,a5 as Xs,d as Hs,a6 as pl,a7 as yl,a8 as xl,a9 as ps,aa as vl,ab as Tc,ac as Rc,ad as Sc,ae as Ic,af as Xr,ag as El,p as bc,ah as Hr,ai as Mc,aj as Dc,ak as ca,f as Cl}from"./proj-20c50701.js";import{no_db_limit as ua,debug as zn,database_hostname as Lc,database_port as Ac,use_bingmaps as lr}from"./constants-36dce06f.js";class Pc{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Pt=Pc,Yn={PROPERTYCHANGE:"propertychange"};class Fc{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const Vs=Fc;function Oc(s,e,t){let n,i;t=t||yn;let r=0,o=s.length,a=!1;for(;r<o;)n=r+(o-r>>1),i=+t(s[n],e),i<0?r=n+1:(o=n,a=!i);return a?r:~r}function yn(s,e){return s>e?1:s<e?-1:0}function wl(s,e,t){if(s[0]<=e)return 0;const n=s.length;if(e<=s[n-1])return n-1;if(typeof t=="function"){for(let i=1;i<n;++i){const r=s[i];if(r===e)return i;if(r<e)return t(e,s[i-1],r)>0?i-1:i}return n-1}if(t>0){for(let i=1;i<n;++i)if(s[i]<e)return i-1;return n-1}if(t<0){for(let i=1;i<n;++i)if(s[i]<=e)return i;return n-1}for(let i=1;i<n;++i){if(s[i]==e)return i;if(s[i]<e)return s[i-1]-e<e-s[i]?i-1:i}return n-1}function kc(s,e,t){for(;e<t;){const n=s[e];s[e]=s[t],s[t]=n,++e,--t}}function Lt(s,e){const t=Array.isArray(e)?e:[e],n=t.length;for(let i=0;i<n;i++)s[s.length]=t[i]}function Ft(s,e){const t=s.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(s[n]!==e[n])return!1;return!0}function Am(s,e,t){const n=e||yn;return s.every(function(i,r){if(r===0)return!0;const o=n(s[r-1],i);return!(o>0||t&&o===0)})}function Un(){return!0}function Kn(){return!1}function jn(){}function Nc(s){let e=!1,t,n,i;return function(){const r=Array.prototype.slice.call(arguments);return(!e||this!==i||!Ft(r,n))&&(e=!0,i=this,n=r,t=s.apply(this,arguments)),t}}function $n(s){for(const e in s)delete s[e]}function Xn(s){let e;for(e in s)return!1;return!e}class Gc extends Vs{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),i=n[e]||(n[e]=[]);i.includes(t)||i.push(t)}dispatchEvent(e){const t=typeof e=="string",n=t?e:e.type,i=this.listeners_&&this.listeners_[n];if(!i)return;const r=t?new Pt(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=i.length;h<c;++h)if("handleEvent"in i[h]?l=i[h].handleEvent(r):l=i[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,jn);delete o[n]}return l}disposeInternal(){this.listeners_&&$n(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){const n=this.listeners_&&this.listeners_[e];if(n){const i=n.indexOf(t);i!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[i]=jn,++this.pendingRemovals_[e]):(n.splice(i,1),n.length===0&&delete this.listeners_[e]))}}}const Zs=Gc,Z={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function K(s,e,t,n,i){if(n&&n!==s&&(t=t.bind(n)),i){const o=t;t=function(){s.removeEventListener(e,t),o.apply(this,arguments)}}const r={target:s,type:e,listener:t};return s.addEventListener(e,t),r}function Rs(s,e,t,n){return K(s,e,t,n,!0)}function he(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),$n(s))}class Ks extends Zs{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Z.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,i=new Array(n);for(let r=0;r<n;++r)i[r]=K(this,e[r],t);return i}return K(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const i=e.length;n=new Array(i);for(let r=0;r<i;++r)n[r]=Rs(this,e[r],t)}else n=Rs(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)Bc(n);else if(Array.isArray(e))for(let i=0,r=e.length;i<r;++i)this.removeEventListener(e[i],t);else this.removeEventListener(e,t)}}Ks.prototype.on;Ks.prototype.once;Ks.prototype.un;function Bc(s){if(Array.isArray(s))for(let e=0,t=s.length;e<t;++e)he(s[e]);else he(s)}const Tl=Ks;function X(){throw new Error("Unimplemented abstract method.")}let Wc=0;function q(s){return s.ol_uid||(s.ol_uid=String(++Wc))}class da extends Pt{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}class zc extends Tl{constructor(e){super(),this.on,this.once,this.un,q(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new da(n,e,t)),n=Yn.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new da(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const i=this.values_||(this.values_={});if(n)i[e]=t;else{const r=i[e];i[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],Xn(this.values_)&&(this.values_=null),t||this.notify(e,n)}}}const ht=zc,It={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Jt=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Yc=Jt.includes("firefox"),Uc=Jt.includes("safari")&&!Jt.includes("chrom"),jc=Uc&&(Jt.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Jt)),Xc=Jt.includes("webkit")&&!Jt.includes("edge"),Hc=Jt.includes("macintosh"),Rl=typeof devicePixelRatio<"u"?devicePixelRatio:1,xo=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Vc=typeof Image<"u"&&Image.prototype.decode,Sl=function(){let s=!1;try{const e=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return s}();function Le(s,e,t,n){let i;return t&&t.length?i=t.shift():xo?i=new OffscreenCanvas(s||300,e||300):i=document.createElement("canvas"),s&&(i.width=s),e&&(i.height=e),i.getContext("2d",n)}function $s(s){const e=s.canvas;e.width=1,e.height=1,s.clearRect(0,0,1,1)}function Zc(s){let e=s.offsetWidth;const t=getComputedStyle(s);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function Kc(s){let e=s.offsetHeight;const t=getComputedStyle(s);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function fa(s,e){const t=e.parentNode;t&&t.replaceChild(s,e)}function Ss(s){return s&&s.parentNode?s.parentNode.removeChild(s):null}function Il(s){for(;s.lastChild;)s.removeChild(s.lastChild)}function $c(s,e){const t=s.childNodes;for(let n=0;;++n){const i=t[n],r=e[n];if(!i&&!r)break;if(i!==r){if(!i){s.appendChild(r);continue}if(!r){s.removeChild(i),--n;continue}s.insertBefore(r,i)}}}class qc extends ht{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){Ss(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&Ss(this.element);for(let t=0,n=this.listenerKeys.length;t<n;++t)he(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==jn&&this.listenerKeys.push(K(e,It.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}const Bi=qc,xi={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},hr="projection",ga="coordinateFormat";class Jc extends Bi{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(hr,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(ga)}getProjection(){return this.get(hr)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(K(t,xi.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(K(t,xi.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(ga,e)}setProjection(e){this.set(hr,ot(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const r=this.getProjection();r?this.transform_=Br(this.mapProjection_,r):this.transform_=cc}const i=this.getMap().getCoordinateFromPixelInternal(e);if(i){const r=js();if(r&&(this.transform_=Br(this.mapProjection_,r)),this.transform_(i,i),this.wrapX_){const a=r||this.getProjection()||this.mapProjection_;fo(i,a)}const o=this.getCoordinateFormat();o?t=o(i):t=i.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}const Qc=Jc,Ce={ANIMATING:0,INTERACTING:1},tt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},Pm=42,eu=256;function _a(s,e,t){return function(n,i,r,o,a){if(!n)return;if(!i&&!e)return n;const l=e?0:r[0]*i,h=e?0:r[1]*i,c=a?a[0]:0,u=a?a[1]:0;let d=s[0]+l/2+c,f=s[2]-l/2+c,_=s[1]+h/2+u,p=s[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),_>p&&(_=(p+_)/2,p=_);let y=ye(n[0],d,f),E=ye(n[1],_,p);if(o&&t&&i){const w=30*i;y+=-w*Math.log(1+Math.max(0,d-n[0])/w)+w*Math.log(1+Math.max(0,n[0]-f)/w),E+=-w*Math.log(1+Math.max(0,_-n[1])/w)+w*Math.log(1+Math.max(0,n[1]-p)/w)}return[y,E]}}function tu(s){return s}function vo(s,e,t,n){const i=we(e)/t[0],r=qt(e)/t[1];return n?Math.min(s,Math.max(i,r)):Math.min(s,Math.min(i,r))}function Eo(s,e,t){let n=Math.min(s,e);const i=50;return n*=Math.log(1+i*Math.max(0,s/e-1))/i+1,t&&(n=Math.max(n,t),n/=Math.log(1+i*Math.max(0,t/s-1))/i+1),ye(n,t/2,e*2)}function nu(s,e,t,n){return e=e!==void 0?e:!0,function(i,r,o,a){if(i!==void 0){const l=s[0],h=s[s.length-1],c=t?vo(l,t,o,n):l;if(a)return e?Eo(i,c,h):ye(i,h,c);const u=Math.min(c,i),d=Math.floor(wl(s,u,r));return s[d]>c&&d<s.length-1?s[d+1]:s[d]}}}function iu(s,e,t,n,i,r){return n=n!==void 0?n:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=i?vo(e,i,l,r):e;if(h)return n?Eo(o,c,t):ye(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(s)-u),f=-a*(.5-u)+.5,_=Math.min(c,o),p=Math.floor(Math.log(e/_)/Math.log(s)+f),y=Math.max(d,p),E=e/Math.pow(s,y);return ye(E,t,c)}}}function ma(s,e,t,n,i){return t=t!==void 0?t:!0,function(r,o,a,l){if(r!==void 0){const h=n?vo(s,n,a,i):s;return!t||!l?ye(r,e,h):Eo(r,h,e)}}}function Co(s){if(s!==void 0)return 0}function pa(s){if(s!==void 0)return s}function su(s){const e=2*Math.PI/s;return function(t,n){if(n)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function ru(s){return s=s||uc(5),function(e,t){if(t)return e;if(e!==void 0)return Math.abs(e)<=s?0:e}}function bl(s){return Math.pow(s,3)}function qn(s){return 1-bl(1-s)}function ou(s){return 3*s*s-2*s*s*s}function au(s){return s}const wo=new Array(6);function Se(){return[1,0,0,1,0,0]}function ya(s){return Wi(s,1,0,0,1,0,0)}function vi(s,e){const t=s[0],n=s[1],i=s[2],r=s[3],o=s[4],a=s[5],l=e[0],h=e[1],c=e[2],u=e[3],d=e[4],f=e[5];return s[0]=t*l+i*h,s[1]=n*l+r*h,s[2]=t*c+i*u,s[3]=n*c+r*u,s[4]=t*d+i*f+o,s[5]=n*d+r*f+a,s}function Wi(s,e,t,n,i,r,o){return s[0]=e,s[1]=t,s[2]=n,s[3]=i,s[4]=r,s[5]=o,s}function lu(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s}function xe(s,e){const t=e[0],n=e[1];return e[0]=s[0]*t+s[2]*n+s[4],e[1]=s[1]*t+s[3]*n+s[5],e}function hu(s,e){const t=Math.cos(e),n=Math.sin(e);return vi(s,Wi(wo,t,n,-n,t,0,0))}function cu(s,e,t){return vi(s,Wi(wo,e,0,0,t,0,0))}function uu(s,e,t){return Wi(s,e,0,0,t,0,0)}function xa(s,e,t){return vi(s,Wi(wo,1,0,0,1,e,t))}function vt(s,e,t,n,i,r,o,a){const l=Math.sin(r),h=Math.cos(r);return s[0]=n*h,s[1]=i*l,s[2]=-n*l,s[3]=i*h,s[4]=o*n*h-a*n*l+e,s[5]=o*i*l+a*i*h+t,s}function qs(s,e){const t=du(e);ae(t!==0,32);const n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],l=e[5];return s[0]=o/t,s[1]=-i/t,s[2]=-r/t,s[3]=n/t,s[4]=(r*l-o*a)/t,s[5]=-(n*l-i*a)/t,s}function du(s){return s[0]*s[3]-s[1]*s[2]}let va;function Ml(s){const e="matrix("+s.join(", ")+")";if(xo)return e;const t=va||(va=document.createElement("div"));return t.style.transform=e,t.style.transform}function _n(s,e,t,n,i,r){r=r||[];let o=0;for(let a=e;a<t;a+=n){const l=s[a],h=s[a+1];r[o++]=i[0]*l+i[2]*h+i[4],r[o++]=i[1]*l+i[3]*h+i[5]}return r&&r.length!=o&&(r.length=o),r}function To(s,e,t,n,i,r,o){o=o||[];const a=Math.cos(i),l=Math.sin(i),h=r[0],c=r[1];let u=0;for(let d=e;d<t;d+=n){const f=s[d]-h,_=s[d+1]-c;o[u++]=h+f*a-_*l,o[u++]=c+f*l+_*a;for(let p=d+2;p<d+n;++p)o[u++]=s[p]}return o&&o.length!=u&&(o.length=u),o}function fu(s,e,t,n,i,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=n){const d=s[u]-l,f=s[u+1]-h;a[c++]=l+i*d,a[c++]=h+r*f;for(let _=u+2;_<u+n;++_)a[c++]=s[_]}return a&&a.length!=c&&(a.length=c),a}function gu(s,e,t,n,i,r,o){o=o||[];let a=0;for(let l=e;l<t;l+=n){o[a++]=s[l]+i,o[a++]=s[l+1]+r;for(let h=l+2;h<l+n;++h)o[a++]=s[h]}return o&&o.length!=a&&(o.length=a),o}const Ea=Se();class _u extends ht{constructor(){super(),this.extent_=at(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Nc(function(e,t,n){if(!n)return this.getSimplifiedGeometry(t);const i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return X()}closestPointXY(e,t,n,i){return X()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return X()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&go(t),this.extentRevision_=this.getRevision()}return dc(this.extent_,e)}rotate(e,t){X()}scale(e,t,n){X()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return X()}getType(){return X()}applyTransform(e){X()}intersectsExtent(e){return X()}translate(e,t){X()}transform(e,t){const n=ot(e),i=n.getUnits()=="tile-pixels"?function(r,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=qt(h)/qt(l);return vt(Ea,h[0],h[3],c,-c,0,0,0),_n(r,0,r.length,a,Ea,o),Wr(n,t)(r,o,a)}:Wr(n,t);return this.applyTransform(i),this}}const Dl=_u;class mu extends Dl{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(e){return ul(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return X()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Is(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){X()}setLayout(e,t,n){let i;if(e)i=Is(e);else{for(let r=0;r<n;++r){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}i=t.length,e=pu(i)}this.layout=e,this.stride=i}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const i=this.getStride();To(n,0,n.length,i,e,t,n),this.changed()}}scale(e,t,n){t===void 0&&(t=e),n||(n=Bn(this.getExtent()));const i=this.getFlatCoordinates();if(i){const r=this.getStride();fu(i,0,i.length,r,e,t,n,i),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const i=this.getStride();gu(n,0,n.length,i,e,t,n),this.changed()}}}function pu(s){let e;return s==2?e="XY":s==3?e="XYZ":s==4&&(e="XYZM"),e}function Is(s){let e;return s=="XY"?e=2:s=="XYZ"||s=="XYM"?e=3:s=="XYZM"&&(e=4),e}function yu(s,e,t){const n=s.getFlatCoordinates();if(!n)return null;const i=s.getStride();return _n(n,0,n.length,i,e,t)}const Qt=mu;function Ca(s,e,t,n,i,r,o){const a=s[e],l=s[e+1],h=s[t]-a,c=s[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((i-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let f=0;f<n;++f)o[f]=$e(s[e+f],s[t+f],d);o.length=n;return}else u=e}for(let d=0;d<n;++d)o[d]=s[u+d];o.length=n}function Ro(s,e,t,n,i){let r=s[e],o=s[e+1];for(e+=n;e<t;e+=n){const a=s[e],l=s[e+1],h=Kt(r,o,a,l);h>i&&(i=h),r=a,o=l}return i}function So(s,e,t,n,i){for(let r=0,o=t.length;r<o;++r){const a=t[r];i=Ro(s,e,a,n,i),e=a}return i}function xu(s,e,t,n,i){for(let r=0,o=t.length;r<o;++r){const a=t[r];i=So(s,e,a,n,i),e=a[a.length-1]}return i}function Io(s,e,t,n,i,r,o,a,l,h,c){if(e==t)return h;let u,d;if(i===0){if(d=Kt(o,a,s[e],s[e+1]),d<h){for(u=0;u<n;++u)l[u]=s[e+u];return l.length=n,d}return h}c=c||[NaN,NaN];let f=e+n;for(;f<t;)if(Ca(s,f-n,f,n,o,a,c),d=Kt(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/i|0,1);if(r&&(Ca(s,t-n,e,n,o,a,c),d=Kt(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function bo(s,e,t,n,i,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=Io(s,e,f,n,i,r,o,a,l,h,c),e=f}return h}function vu(s,e,t,n,i,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=bo(s,e,f,n,i,r,o,a,l,h,c),e=f[f.length-1]}return h}function Ll(s,e,t,n){for(let i=0,r=t.length;i<r;++i)s[e++]=t[i];return e}function Js(s,e,t,n){for(let i=0,r=t.length;i<r;++i){const o=t[i];for(let a=0;a<n;++a)s[e++]=o[a]}return e}function Mo(s,e,t,n,i){i=i||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=Js(s,e,t[o],n);i[r++]=l,e=l}return i.length=r,i}function Eu(s,e,t,n,i){i=i||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=Mo(s,e,t[o],n,i[r]);l.length===0&&(l[0]=e),i[r++]=l,e=l[l.length-1]}return i.length=r,i}function Do(s,e,t,n,i,r,o){const a=(t-e)/n;if(a<3){for(;e<t;e+=n)r[o++]=s[e],r[o++]=s[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const _=s[d],p=s[d+1],y=s[u],E=s[u+1];for(let w=d+n;w<u;w+=n){const v=s[w],C=s[w+1],R=fc(v,C,_,p,y,E);R>f&&(c=w,f=R)}f>i&&(l[(c-e)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=s[e+u*n],r[o++]=s[e+u*n+1]);return o}function Cu(s,e,t,n,i,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=Do(s,e,c,n,i,r,o),a.push(o),e=c}return o}function an(s,e){return e*Math.round(s/e)}function wu(s,e,t,n,i,r,o){if(e==t)return o;let a=an(s[e],i),l=an(s[e+1],i);e+=n,r[o++]=a,r[o++]=l;let h,c;do if(h=an(s[e],i),c=an(s[e+1],i),e+=n,e==t)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=an(s[e],i),d=an(s[e+1],i);if(e+=n,u==h&&d==c)continue;const f=h-a,_=c-l,p=u-a,y=d-l;if(f*y==_*p&&(f<0&&p<f||f==p||f>0&&p>f)&&(_<0&&y<_||_==y||_>0&&y>_)){h=u,c=d;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=d}return r[o++]=h,r[o++]=c,o}function Al(s,e,t,n,i,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=wu(s,e,c,n,i,r,o),a.push(o),e=c}return o}function Tu(s,e,t,n,i,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l],u=[];o=Al(s,e,c,n,i,r,o,u),a.push(u),e=c[c.length-1]}return o}function Ht(s,e,t,n,i){i=i!==void 0?i:[];let r=0;for(let o=e;o<t;o+=n)i[r++]=s.slice(o,o+n);return i.length=r,i}function Ei(s,e,t,n,i){i=i!==void 0?i:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];i[r++]=Ht(s,e,l,n,i[r]),e=l}return i.length=r,i}function Vr(s,e,t,n,i){i=i!==void 0?i:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];i[r++]=l.length===1&&l[0]===e?[]:Ei(s,e,l,n,i[r]),e=l[l.length-1]}return i.length=r,i}function Pl(s,e,t,n){let i=0,r=s[t-n],o=s[t-n+1];for(;e<t;e+=n){const a=s[e],l=s[e+1];i+=o*a-r*l,r=a,o=l}return i/2}function Fl(s,e,t,n){let i=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];i+=Pl(s,e,a,n),e=a}return i}function Ru(s,e,t,n){let i=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];i+=Fl(s,e,a,n),e=a[a.length-1]}return i}class bs extends Qt{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new bs(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,i){return i<vn(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ro(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Io(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,i))}getArea(){return Pl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Ht(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=Do(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new bs(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Js(this.flatCoordinates,0,e,this.stride),this.changed()}}const wa=bs;class Lo extends Qt{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Lo(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,i){const r=this.flatCoordinates,o=Kt(e,t,r[0],r[1]);if(o<i){const a=this.stride;for(let l=0;l<a;++l)n[l]=r[l];return n.length=a,o}return i}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(e){return gc(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return dl(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ll(this.flatCoordinates,0,e,this.stride),this.changed()}}const $t=Lo;function Su(s,e,t,n,i){return!_o(i,function(o){return!un(s,e,t,n,o[0],o[1])})}function un(s,e,t,n,i,r){let o=0,a=s[t-n],l=s[t-n+1];for(;e<t;e+=n){const h=s[e],c=s[e+1];l<=r?c>r&&(h-a)*(r-l)-(i-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(i-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Ao(s,e,t,n,i,r){if(t.length===0||!un(s,e,t[0],n,i,r))return!1;for(let o=1,a=t.length;o<a;++o)if(un(s,t[o-1],t[o],n,i,r))return!1;return!0}function Iu(s,e,t,n,i,r){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(Ao(s,e,l,n,i,r))return!0;e=l[l.length-1]}return!1}function Ol(s,e,t,n,i,r,o){let a,l,h,c,u,d,f;const _=i[r+1],p=[];for(let w=0,v=t.length;w<v;++w){const C=t[w];for(c=s[C-n],d=s[C-n+1],a=e;a<C;a+=n)u=s[a],f=s[a+1],(_<=d&&f<=_||d<=_&&_<=f)&&(h=(_-d)/(f-d)*(u-c)+c,p.push(h)),c=u,d=f}let y=NaN,E=-1/0;for(p.sort(yn),c=p[0],a=1,l=p.length;a<l;++a){u=p[a];const w=Math.abs(u-c);w>E&&(h=(c+u)/2,Ao(s,e,t,n,h,_)&&(y=h,E=w)),c=u}return isNaN(y)&&(y=i[r]),o?(o.push(y,_,E),o):[y,_,E]}function bu(s,e,t,n,i){let r=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];r=Ol(s,e,l,n,i,2*o,r),e=l[l.length-1]}return r}function kl(s,e,t,n,i){let r;for(e+=n;e<t;e+=n)if(r=i(s.slice(e-n,e),s.slice(e,e+n)),r)return r;return!1}function Qs(s,e,t,n,i){const r=_c(at(),s,e,t,n);return je(i,r)?hn(i,r)||r[0]>=i[0]&&r[2]<=i[2]||r[1]>=i[1]&&r[3]<=i[3]?!0:kl(s,e,t,n,function(o,a){return mc(i,o,a)}):!1}function Mu(s,e,t,n,i){for(let r=0,o=t.length;r<o;++r){if(Qs(s,e,t[r],n,i))return!0;e=t[r]}return!1}function Du(s,e,t,n,i){return!!(Qs(s,e,t,n,i)||un(s,e,t,n,i[0],i[1])||un(s,e,t,n,i[0],i[3])||un(s,e,t,n,i[2],i[1])||un(s,e,t,n,i[2],i[3]))}function Nl(s,e,t,n,i){if(!Du(s,e,t[0],n,i))return!1;if(t.length===1)return!0;for(let r=1,o=t.length;r<o;++r)if(Su(s,t[r-1],t[r],n,i)&&!Qs(s,t[r-1],t[r],n,i))return!1;return!0}function Lu(s,e,t,n,i){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(Nl(s,e,a,n,i))return!0;e=a[a.length-1]}return!1}function Au(s,e,t,n){for(;e<t-n;){for(let i=0;i<n;++i){const r=s[e+i];s[e+i]=s[t-n+i],s[t-n+i]=r}e+=n,t-=n}}function Gl(s,e,t,n){let i=0,r=s[t-n],o=s[t-n+1];for(;e<t;e+=n){const a=s[e],l=s[e+1];i+=(a-r)*(l+o),r=a,o=l}return i===0?void 0:i>0}function Bl(s,e,t,n,i){i=i!==void 0?i:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=Gl(s,e,a,n);if(r===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;e=a}return!0}function Pu(s,e,t,n,i){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(!Bl(s,e,a,n,i))return!1;a.length&&(e=a[a.length-1])}return!0}function Zr(s,e,t,n,i){i=i!==void 0?i:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=Gl(s,e,a,n);(r===0?i&&l||!i&&!l:i&&!l||!i&&l)&&Au(s,e,a,n),e=a}return e}function Ta(s,e,t,n,i){for(let r=0,o=t.length;r<o;++r)e=Zr(s,e,t[r],n,i);return e}class Ci extends Qt{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?Lt(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Ci(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,i){return i<vn(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(So(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),bo(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,i))}containsXY(e,t){return Ao(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return Fl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Zr(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Ei(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Bn(this.getExtent());this.flatInteriorPoint_=Ol(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new $t(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new wa(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,i=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new wa(t.slice(r,l),e);i.push(h),r=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Bl(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Zr(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=Al(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new Ci(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return Nl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Mo(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}const Hn=Ci;function Ra(s){const e=s[0],t=s[1],n=s[2],i=s[3],r=[e,t,e,i,n,i,n,t,e,t];return new Ci(r,"XY",[r.length])}const cr=0;class Fu extends ht{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=mo(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&pc(),e.center&&(e.center=it(e.center,this.projection_)),e.extent&&(e.extent=cn(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in tt)delete t[a];this.setProperties(t,!0);const n=ku(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const i=Ou(e),r=n.constraint,o=Nu(e);this.constraints_={center:i,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const i=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(i[3]-t[3]+t[1]-i[1]),a=r/2*(i[0]-t[0]+t[2]-i[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=it(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=it(i.anchor,this.getProjection())),t[n]=i}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,n;t>1&&typeof arguments[t-1]=="function"&&(n=arguments[t-1],--t);let i=0;for(;i<t&&!this.isDef();++i){const c=arguments[i];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(i===t){n&&Ji(n,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;i<t;++i){const c=arguments[i],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||ou,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=di(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}Gu(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Ce.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ce.ANIMATING]>0}getInteracting(){return this.hints_[Ce.INTERACTING]>0}cancelAnimations(){this.setHint(Ce.ANIMATING,-this.hints_[Ce.ANIMATING]);let e;for(let t=0,n=this.animations_.length;t<n;++t){const i=this.animations_[t];if(i[0].callback&&Ji(i[0].callback,!1),!e)for(let r=0,o=i.length;r<o;++r){const a=i[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const i=this.animations_[n];let r=!0;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],_=l.targetCenter[0],p=l.targetCenter[1];this.nextCenter_=l.targetCenter;const y=d+u*(_-d),E=f+u*(p-f);this.targetCenter_=[y,E]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),_=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(_,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?di(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[n]=null,this.setHint(Ce.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=i[0].callback;o&&Ji(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-t[0],i[1]-t[1]],po(n,e-this.getRotation()),yc(n,t)),n}calculateCenterZoom(e,t){let n;const i=this.getCenterInternal(),r=this.getResolution();if(i!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-i[0])/r,a=t[1]-e*(t[1]-i[1])/r;n=[o,a]}return n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],i=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(i*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(i*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&zr(e,this.getProjection())}getCenterInternal(){return this.get(tt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Yr(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();ae(t,1);const n=this.getResolution();ae(n!==void 0,2);const i=this.getRotation();return ae(i!==void 0,3),Ur(t,n,i,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(tt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(cn(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=we(e)/t[0],i=qt(e)/t[1];return Math.max(n,i)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(t/n)/Math.log(e);return function(r){return t/Math.pow(e,r*i)}}getRotation(){return this.get(tt.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(n/i)/t;return function(o){return Math.log(n/o)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let i=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();i=ur(i,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,n)}return{center:i.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,n,i;if(this.resolutions_){const r=wl(this.resolutions_,e,1);t=r,n=this.resolutions_[r],r==this.resolutions_.length-1?i=2:i=n/this.resolutions_[r+1]}else n=this.maxResolution_,i=this.zoomFactor_;return t+Math.log(n/e)/Math.log(i)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=ye(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,ye(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(ae(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function",24),Array.isArray(e)){ae(!fl(e),25);const i=cn(e,this.getProjection());n=Ra(i)}else if(e.getType()==="Circle"){const i=cn(e.getExtent(),this.getProjection());n=Ra(i),n.rotate(this.getRotation(),Bn(i))}else{const i=js();i?n=e.clone().transform(i,this.getProjection()):n=e}this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),i=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=r.length;u<d;u+=o){const f=r[u]*n-r[u+1]*i,_=r[u]*i+r[u+1]*n;a=Math.min(a,f),l=Math.min(l,_),h=Math.max(h,f),c=Math.max(c,_)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let n=t.size;n||(n=this.getViewportSizeMinusPadding_());const i=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Bn(a);d[0]+=(i[1]-i[3])/2*l,d[1]+=(i[0]-i[2])/2*l;const f=d[0]*u-d[1]*c,_=d[1]*u+d[0]*c,p=this.getConstrainedCenter([f,_],l),y=t.callback?t.callback:jn;t.duration!==void 0?this.animateInternal({resolution:l,center:p,duration:t.duration,easing:t.easing},y):(this.targetResolution_=l,this.targetCenter_=p,this.applyTargetState_(!1,!0),Ji(y,!0))}centerOn(e,t,n){this.centerOnInternal(it(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(ur(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,i){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),l=ur(e,i,[a[0]/2+o[3],a[1]/2+o[0]],t,n);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=zr(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&it(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,i,n);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=it(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(i,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&it(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,i=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(i),o=this.constraints_.resolution(this.targetResolution_,0,r,n),a=this.constraints_.center(this.targetCenter_,o,r,n,this.calculateCenterShift(this.targetCenter_,o,i,r));this.get(tt.ROTATION)!==i&&this.set(tt.ROTATION,i),this.get(tt.RESOLUTION)!==o&&(this.set(tt.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(tt.CENTER)||!jr(this.get(tt.CENTER),a))&&this.set(tt.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=e!==void 0?e:200;const i=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,i,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!jr(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:e,easing:qn,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ce.INTERACTING,1)}endInteraction(e,t,n){n=n&&it(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(Ce.INTERACTING,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}}function Ji(s,e){setTimeout(function(){s(e)},0)}function Ou(s){if(s.extent!==void 0){const t=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return _a(s.extent,s.constrainOnlyCenter,t)}const e=mo(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,_a(t,!1,!1)}return tu}function ku(s){let e,t,n,o=s.minZoom!==void 0?s.minZoom:cr,a=s.maxZoom!==void 0?s.maxZoom:28;const l=s.zoomFactor!==void 0?s.zoomFactor:2,h=s.multiWorld!==void 0?s.multiWorld:!1,c=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,u=s.showFullExtent!==void 0?s.showFullExtent:!1,d=mo(s.projection,"EPSG:3857"),f=d.getExtent();let _=s.constrainOnlyCenter,p=s.extent;if(!h&&!p&&d.isGlobal()&&(_=!1,p=f),s.resolutions!==void 0){const y=s.resolutions;t=y[o],n=y[a]!==void 0?y[a]:y[y.length-1],s.constrainResolution?e=nu(y,c,!_&&p,u):e=ma(t,n,c,!_&&p,u)}else{const E=(f?Math.max(we(f),qt(f)):360*gl.degrees/d.getMetersPerUnit())/eu/Math.pow(2,cr),w=E/Math.pow(2,28-cr);t=s.maxResolution,t!==void 0?o=0:t=E/Math.pow(l,o),n=s.minResolution,n===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?n=t/Math.pow(l,a):n=E/Math.pow(l,a):n=w),a=o+Math.floor(Math.log(t/n)/Math.log(l)),n=t/Math.pow(l,a-o),s.constrainResolution?e=iu(l,t,n,c,!_&&p,u):e=ma(t,n,c,!_&&p,u)}return{constraint:e,maxResolution:t,minResolution:n,minZoom:o,zoomFactor:l}}function Nu(s){if(s.enableRotation!==void 0?s.enableRotation:!0){const t=s.constrainRotation;return t===void 0||t===!0?ru():t===!1?pa:typeof t=="number"?su(t):pa}return Co}function Gu(s){return!(s.sourceCenter&&s.targetCenter&&!jr(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function ur(s,e,t,n,i){const r=Math.cos(-i);let o=Math.sin(-i),a=s[0]*r-s[1]*o,l=s[1]*r+s[0]*o;a+=(e[0]/2-t[0])*n,l+=(t[1]-e[1]/2)*n,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}const mt=Fu,Qi="ol-hidden",Bu="ol-selectable",zi="ol-unselectable",Po="ol-control",Sa="ol-collapsed",Wu=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Ia=["style","variant","weight","size","lineHeight","family"],Wl=function(s){const e=s.match(Wu);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,i=Ia.length;n<i;++n){const r=e[n+1];r!==void 0&&(t[Ia[n]]=r)}return t.families=t.family.split(/,\s?/),t};class zu extends Bi{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",n=e.tipLabel!==void 0?e.tipLabel:"Attributions",i=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"›",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=i):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(Z.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+zi+" "+Po+(this.collapsed_&&this.collapsible_?" "+Sa:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(i=>i.getAttributions(e)))),n=!this.getMap().getAllLayers().some(i=>i.getSource()&&i.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Ft(t,this.renderedAttributions_)){Il(this.ulElement_);for(let i=0,r=t.length;i<r;++i){const o=document.createElement("li");o.innerHTML=t[i],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Sa),this.collapsed_?fa(this.collapseLabel_,this.label_):fa(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}const Yu=zu,Me={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Ye={ADD:"add",REMOVE:"remove"},ba={LENGTH:"length"};class es extends Pt{constructor(e,t,n){super(e),this.element=t,this.index=n}}class Uu extends ht{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let n=0,i=this.array_.length;n<i;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,i=t.length;n<i;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(ba.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new es(Ye.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,i=t.length;n<i;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new es(Ye.REMOVE,t,e)),t}setAt(e,t){const n=this.getLength();if(e>=n){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const i=this.array_[e];this.array_[e]=t,this.dispatchEvent(new es(Ye.REMOVE,i,e)),this.dispatchEvent(new es(Ye.ADD,t,e))}updateLength_(){this.set(ba.LENGTH,this.array_.length)}assertUnique_(e,t){for(let n=0,i=this.array_.length;n<i;++n)if(this.array_[n]===e&&n!==t)throw new xc(58)}}const yt=Uu,ju=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Xu=/^([a-z]*)$|^hsla?\(.*\)$/i;function zl(s){return typeof s=="string"?s:Yl(s)}function Hu(s){const e=document.createElement("div");if(e.style.color=s,e.style.color!==""){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}const Vu=function(){const e={};let t=0;return function(n){let i;if(e.hasOwnProperty(n))i=e[n];else{if(t>=1024){let r=0;for(const o in e)r++&3||(delete e[o],--t)}i=Zu(n),e[n]=i,++t}return i}}();function Ms(s){return Array.isArray(s)?s:Vu(s)}function Zu(s){let e,t,n,i,r;if(Xu.exec(s)&&(s=Hu(s)),ju.exec(s)){const o=s.length-1;let a;o<=4?a=1:a=2;const l=o===4||o===8;e=parseInt(s.substr(1+0*a,a),16),t=parseInt(s.substr(1+1*a,a),16),n=parseInt(s.substr(1+2*a,a),16),l?i=parseInt(s.substr(1+3*a,a),16):i=255,a==1&&(e=(e<<4)+e,t=(t<<4)+t,n=(n<<4)+n,l&&(i=(i<<4)+i)),r=[e,t,n,i/255]}else s.startsWith("rgba(")?(r=s.slice(5,-1).split(",").map(Number),Ma(r)):s.startsWith("rgb(")?(r=s.slice(4,-1).split(",").map(Number),r.push(1),Ma(r)):ae(!1,14);return r}function Ma(s){return s[0]=ye(s[0]+.5|0,0,255),s[1]=ye(s[1]+.5|0,0,255),s[2]=ye(s[2]+.5|0,0,255),s[3]=ye(s[3],0,1),s}function Yl(s){let e=s[0];e!=(e|0)&&(e=e+.5|0);let t=s[1];t!=(t|0)&&(t=t+.5|0);let n=s[2];n!=(n|0)&&(n=n+.5|0);const i=s[3]===void 0?1:Math.round(s[3]*100)/100;return"rgba("+e+","+t+","+n+","+i+")"}class Ku{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];!(e++&3)&&!n.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,n){const i=Da(e,t,n);return i in this.cache_?this.cache_[i]:null}set(e,t,n,i){const r=Da(e,t,n);this.cache_[r]=i,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function Da(s,e,t){const n=t?zl(t):"null";return e+":"+s+":"+n}const Ds=new Ku,re={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class $u extends ht{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[re.OPACITY]=e.opacity!==void 0?e.opacity:1,ae(typeof t[re.OPACITY]=="number",64),t[re.VISIBLE]=e.visible!==void 0?e.visible:!0,t[re.Z_INDEX]=e.zIndex,t[re.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[re.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[re.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[re.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},n=this.getZIndex();return t.opacity=ye(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=n===void 0&&!t.managed?1/0:n,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return X()}getLayerStatesArray(e){return X()}getExtent(){return this.get(re.EXTENT)}getMaxResolution(){return this.get(re.MAX_RESOLUTION)}getMinResolution(){return this.get(re.MIN_RESOLUTION)}getMinZoom(){return this.get(re.MIN_ZOOM)}getMaxZoom(){return this.get(re.MAX_ZOOM)}getOpacity(){return this.get(re.OPACITY)}getSourceState(){return X()}getVisible(){return this.get(re.VISIBLE)}getZIndex(){return this.get(re.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(re.EXTENT,e)}setMaxResolution(e){this.set(re.MAX_RESOLUTION,e)}setMinResolution(e){this.set(re.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(re.MAX_ZOOM,e)}setMinZoom(e){this.set(re.MIN_ZOOM,e)}setOpacity(e){ae(typeof e=="number",64),this.set(re.OPACITY,e)}setVisible(e){this.set(re.VISIBLE,e)}setZIndex(e){this.set(re.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Ul=$u,Ue={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class qu extends Ul{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(re.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(re.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(he(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=K(e,Z.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof mt?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let i;t.layerStatesArray?i=t.layerStatesArray.find(o=>o.layer===this):i=this.getLayerState();const r=this.getExtent();return Fo(i,t.viewState)&&(!r||je(r,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const n=this.getSource();if(n&&(t=n.getAttributions()),!t)return[];const i=e instanceof mt?e.getViewStateAndExtent():e;let r=t(i);return Array.isArray(r)||(r=[r]),r}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(re.MAP,e)}getMapInternal(){return this.get(re.MAP)}setMap(e){this.mapPrecomposeKey_&&(he(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(he(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=K(e,Ue.PRECOMPOSE,function(t){const i=t.frameState.layerStatesArray,r=this.getLayerState(!1);ae(!i.some(function(o){return o.layer===r.layer}),67),i.push(r)},this),this.mapRenderKey_=K(this,Z.CHANGE,e.render,e),this.changed())}setSource(e){this.set(re.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Fo(s,e){if(!s.visible)return!1;const t=e.resolution;if(t<s.minResolution||t>=s.maxResolution)return!1;const n=e.zoom;return n>s.minZoom&&n<=s.maxZoom}const er=qu;class Ju extends Vs{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){X()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,i=e.pixelToCoordinateTransform;vt(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),qs(i,n)}forEachFeatureAtCoordinate(e,t,n,i,r,o,a,l){let h;const c=t.viewState;function u(C,R,M,A){return r.call(o,R,C?M:null,A)}const d=c.projection,f=fo(e.slice(),d),_=[[0,0]];if(d.canWrapX()&&i){const C=d.getExtent(),R=we(C);_.push([-R,0],[R,0])}const p=t.layerStatesArray,y=p.length,E=[],w=[];for(let C=0;C<_.length;C++)for(let R=y-1;R>=0;--R){const M=p[R],A=M.layer;if(A.hasRenderer()&&Fo(M,c)&&a.call(l,A)){const L=A.getRenderer(),B=A.getSource();if(L&&B){const W=B.getWrapX()?f:e,ee=u.bind(null,M.managed);w[0]=W[0]+_[C][0],w[1]=W[1]+_[C][1],h=L.forEachFeatureAtCoordinate(w,t,n,ee,E)}if(h)return h}}if(E.length===0)return;const v=1/E.length;return E.forEach((C,R)=>C.distanceSq+=R*v),E.sort((C,R)=>C.distanceSq-R.distanceSq),E.some(C=>h=C.callback(C.feature,C.layer,C.geometry)),h}hasFeatureAtCoordinate(e,t,n,i,r,o){return this.forEachFeatureAtCoordinate(e,t,n,i,Un,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){X()}scheduleExpireIconCache(e){Ds.canExpireCache()&&e.postRenderFunctions.push(Qu)}}function Qu(s,e){Ds.expire()}const ed=Ju;class td extends Pt{constructor(e,t,n,i){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=i}}const gi=td,jl="10px sans-serif",At="#000",Ls="round",wi=[],Ti=0,Vn="round",Ri=10,Si="#000",Ii="center",As="middle",dn=[0,0,0,0],bi=1,St=new ht;let bn=null,Kr;const $r={},nd=function(){const e="32px ",t=["monospace","serif"],n=t.length,i="wmytzilWMYTZIL@#/&?$%10";let r,o;function a(h,c,u){let d=!0;for(let f=0;f<n;++f){const _=t[f];if(o=Ps(h+" "+c+" "+e+_,i),u!=_){const p=Ps(h+" "+c+" "+e+u+","+_,i);d=d&&p!=o}}return!!d}function l(){let h=!0;const c=St.getKeys();for(let u=0,d=c.length;u<d;++u){const f=c[u];St.get(f)<100&&(a.apply(this,f.split(`
`))?($n($r),bn=null,Kr=void 0,St.set(f,100)):(St.set(f,St.get(f)+1,!0),h=!1))}h&&(clearInterval(r),r=void 0)}return function(h){const c=Wl(h);if(!c)return;const u=c.families;for(let d=0,f=u.length;d<f;++d){const _=u[d],p=c.style+`
`+c.weight+`
`+_;St.get(p)===void 0&&(St.set(p,100,!0),a(c.style,c.weight,_)||(St.set(p,0,!0),r===void 0&&(r=setInterval(l,32))))}}}(),id=function(){let s;return function(e){let t=$r[e];if(t==null){if(xo){const n=Wl(e),i=Xl(e,"Žg");t=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=e,document.body.appendChild(s),t=s.offsetHeight,document.body.removeChild(s);$r[e]=t}return t}}();function Xl(s,e){return bn||(bn=Le(1,1)),s!=Kr&&(bn.font=s,Kr=bn.font),bn.measureText(e)}function Ps(s,e){return Xl(s,e).width}function La(s,e,t){if(e in t)return t[e];const n=e.split(`
`).reduce((i,r)=>Math.max(i,Ps(s,r)),0);return t[e]=n,n}function sd(s,e){const t=[],n=[],i=[];let r=0,o=0,a=0,l=0;for(let h=0,c=e.length;h<=c;h+=2){const u=e[h];if(u===`
`||h===c){r=Math.max(r,o),i.push(o),o=0,a+=l;continue}const d=e[h+1]||s.font,f=Ps(d,u);t.push(f),o+=f;const _=id(d);n.push(_),l=Math.max(l,_)}return{width:r,height:a,widths:t,heights:n,lineWidths:i}}function rd(s,e,t,n,i,r,o,a,l,h,c){s.save(),t!==1&&(s.globalAlpha*=t),e&&s.setTransform.apply(s,e),n.contextInstructions?(s.translate(l,h),s.scale(c[0],c[1]),od(n,s)):c[0]<0||c[1]<0?(s.translate(l,h),s.scale(c[0],c[1]),s.drawImage(n,i,r,o,a,0,0,o,a)):s.drawImage(n,i,r,o,a,l,h,o*c[0],a*c[1]),s.restore()}function od(s,e){const t=s.contextInstructions;for(let n=0,i=t.length;n<i;n+=2)Array.isArray(t[n+1])?e[t[n]].apply(e,t[n+1]):e[t[n]]=t[n+1]}class ad extends ed{constructor(e){super(e),this.fontChangeListenerKey_=K(St,Yn.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=zi+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const i=new gi(e,void 0,t);n.dispatchEvent(i)}}disposeInternal(){he(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(Ue.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=e.viewState;this.children_.length=0;const i=[];let r=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!Fo(l,n)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(e,r);u&&(u!==r&&(this.children_.push(u),r=u),"getDeclutter"in h&&i.push(h))}for(let o=i.length-1;o>=0;--o)i[o].renderDeclutter(e);$c(this.element_,this.children_),this.dispatchRenderEvent(Ue.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}}const ld=ad;class jt extends Pt{constructor(e,t){super(e),this.layer=t}}const dr={LAYERS:"layers"};class Oo extends Ul{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(dr.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new yt(n.slice(),{unique:!0}):ae(typeof n.getArray=="function",43):n=new yt(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(he),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(K(e,Ye.ADD,this.handleLayersAdd_,this),K(e,Ye.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(he);$n(this.listenerKeys_);const t=e.getArray();for(let n=0,i=t.length;n<i;n++){const r=t[n];this.registerLayerListeners_(r),this.dispatchEvent(new jt("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[K(e,Yn.PROPERTYCHANGE,this.handleLayerChange_,this),K(e,Z.CHANGE,this.handleLayerChange_,this)];e instanceof Oo&&t.push(K(e,"addlayer",this.handleLayerGroupAdd_,this),K(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[q(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new jt("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new jt("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new jt("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=q(t);this.listenerKeys_[n].forEach(he),delete this.listenerKeys_[n],this.dispatchEvent(new jt("removelayer",t)),this.changed()}getLayers(){return this.get(dr.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const n=t.getArray();for(let i=0,r=n.length;i<r;++i)this.dispatchEvent(new jt("removelayer",n[i]))}this.set(dr.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],n=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const i=this.getLayerState();let r=i.zIndex;!e&&i.zIndex===void 0&&(r=0);for(let o=n,a=t.length;o<a;o++){const l=t[o];l.opacity*=i.opacity,l.visible=l.visible&&i.visible,l.maxResolution=Math.min(l.maxResolution,i.maxResolution),l.minResolution=Math.max(l.minResolution,i.minResolution),l.minZoom=Math.max(l.minZoom,i.minZoom),l.maxZoom=Math.min(l.maxZoom,i.maxZoom),i.extent!==void 0&&(l.extent!==void 0?l.extent=fi(l.extent,i.extent):l.extent=i.extent),l.zIndex===void 0&&(l.zIndex=r)}return t}getSourceState(){return"ready"}}const tr=Oo;class hd extends Pt{constructor(e,t,n){super(e),this.map=t,this.frameState=n!==void 0?n:null}}const Mn=hd;class cd extends Mn{constructor(e,t,n,i,r,o){super(e,t,r),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=i!==void 0?i:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const bt=cd,oe={SINGLECLICK:"singleclick",CLICK:Z.CLICK,DBLCLICK:Z.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class ud extends Zs{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=K(n,xi.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=K(n,xi.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Z.TOUCHMOVE,this.boundHandleTouchMove_,Sl?{passive:!1}:!1)}emulateClick_(e){let t=new bt(oe.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new bt(oe.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new bt(oe.SINGLECLICK,this.map_,e);this.dispatchEvent(n)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==oe.POINTERUP||t.type==oe.POINTERCANCEL){delete this.trackedTouches_[n];for(const i in this.trackedTouches_)if(this.trackedTouches_[i].target!==t.target){delete this.trackedTouches_[i];break}}else(t.type==oe.POINTERDOWN||t.type==oe.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new bt(oe.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(he),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new bt(oe.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(K(n,oe.POINTERMOVE,this.handlePointerMove_,this),K(n,oe.POINTERUP,this.handlePointerUp_,this),K(this.element_,oe.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(K(this.element_.getRootNode(),oe.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new bt(oe.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new bt(oe.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(he(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Z.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(he(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(he),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const dd=ud,Fs=1/0;class fd{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,$n(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(e){ae(!(this.keyFunction_(e)in this.queuedElements_),31);const t=this.priorityFunction_(e);return t!=Fs?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,i=t.length,r=t[e],o=n[e],a=e;for(;e<i>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<i&&n[h]<n[l]?h:l;t[e]=t[c],n[e]=n[c],e=c}t[e]=r,n[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const n=this.elements_,i=this.priorities_,r=n[t],o=i[t];for(;t>e;){const a=this.getParentIndex_(t);if(i[a]>o)n[t]=n[a],i[t]=i[a],t=a;else break}n[t]=r,i[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let i=0;const r=t.length;let o,a,l;for(a=0;a<r;++a)o=t[a],l=e(o),l==Fs?delete this.queuedElements_[this.keyFunction_(o)]:(n[i]=l,t[i++]=o);t.length=i,n.length=i,this.heapify_()}}const gd=fd,H={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class _d extends gd{constructor(e,t){super(function(n){return e.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(Z.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(n===H.LOADED||n===H.ERROR||n===H.EMPTY){n!==H.ERROR&&t.removeEventListener(Z.CHANGE,this.boundHandleTileChange_);const i=t.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0,i,r,o;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;)r=this.dequeue()[0],o=r.getKey(),i=r.getState(),i===H.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,r.load())}}const md=_d;function pd(s,e,t,n,i){if(!s||!(t in s.wantedTiles)||!s.wantedTiles[t][e.getKey()])return Fs;const r=s.viewState.center,o=n[0]-r[0],a=n[1]-r[1];return 65536*Math.log(i)+Math.sqrt(o*o+a*a)/i}class yd extends Bi{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",n=e.label!==void 0?e.label:"⇧",i=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=i,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(i));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(Z.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+zi+" "+Po,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Qi)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const n=t.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:qn}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const i="rotate("+n+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Qi);!r&&n===0?this.element.classList.add(Qi):r&&n!==0&&this.element.classList.remove(Qi)}this.label_.style.transform=i}this.rotation_=n}}const xd=yd;class vd extends Bi{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",n=e.delta!==void 0?e.delta:1,i=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"–",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=i,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(Z.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(Z.CLICK,this.handleClick_.bind(this,-n),!1);const d=t+" "+zi+" "+Po,f=this.element;f.className=d,f.appendChild(c),f.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const n=this.getMap().getView();if(!n)return;const i=n.getZoom();if(i!==void 0){const r=n.getConstrainedZoom(i+e);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:r,duration:this.duration_,easing:qn})):n.setZoom(r)}}}const Ed=vd;function Cd(s){s=s||{};const e=new yt;return(s.zoom!==void 0?s.zoom:!0)&&e.push(new Ed(s.zoomOptions)),(s.rotate!==void 0?s.rotate:!0)&&e.push(new xd(s.rotateOptions)),(s.attribution!==void 0?s.attribution:!0)&&e.push(new Yu(s.attributionOptions)),e}const qr={ACTIVE:"active"};class wd extends ht{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(qr.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(qr.ACTIVE,e)}setMap(e){this.map_=e}}function Td(s,e,t){const n=s.getCenterInternal();if(n){const i=[n[0]+e[0],n[1]+e[1]];s.animateInternal({duration:t!==void 0?t:250,easing:au,center:s.getConstrainedCenter(i)})}}function ko(s,e,t,n){const i=s.getZoom();if(i===void 0)return;const r=s.getConstrainedZoom(i+e),o=s.getResolutionForZoom(r);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:o,anchor:t,duration:n!==void 0?n:250,easing:qn})}const Yi=wd;class Rd extends Yi{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==oe.DBLCLICK){const n=e.originalEvent,i=e.map,r=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=i.getView();ko(a,o,r,this.duration_),n.preventDefault(),t=!0}return!t}}const Sd=Rd;class Id extends Yi{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==oe.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==oe.POINTERUP){const n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==oe.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==oe.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function No(s){const e=s.length;let t=0,n=0;for(let i=0;i<e;i++)t+=s[i].clientX,n+=s[i].clientY;return{clientX:t/e,clientY:n/e}}const Jn=Id;function Jr(s){const e=arguments;return function(t){let n=!0;for(let i=0,r=e.length;i<r&&(n=n&&e[i](t),!!n);++i);return n}}const bd=function(s){const e=s.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Md=function(s){const e=s.map.getTargetElement(),t=s.map.getOwnerDocument().activeElement;return e.contains(t)},Hl=function(s){return s.map.getTargetElement().hasAttribute("tabindex")?Md(s):!0},Qr=Un,Vl=function(s){const e=s.originalEvent;return e.button==0&&!(Xc&&Hc&&e.ctrlKey)},Dd=Kn,Go=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Zl=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Kl=function(s){const e=s.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},fr=function(s){const e=s.originalEvent;return ae(e!==void 0,56),e.pointerType=="mouse"},Ld=function(s){const e=s.originalEvent;return ae(e!==void 0,56),e.isPrimary&&e.button===0};class Ad extends Jn{constructor(e){super({stopDown:Kn}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Jr(Go,Ld);this.condition_=e.onFocusOnly?Jr(Hl,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,i=t.getEventPixel(No(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const r=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],a=e.map.getView();vc(r,a.getResolution()),po(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const i=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-i*Math.cos(r),a[1]-i*Math.sin(r)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:qn})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const n=e.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const Pd=Ad;class Fd extends Jn{constructor(e){e=e||{},super({stopDown:Kn}),this.condition_=e.condition?e.condition:bd,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!fr(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===Co)return;const i=t.getSize(),r=e.pixel,o=Math.atan2(i[1]/2-r[1],r[0]-i[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return fr(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return fr(e)&&Vl(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const Od=Fd;class kd extends Vs{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",i=this.element_.style;i.left=Math.min(e[0],t[0])+n,i.top=Math.min(e[1],t[1])+n,i.width=Math.abs(t[0]-e[0])+n,i.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,i=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new Hn([i])}getGeometry(){return this.geometry_}}const Nd=kd,ts={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class gr extends Pt{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}class Gd extends Jn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new Nd(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:Vl,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const i=n[0]-t[0],r=n[1]-t[1];return i*i+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new gr(ts.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new gr(t?ts.BOXEND:ts.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new gr(ts.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}const $l=Gd;class Bd extends $l{constructor(e){e=e||{};const t=e.condition?e.condition:Zl;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const n=this.getMap().getView();let i=this.getGeometry();if(this.out_){const r=n.rotatedExtentForGeometry(i),o=n.getResolutionForExtentInternal(r),a=n.getResolution()/o;i=i.clone(),i.scale(a*a)}n.fitInternal(i,{duration:this.duration_,easing:qn})}}const Wd=Bd,on={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class zd extends Yi{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return Go(t)&&Kl(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==Z.KEYDOWN){const n=e.originalEvent,i=n.key;if(this.condition_(e)&&(i==on.DOWN||i==on.LEFT||i==on.RIGHT||i==on.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;i==on.DOWN?h=-a:i==on.LEFT?l=-a:i==on.RIGHT?l=a:h=a;const c=[l,h];po(c,o.getRotation()),Td(o,c,this.duration_),n.preventDefault(),t=!0}}return!t}}const Yd=zd;class Ud extends Yi{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:Kl,this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==Z.KEYDOWN||e.type==Z.KEYPRESS){const n=e.originalEvent,i=n.key;if(this.condition_(e)&&(i==="+"||i==="-")){const r=e.map,o=i==="+"?this.delta_:-this.delta_,a=r.getView();ko(a,o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}}const jd=Ud;class Xd{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const i=this.points_[t+2]-this.points_[n+2];if(i<1e3/60)return!1;const r=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Hd=Xd;class Vd extends Yi{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:Qr;this.condition_=e.onFocusOnly?Jr(Hl,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==Z.WHEEL)return!0;const n=e.map,i=e.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let r;if(e.type==Z.WHEEL&&(r=i.deltaY,Yc&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Rl),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-ye(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),ko(t,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}const Zd=Vd;class Kd extends Jn{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Kn),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],i=this.targetPointers[1],r=Math.atan2(i.clientY-n.clientY,i.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==Co&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(No(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const $d=Kd;class qd extends Jn{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Kn),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],i=this.targetPointers[1],r=n.clientX-i.clientX,o=n.clientY-i.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(No(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const n=e.map.getView(),i=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const Jd=qd;function ql(s){s=s||{};const e=new yt,t=new Hd(-.005,.05,100);return(s.altShiftDragRotate!==void 0?s.altShiftDragRotate:!0)&&e.push(new Od),(s.doubleClickZoom!==void 0?s.doubleClickZoom:!0)&&e.push(new Sd({delta:s.zoomDelta,duration:s.zoomDuration})),(s.dragPan!==void 0?s.dragPan:!0)&&e.push(new Pd({onFocusOnly:s.onFocusOnly,kinetic:t})),(s.pinchRotate!==void 0?s.pinchRotate:!0)&&e.push(new $d),(s.pinchZoom!==void 0?s.pinchZoom:!0)&&e.push(new Jd({duration:s.zoomDuration})),(s.keyboard!==void 0?s.keyboard:!0)&&(e.push(new Yd),e.push(new jd({delta:s.zoomDelta,duration:s.zoomDuration}))),(s.mouseWheelZoom!==void 0?s.mouseWheelZoom:!0)&&e.push(new Zd({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(s.shiftDragZoom!==void 0?s.shiftDragZoom:!0)&&e.push(new Wd({duration:s.zoomDuration})),e}function Aa(s){return s[0]>0&&s[1]>0}function Fm(s,e,t){return t===void 0&&(t=[0,0]),t[0]=s[0]*e+.5|0,t[1]=s[1]*e+.5|0,t}function Mi(s,e){return Array.isArray(s)?s:(e===void 0?e=[s,s]:(e[0]=s,e[1]=s),e)}function Jl(s){if(s instanceof er){s.setMapInternal(null);return}s instanceof tr&&s.getLayers().forEach(Jl)}function Ql(s,e){if(s instanceof er){s.setMapInternal(e);return}if(s instanceof tr){const t=s.getLayers().getArray();for(let n=0,i=t.length;n<i;++n)Ql(t[n],e)}}class Qd extends ht{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=ef(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Rl,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Se(),this.pixelToCoordinateTransform_=Se(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||Cd(),this.interactions=t.interactions||ql({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new md(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Me.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Me.VIEW,this.handleViewChanged_),this.addChangeListener(Me.SIZE,this.handleSizeChanged_),this.addChangeListener(Me.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const n=this;e.view&&!(e.view instanceof mt)&&e.view.then(function(i){n.setView(new mt(i))}),this.controls.addEventListener(Ye.ADD,i=>{i.element.setMap(this)}),this.controls.addEventListener(Ye.REMOVE,i=>{i.element.setMap(null)}),this.interactions.addEventListener(Ye.ADD,i=>{i.element.setMap(this)}),this.interactions.addEventListener(Ye.REMOVE,i=>{i.element.setMap(null)}),this.overlays_.addEventListener(Ye.ADD,i=>{this.addOverlayInternal_(i.element)}),this.overlays_.addEventListener(Ye.REMOVE,i=>{const r=i.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],i.element.setMap(null)}),this.controls.forEach(i=>{i.setMap(this)}),this.interactions.forEach(i=>{i.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){Ql(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const i=this.getCoordinateFromPixelInternal(e);n=n!==void 0?n:{};const r=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:Un,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,function(i){n.push(i)},t),n}getAllLayers(){const e=[];function t(n){n.forEach(function(i){i instanceof tr?t(i.getLayers()):e.push(i)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const i=t.layerFilter!==void 0?t.layerFilter:Un,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,r,o,i,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const n=this.viewport_.getBoundingClientRect(),i=this.getSize(),r=n.width/i[0],o=n.height/i[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-n.left)/r,(a.clientY-n.top)/o]}getTarget(){return this.get(Me.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return zr(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?xe(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Me.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof yt){t.setLayers(e);return}const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const i=e[t];if(!i.visible)continue;const r=i.layer.getRenderer();if(r&&!r.ready)return!0;const o=i.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=it(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?xe(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Me.SIZE)}getView(){return this.get(Me.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,i){return pd(this.frameState_,e,t,n,i)}handleBrowserEvent(e,t){t=t||e.type;const n=new bt(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,n=t.type;if(n===xi.POINTERDOWN||n===Z.WHEEL||n===Z.KEYDOWN){const i=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():i,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(r===i?i.documentElement:r).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const i=this.getInteractions().getArray().slice();for(let r=i.length-1;r>=0;r--){const o=i[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let i=this.maxTilesLoading_,r=i;if(e){const o=e.viewHints;if(o[Ce.ANIMATING]||o[Ce.INTERACTING]){const a=Date.now()-e.time>8;i=a?0:8,r=a?0:2}}t.getTilesLoading()<i&&(t.reprioritize(),t.loadMoreTiles(i,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(Ue.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ue.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Mn(It.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Mn(It.LOADSTART,this,e))));const n=this.postRenderFunctions_;for(let i=0,r=n.length;i<r;++i)n[i](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,i=this.targetChangeHandlerKeys_.length;n<i;++n)he(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Z.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Z.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Ss(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new ld(this)),this.mapBrowserEventHandler_=new dd(this,this.moveTolerance_);for(const r in oe)this.mapBrowserEventHandler_.addEventListener(oe[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Z.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Z.WHEEL,this.boundHandleBrowserEvent_,Sl?{passive:!1}:!1);const n=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[K(n,Z.KEYDOWN,this.handleBrowserEvent,this),K(n,Z.KEYPRESS,this.handleBrowserEvent,this)];const i=t.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(he(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(he(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=K(e,Yn.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=K(e,Z.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(he),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new jt("addlayer",e)),this.layerGroupPropertyListenerKeys_=[K(e,Yn.PROPERTYCHANGE,this.render,this),K(e,Z.CHANGE,this.render,this),K(e,"addlayer",this.handleLayerAdd_,this),K(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const i=e[t].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){Jl(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),n=this.getView(),i=this.frameState_;let r=null;if(t!==void 0&&Aa(t)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Ur(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:q(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=Ur(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),i&&(!this.previousExtent_||!fl(this.previousExtent_)&&!Wn(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Mn(It.MOVESTART,this,i)),this.previousExtent_=go(this.previousExtent_)),this.previousExtent_&&!r.viewHints[Ce.ANIMATING]&&!r.viewHints[Ce.INTERACTING]&&!Wn(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Mn(It.MOVEEND,this,r)),_l(r.extent,this.previousExtent_))),this.dispatchEvent(new Mn(It.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(It.LOADSTART)||this.hasListener(It.LOADEND)||this.hasListener(Ue.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new jt("removelayer",t)),this.set(Me.LAYERGROUP,e)}setSize(e){this.set(Me.SIZE,e)}setTarget(e){this.set(Me.TARGET,e)}setView(e){if(!e||e instanceof mt){this.set(Me.VIEW,e);return}this.set(Me.VIEW,new mt);const t=this;e.then(function(n){t.setView(new mt(n))})}updateSize(){const e=this.getTargetElement();let t;if(e){const i=getComputedStyle(e),r=e.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),o=e.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[r,o],!Aa(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Ec("No map visible because the map container's width or height are 0."))}const n=this.getSize();t&&(!n||!Ft(t,n))&&(this.setSize(t),this.updateViewportSize_())}updateViewportSize_(){const e=this.getView();if(e){let t;const n=getComputedStyle(this.viewport_);n.width&&n.height&&(t=[parseInt(n.width,10),parseInt(n.height,10)]),e.setViewportSize(t)}}}function ef(s){let e=null;s.keyboardEventTarget!==void 0&&(e=typeof s.keyboardEventTarget=="string"?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const t={},n=s.layers&&typeof s.layers.getLayers=="function"?s.layers:new tr({layers:s.layers});t[Me.LAYERGROUP]=n,t[Me.TARGET]=s.target,t[Me.VIEW]=s.view instanceof mt?s.view:new mt;let i;s.controls!==void 0&&(Array.isArray(s.controls)?i=new yt(s.controls.slice()):(ae(typeof s.controls.getArray=="function",47),i=s.controls));let r;s.interactions!==void 0&&(Array.isArray(s.interactions)?r=new yt(s.interactions.slice()):(ae(typeof s.interactions.getArray=="function",48),r=s.interactions));let o;return s.overlays!==void 0?Array.isArray(s.overlays)?o=new yt(s.overlays.slice()):(ae(typeof s.overlays.getArray=="function",49),o=s.overlays):o=new yt,{controls:i,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}const tf=Qd,be={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class nf extends ht{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Bu,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(be.ELEMENT,this.handleElementChanged),this.addChangeListener(be.MAP,this.handleMapChanged),this.addChangeListener(be.OFFSET,this.handleOffsetChanged),this.addChangeListener(be.POSITION,this.handlePositionChanged),this.addChangeListener(be.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(be.ELEMENT)}getId(){return this.id}getMap(){return this.get(be.MAP)||null}getOffset(){return this.get(be.OFFSET)}getPosition(){return this.get(be.POSITION)}getPositioning(){return this.get(be.POSITIONING)}handleElementChanged(){Il(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Ss(this.element),he(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=K(e,It.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(be.ELEMENT,e)}setMap(e){this.set(be.MAP,e)}setOffset(e){this.set(be.OFFSET,e)}setPosition(e){this.set(be.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(be.POSITION))return;const n=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),r=this.getRect(i,[Zc(i),Kc(i)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!hn(n,r)){const a=r[0]-n[0],l=n[2]-r[2],h=r[1]-n[1],c=n[3]-r[3],u=[0,0];if(a<0?u[0]=a-o:l<0&&(u[0]=Math.abs(l)+o),h<0?u[1]=h-o:c<0&&(u[1]=Math.abs(c)+o),u[0]!==0||u[1]!==0){const d=t.getView().getCenterInternal(),f=t.getPixelFromCoordinateInternal(d);if(!f)return;const _=[f[0]+u[0],f[1]+u[1]],p=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(_),duration:p.duration,easing:p.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),i=n.left+window.pageXOffset,r=n.top+window.pageYOffset;return[i,r,i+t[0],r+t[1]]}setPositioning(e){this.set(be.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(t),i=e.getSize();this.updateRenderedPosition(n,i)}updateRenderedPosition(e,t){const n=this.element.style,i=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+i[0])+"px",a=Math.round(e[1]+i[1])+"px";let l="0%",h="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?h="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,n.transform=c)}getOptions(){return this.options}}const sf=nf,_r="units",rf=[1,2,5],ni=25.4/.28;class of extends Bi{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+zi,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(_r,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(_r)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(_r,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,n=e.projection,i=this.getUnits(),r=i=="degrees"?"degrees":"m";let o=ws(n,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||ni)/ni,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||ni)/ni:void 0;let h=a*o,c="";if(i=="degrees"){const v=gl.degrees;h*=v,h<v/60?(c="″",o*=3600):h<v?(c="′",o*=60):c="°"}else i=="imperial"?h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344):i=="nautical"?(o/=1852,c="NM"):i=="metric"?h<.001?(c="μm",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3):i=="us"?h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472):ae(!1,33);let u=3*Math.floor(Math.log(a*o)/Math.log(10)),d,f,_,p,y,E;for(;;){_=Math.floor(u/3);const v=Math.pow(10,_);if(d=rf[(u%3+3)%3]*v,f=Math.round(d/o),isNaN(f)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&f>=l){d=p,f=y,_=E;break}else if(f>=a)break;p=d,y=f,E=_,++u}const w=this.scaleBar_?this.createScaleBar(f,d,c):d.toFixed(_<0?-_:0)+" "+c;this.renderedHTML_!=w&&(this.innerElement_.innerHTML=w,this.renderedHTML_=w),this.renderedWidth_!=f&&(this.innerElement_.style.width=f+"px",this.renderedWidth_=f),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){const i=this.getScaleForResolution(),r=i<1?Math.round(1/i).toLocaleString()+" : 1":"1 : "+Math.round(i).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let c=0;c<o;++c){const u=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${u}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||o===2?this.createStepText(c,e,!1,t,n):"")+"</div>")}return l.push(this.createStepText(o,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,i,r){const a=(e===0?0:Math.round(i/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),l=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${n?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=ws(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||ni,n=1e3/25.4;return e*n*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const af=of;let eh=class th extends Qt{constructor(e,t,n){super(),n!==void 0&&t===void 0?this.setFlatCoordinates(n,e):(t=t||0,this.setCenterAndRadius(e,t,n))}clone(){const e=new th(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,i){const r=this.flatCoordinates,o=e-r[0],a=t-r[1],l=o*o+a*a;if(l<i){if(l===0)for(let h=0;h<this.stride;++h)n[h]=r[h];else{const h=this.getRadius()/Math.sqrt(l);n[0]=r[0]+h*o,n[1]=r[1]+h*a;for(let c=2;c<this.stride;++c)n[c]=r[c]}return n.length=this.stride,l}return i}containsXY(e,t){const n=this.flatCoordinates,i=e-n[0],r=t-n[1];return i*i+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return Ts(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(je(e,t)){const n=this.getCenter();return e[0]<=n[0]&&e[2]>=n[0]||e[1]<=n[1]&&e[3]>=n[1]?!0:_o(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,n=this.flatCoordinates[t]-this.flatCoordinates[0],i=e.slice();i[t]=i[0]+n;for(let r=1;r<t;++r)i[t+r]=e[r];this.setFlatCoordinates(this.layout,i),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const i=this.flatCoordinates;let r=Ll(i,0,e,this.stride);i[r++]=i[0]+t;for(let o=1,a=this.stride;o<a;++o)i[r++]=i[o];i.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),i=this.getStride();this.setCenter(To(n,0,n.length,i,e,t,n)),this.changed()}};eh.prototype.transform;const lf=eh;class Bo extends ht{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Bo(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const n=this.getStyle();return n&&e.setStyle(n),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(he(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=K(e,Z.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?hf(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function hf(s){if(typeof s=="function")return s;let e;return Array.isArray(s)?e=s:(ae(typeof s.getZIndex=="function",41),e=[s]),function(){return e}}const Xt=Bo;class Os extends Dl{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(he),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push(K(this.geometries_[e],Z.CHANGE,this.changed,this))}clone(){const e=new Os(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,n,i){if(i<vn(this.getExtent(),e,t))return i;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)i=r[o].closestPointXY(e,t,n,i);return i}containsXY(e,t){const n=this.geometries_;for(let i=0,r=n.length;i<r;++i)if(n[i].containsXY(e,t))return!0;return!1}computeExtent(e){go(e);const t=this.geometries_;for(let n=0,i=t.length;n<i;++n)ml(e,t[n].getExtent());return e}getGeometries(){return Pa(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let n=0,i=t.length;n<i;++n)t[n].getType()===this.getType()?e=e.concat(t[n].getGeometriesArrayRecursive()):e.push(t[n]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],n=this.geometries_;let i=!1;for(let r=0,o=n.length;r<o;++r){const a=n[r],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(i=!0)}if(i){const r=new Os(null);return r.setGeometriesArray(t),r}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let n=0,i=t.length;n<i;++n)if(t[n].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const n=this.geometries_;for(let i=0,r=n.length;i<r;++i)n[i].rotate(e,t);this.changed()}scale(e,t,n){n||(n=Bn(this.getExtent()));const i=this.geometries_;for(let r=0,o=i.length;r<o;++r)i[r].scale(e,t,n);this.changed()}setGeometries(e){this.setGeometriesArray(Pa(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let n=0,i=t.length;n<i;++n)t[n].applyTransform(e);this.changed()}translate(e,t){const n=this.geometries_;for(let i=0,r=n.length;i<r;++i)n[i].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Pa(s){const e=[];for(let t=0,n=s.length;t<n;++t)e.push(s[t].clone());return e}const nh=Os;function ih(s,e,t,n,i,r,o){let a,l;const h=(t-e)/n;if(h===1)a=e;else if(h===2)a=e,l=i;else if(h!==0){let c=s[e],u=s[e+1],d=0;const f=[0];for(let y=e+n;y<t;y+=n){const E=s[y],w=s[y+1];d+=Math.sqrt((E-c)*(E-c)+(w-u)*(w-u)),f.push(d),c=E,u=w}const _=i*d,p=Oc(f,_);p<0?(l=(_-f[-p-2])/(f[-p-1]-f[-p-2]),a=e+(-p-2)*n):a=e+p*n}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?s[a+c]:$e(s[a+c],s[a+n+c],l);return r}function eo(s,e,t,n,i,r){if(t==e)return null;let o;if(i<s[e+n-1])return r?(o=s.slice(e,e+n),o[n-1]=i,o):null;if(s[t-1]<i)return r?(o=s.slice(t-n,t),o[n-1]=i,o):null;if(i==s[e+n-1])return s.slice(e,e+n);let a=e/n,l=t/n;for(;a<l;){const d=a+l>>1;i<s[(d+1)*n-1]?l=d:a=d+1}const h=s[a*n-1];if(i==h)return s.slice((a-1)*n,(a-1)*n+n);const c=s[(a+1)*n-1],u=(i-h)/(c-h);o=[];for(let d=0;d<n-1;++d)o.push($e(s[(a-1)*n+d],s[a*n+d],u));return o.push(i),o}function cf(s,e,t,n,i,r,o){if(o)return eo(s,e,t[t.length-1],n,i,r);let a;if(i<s[n-1])return r?(a=s.slice(0,n),a[n-1]=i,a):null;if(s[s.length-1]<i)return r?(a=s.slice(s.length-n),a[n-1]=i,a):null;for(let l=0,h=t.length;l<h;++l){const c=t[l];if(e!=c){if(i<s[e+n-1])return null;if(i<=s[c-1])return eo(s,e,c,n,i,!1);e=c}}return null}function sh(s,e,t,n){let i=s[e],r=s[e+1],o=0;for(let a=e+n;a<t;a+=n){const l=s[a],h=s[a+1];o+=Math.sqrt((l-i)*(l-i)+(h-r)*(h-r)),i=l,r=h}return o}class ks extends Qt{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){this.flatCoordinates?Lt(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()}clone(){const e=new ks(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,i){return i<vn(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ro(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Io(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,n,i))}forEachSegment(e){return kl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,eo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return Ht(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return ih(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=Do(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new ks(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Qs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Js(this.flatCoordinates,0,e,this.stride),this.changed()}}const mn=ks;class Ns extends Qt{constructor(e,t,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&n)this.setFlatCoordinates(t,e),this.ends_=n;else{let i=this.getLayout();const r=e,o=[],a=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];l===0&&(i=c.getLayout()),Lt(o,c.getFlatCoordinates()),a.push(o.length)}this.setFlatCoordinates(i,o),this.ends_=a}}appendLineString(e){this.flatCoordinates?Lt(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Ns(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,i){return i<vn(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(So(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),bo(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,n,i))}getCoordinateAtM(e,t,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,n=n!==void 0?n:!1,cf(this.flatCoordinates,0,this.ends_,this.stride,e,t,n))}getCoordinates(){return Ei(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new mn(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,n=this.layout,i=[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=new mn(e.slice(r,l),n);i.push(h),r=l}return i}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let n=0;const i=this.ends_,r=this.stride;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=ih(t,n,l,r,.5);Lt(e,h),n=l}return e}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=Cu(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,n),new Ns(t,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(e){return Mu(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Mo(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}const Wo=Ns;class zo extends Qt{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){this.flatCoordinates?Lt(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()}clone(){const e=new zo(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,i){if(i<vn(this.getExtent(),e,t))return i;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=Kt(e,t,r[a],r[a+1]);if(h<i){i=h;for(let c=0;c<o;++c)n[c]=r[a+c];n.length=o}}return i}getCoordinates(){return Ht(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return e<0||t<=e?null:new $t(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,n=this.stride,i=[];for(let r=0,o=e.length;r<o;r+=n){const a=new $t(e.slice(r,r+n),t);i.push(a)}return i}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,n=this.stride;for(let i=0,r=t.length;i<r;i+=n){const o=t[i],a=t[i+1];if(dl(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Js(this.flatCoordinates,0,e,this.stride),this.changed()}}const Yo=zo;function uf(s,e,t,n){const i=[];let r=at();for(let o=0,a=t.length;o<a;++o){const l=t[o];r=ul(s,e,l[0],n),i.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=l[l.length-1]}return i}class Gs extends Qt{constructor(e,t,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){let i=this.getLayout();const r=e,o=[],a=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];l===0&&(i=c.getLayout());const u=o.length,d=c.getEnds();for(let f=0,_=d.length;f<_;++f)d[f]+=u;Lt(o,c.getFlatCoordinates()),a.push(d)}t=i,e=o,n=a}t!==void 0&&n?(this.setFlatCoordinates(t,e),this.endss_=n):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;Lt(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let i=0,r=t.length;i<r;++i)t[i]+=n}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let i=0;i<e;++i)t[i]=this.endss_[i].slice();const n=new Gs(this.flatCoordinates.slice(),this.layout,t);return n.applyProperties(this),n}closestPointXY(e,t,n,i){return i<vn(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(xu(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),vu(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,n,i))}containsXY(e,t){return Iu(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return Ru(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Ta(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Vr(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=uf(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=bu(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Yo(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Pu(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Ta(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=Tu(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,n),new Gs(t,"XY",n)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const n=this.endss_[e].slice(),i=n[n.length-1];if(t!==0)for(let r=0,o=n.length;r<o;++r)n[r]-=t;return new Hn(this.flatCoordinates.slice(t,i),this.layout,n)}getPolygons(){const e=this.layout,t=this.flatCoordinates,n=this.endss_,i=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const c=new Hn(t.slice(r,h),e,l);i.push(c),r=h}return i}getType(){return"MultiPolygon"}intersectsExtent(e){return Lu(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=Eu(this.flatCoordinates,0,e,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const i=n[n.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}}const Uo=Gs;function df(s,e,t,n,i){rh(s,e,t||0,n||s.length-1,i||ff)}function rh(s,e,t,n,i){for(;n>t;){if(n-t>600){var r=n-t+1,o=e-t+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1),c=Math.max(t,Math.floor(e-o*l/r+h)),u=Math.min(n,Math.floor(e+(r-o)*l/r+h));rh(s,e,c,u,i)}var d=s[e],f=t,_=n;for(ii(s,t,e),i(s[n],d)>0&&ii(s,t,n);f<_;){for(ii(s,f,_),f++,_--;i(s[f],d)<0;)f++;for(;i(s[_],d)>0;)_--}i(s[t],d)===0?ii(s,t,_):(_++,ii(s,_,n)),_<=e&&(t=_+1),e<=_&&(n=_-1)}}function ii(s,e,t){var n=s[e];s[e]=s[t],s[t]=n}function ff(s,e){return s<e?-1:s>e?1:0}let oh=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!is(e,t))return n;const i=this.toBBox,r=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?i(a):a;is(e,l)&&(t.leaf?n.push(a):pr(e,l)?this._all(a,n):r.push(a))}t=r.pop()}return n}collides(e){let t=this.data;if(!is(e,t))return!1;const n=[];for(;t;){for(let i=0;i<t.children.length;i++){const r=t.children[i],o=t.leaf?this.toBBox(r):r;if(is(e,o)){if(t.leaf||pr(e,o))return!0;n.push(r)}}t=n.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let n=0;n<e.length;n++)this.insert(e[n]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const n=this.data;this.data=t,t=n}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Dn([]),this}remove(e,t){if(!e)return this;let n=this.data;const i=this.toBBox(e),r=[],o=[];let a,l,h;for(;n||r.length;){if(n||(n=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),n.leaf){const c=gf(e,n.children,t);if(c!==-1)return n.children.splice(c,1),r.push(n),this._condense(r),this}!h&&!n.leaf&&pr(n,i)?(r.push(n),o.push(a),a=0,l=n,n=n.children[0]):l?(a++,n=l.children[a],h=!1):n=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,i){const r=n-t+1;let o=this._maxEntries,a;if(r<=o)return a=Dn(e.slice(t,n+1)),Sn(a,this.toBBox),a;i||(i=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,i-1))),a=Dn([]),a.leaf=!1,a.height=i;const l=Math.ceil(r/o),h=l*Math.ceil(Math.sqrt(o));Fa(e,t,n,h,this.compareMinX);for(let c=t;c<=n;c+=h){const u=Math.min(c+h-1,n);Fa(e,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const f=Math.min(d+l-1,u);a.children.push(this._build(e,d,f,i-1))}}return Sn(a,this.toBBox),a}_chooseSubtree(e,t,n,i){for(;i.push(t),!(t.leaf||i.length-1===n);){let r=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],c=mr(h),u=pf(e,h)-c;u<o?(o=u,r=c<r?c:r,a=h):u===o&&c<r&&(r=c,a=h)}t=a||t.children[0]}return t}_insert(e,t,n){const i=n?e:this.toBBox(e),r=[],o=this._chooseSubtree(i,this.data,t,r);for(o.children.push(e),ai(o,i);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(i,r,t)}_split(e,t){const n=e[t],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);const o=this._chooseSplitIndex(n,r,i),a=Dn(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,Sn(n,this.toBBox),Sn(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)}_splitRoot(e,t){this.data=Dn([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Sn(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let i,r=1/0,o=1/0;for(let a=t;a<=n-t;a++){const l=oi(e,0,a,this.toBBox),h=oi(e,a,n,this.toBBox),c=yf(l,h),u=mr(l)+mr(h);c<r?(r=c,i=a,o=u<o?u:o):c===r&&u<o&&(o=u,i=a)}return i||n-t}_chooseSplitAxis(e,t,n){const i=e.leaf?this.compareMinX:_f,r=e.leaf?this.compareMinY:mf,o=this._allDistMargin(e,t,n,i),a=this._allDistMargin(e,t,n,r);o<a&&e.children.sort(i)}_allDistMargin(e,t,n,i){e.children.sort(i);const r=this.toBBox,o=oi(e,0,t,r),a=oi(e,n-t,n,r);let l=ns(o)+ns(a);for(let h=t;h<n-t;h++){const c=e.children[h];ai(o,e.leaf?r(c):c),l+=ns(o)}for(let h=n-t-1;h>=t;h--){const c=e.children[h];ai(a,e.leaf?r(c):c),l+=ns(a)}return l}_adjustParentBBoxes(e,t,n){for(let i=n;i>=0;i--)ai(t[i],e)}_condense(e){for(let t=e.length-1,n;t>=0;t--)e[t].children.length===0?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():Sn(e[t],this.toBBox)}};function gf(s,e,t){if(!t)return e.indexOf(s);for(let n=0;n<e.length;n++)if(t(s,e[n]))return n;return-1}function Sn(s,e){oi(s,0,s.children.length,e,s)}function oi(s,e,t,n,i){i||(i=Dn(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let r=e;r<t;r++){const o=s.children[r];ai(i,s.leaf?n(o):o)}return i}function ai(s,e){return s.minX=Math.min(s.minX,e.minX),s.minY=Math.min(s.minY,e.minY),s.maxX=Math.max(s.maxX,e.maxX),s.maxY=Math.max(s.maxY,e.maxY),s}function _f(s,e){return s.minX-e.minX}function mf(s,e){return s.minY-e.minY}function mr(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function ns(s){return s.maxX-s.minX+(s.maxY-s.minY)}function pf(s,e){return(Math.max(e.maxX,s.maxX)-Math.min(e.minX,s.minX))*(Math.max(e.maxY,s.maxY)-Math.min(e.minY,s.minY))}function yf(s,e){const t=Math.max(s.minX,e.minX),n=Math.max(s.minY,e.minY),i=Math.min(s.maxX,e.maxX),r=Math.min(s.maxY,e.maxY);return Math.max(0,i-t)*Math.max(0,r-n)}function pr(s,e){return s.minX<=e.minX&&s.minY<=e.minY&&e.maxX<=s.maxX&&e.maxY<=s.maxY}function is(s,e){return e.minX<=s.maxX&&e.minY<=s.maxY&&e.maxX>=s.minX&&e.maxY>=s.minY}function Dn(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Fa(s,e,t,n,i){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=n)continue;const o=e+Math.ceil((t-e)/n/2)*n;df(s,o,e,t,i),r.push(e,o,o,t)}}const pe={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class jo{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Mi(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new jo({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return X()}getImage(e){return X()}getHitDetectionImage(){return X()}getPixelRatio(e){return 1}getImageState(){return X()}getImageSize(){return X()}getOrigin(){return X()}getSize(){return X()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Mi(e)}listenImageChange(e){X()}load(){X()}unlistenImageChange(e){X()}}const ah=jo;function xt(s){return Array.isArray(s)?Yl(s):s}class Xo extends ah{constructor(e){const t=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:1,rotateWithView:t,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius!==void 0?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const e=this.getScale(),t=new Xo({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_;if(!e)return null;const t=this.getDisplacement(),n=this.getScaleArray();return[e[0]/2-t[0]/n[0],e[1]/2+t[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(e){let t=this.canvas_[e];if(!t){const n=this.renderOptions_,i=Le(n.size*e,n.size*e);this.draw_(n,i,e),t=i.canvas,this.canvas_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return pe.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,n){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let i=this.radius_,r=this.radius2_===void 0?i:this.radius2_;if(i<r){const M=i;i=r,r=M}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=i-h,u=Math.sqrt(l*l+c*c),d=u/l;if(e==="miter"&&d<=n)return d*t;const f=t/2/d,_=t/2*(c/u),y=Math.sqrt((i+f)*(i+f)+_*_)-i;if(this.radius2_===void 0||e==="bevel")return y*2;const E=i*Math.sin(a),w=Math.sqrt(i*i-E*E),v=r-w,R=Math.sqrt(E*E+v*v)/E;if(R<=n){const M=R*t/2-r-i;return 2*Math.max(y,M)}return y*2}createRenderOptions(){let e=Vn,t=0,n=null,i=0,r,o=0;this.stroke_&&(r=this.stroke_.getColor(),r===null&&(r=Si),r=xt(r),o=this.stroke_.getWidth(),o===void 0&&(o=bi),n=this.stroke_.getLineDash(),i=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),e===void 0&&(e=Vn),t=this.stroke_.getMiterLimit(),t===void 0&&(t=Ri));const a=this.calculateLineJoinSize_(e,o,t),l=Math.max(this.radius_,this.radius2_||0),h=Math.ceil(2*l+a);return{strokeStyle:r,strokeWidth:o,size:h,lineDash:n,lineDashOffset:i,lineJoin:e,miterLimit:t}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvas_={},this.size_=[e,e]}draw_(e,t,n){if(t.scale(n,n),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let i=this.fill_.getColor();i===null&&(i=At),t.fillStyle=xt(i),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){if(this.fill_){let t=this.fill_.getColor(),n=0;if(typeof t=="string"&&(t=Ms(t)),t===null?n=1:Array.isArray(t)&&(n=t.length===4?t[3]:1),n===0){const i=Le(e.size,e.size);this.hitDetectionCanvas_=i.canvas,this.drawHitDetectionCanvas_(e,i)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(e){let t=this.points_;const n=this.radius_;if(t===1/0)e.arc(0,0,n,0,2*Math.PI);else{const i=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=r+a*o,h=a%2===0?n:i;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=At,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}}const lh=Xo;class Ho extends lh{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Ho({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}const Vo=Ho;class Zo{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null}clone(){const e=this.getColor();return new Zo({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){this.color_=e}}const qe=Zo;class Ko{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Ko({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}const He=Ko;class Vt{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Oa,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new Vt({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Oa,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function xf(s){let e;if(typeof s=="function")e=s;else{let t;Array.isArray(s)?t=s:(ae(typeof s.getZIndex=="function",41),t=[s]),e=function(){return t}}return e}let yr=null;function vf(s,e){if(!yr){const t=new qe({color:"rgba(255,255,255,0.4)"}),n=new He({color:"#3399CC",width:1.25});yr=[new Vt({image:new Vo({fill:t,stroke:n,radius:5}),fill:t,stroke:n})]}return yr}function Ef(){const s={},e=[255,255,255,1],t=[0,153,255,1],n=3;return s.Polygon=[new Vt({fill:new qe({color:[255,255,255,.5]})})],s.MultiPolygon=s.Polygon,s.LineString=[new Vt({stroke:new He({color:e,width:n+2})}),new Vt({stroke:new He({color:t,width:n})})],s.MultiLineString=s.LineString,s.Circle=s.Polygon.concat(s.LineString),s.Point=[new Vt({image:new Vo({radius:n*2,fill:new qe({color:t}),stroke:new He({color:e,width:n/2})}),zIndex:1/0})],s.MultiPoint=s.Point,s.GeometryCollection=s.Polygon.concat(s.LineString,s.Point),s}function Oa(s){return s.getGeometry()}const lt=Vt;function hh(s,e,t){const n=s;let i=!0,r=!1,o=!1;const a=[Rs(n,Z.LOAD,function(){o=!0,r||e()})];return n.src&&Vc?(r=!0,n.decode().then(function(){i&&e()}).catch(function(l){i&&(o?e():t())})):a.push(Rs(n,Z.ERROR,t)),function(){i=!1,a.forEach(he)}}let si=null;class Cf extends Zs{constructor(e,t,n,i,r,o){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=r,this.size_=n,this.src_=t,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===pe.LOADED){si||(si=Le(1,1,void 0,{willReadFrequently:!0})),si.drawImage(this.image_,0,0);try{si.getImageData(0,0,1,1),this.tainted_=!1}catch{si=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Z.CHANGE)}handleImageError_(){this.imageState_=pe.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=pe.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],n=Le(e,t);n.fillRect(0,0,e,t),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===pe.IDLE){this.image_||this.initializeImage_(),this.imageState_=pe.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=hh(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==pe.LOADED)return;const t=this.image_,n=document.createElement("canvas");n.width=Math.ceil(t.width*e),n.height=Math.ceil(t.height*e);const i=n.getContext("2d");i.scale(e,e),i.drawImage(t,0,0),i.globalCompositeOperation="multiply",i.fillStyle=zl(this.color_),i.fillRect(0,0,n.width/e,n.height/e),i.globalCompositeOperation="destination-in",i.drawImage(t,0,0),this.canvas_[e]=n}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function wf(s,e,t,n,i,r){let o=Ds.get(e,n,r);return o||(o=new Cf(s,e,t,n,i,r),Ds.set(e,n,r,o)),o}function ka(s,e,t,n){return t!==void 0&&n!==void 0?[t/s,n/e]:t!==void 0?t/s:n!==void 0?n/e:1}class $o extends ah{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,n=e.rotation!==void 0?e.rotation:0,i=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:n,scale:i,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;this.imgSize_=e.imgSize;let a=e.src;ae(!(a!==void 0&&o),4),ae(!o||o&&this.imgSize_,5),(a===void 0||a.length===0)&&o&&(a=o.src||q(o)),ae(a!==void 0&&a.length>0,6),ae(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),69);const l=e.src!==void 0?pe.IDLE:pe.LOADED;if(this.color_=e.color!==void 0?Ms(e.color):null,this.iconImage_=wf(o,a,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,e.width!==void 0||e.height!==void 0){let h,c;if(e.size)[h,c]=e.size;else{const u=this.getImage(1);if(u instanceof HTMLCanvasElement||u.src&&u.complete)h=u.width,c=u.height;else{this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(ka(f[0],f[1],e.width,e.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(ka(h,c,e.width,e.height))}}clone(){let e,t,n;return this.initialOptions_?(t=this.initialOptions_.width,n=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new $o({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const i=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!i)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=i[0]),this.anchorYUnits_=="fraction"&&(e[1]*=i[1])}if(this.anchorOrigin_!="top-left"){if(!i)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+i[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+i[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),n=this.getScaleArray();return[e[0]-t[0]/n[0],e[1]+t[1]/n[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),n=this.iconImage_.getSize();if(!t||!n)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=n[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=n[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==pe.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==pe.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(Z.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(Z.CHANGE,e)}}const ch=$o,Tf="#333";class qo{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=Mi(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new qe({color:Tf}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding}clone(){const e=this.getScale();return new qo({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Mi(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const uh=qo;function Na(s){return new lt({fill:Di(s,""),stroke:Li(s,""),text:Rf(s),image:Sf(s)})}function Di(s,e){const t=s[e+"fill-color"];if(t)return new qe({color:t})}function Li(s,e){const t=s[e+"stroke-width"],n=s[e+"stroke-color"];if(!(!t&&!n))return new He({width:t,color:n,lineCap:s[e+"stroke-line-cap"],lineJoin:s[e+"stroke-line-join"],lineDash:s[e+"stroke-line-dash"],lineDashOffset:s[e+"stroke-line-dash-offset"],miterLimit:s[e+"stroke-miter-limit"]})}function Rf(s){const e=s["text-value"];return e?new uh({text:e,font:s["text-font"],maxAngle:s["text-max-angle"],offsetX:s["text-offset-x"],offsetY:s["text-offset-y"],overflow:s["text-overflow"],placement:s["text-placement"],repeat:s["text-repeat"],scale:s["text-scale"],rotateWithView:s["text-rotate-with-view"],rotation:s["text-rotation"],textAlign:s["text-align"],justify:s["text-justify"],textBaseline:s["text-baseline"],padding:s["text-padding"],fill:Di(s,"text-"),backgroundFill:Di(s,"text-background-"),stroke:Li(s,"text-"),backgroundStroke:Li(s,"text-background-")}):void 0}function Sf(s){const e=s["icon-src"],t=s["icon-img"];if(e||t)return new ch({src:e,img:t,imgSize:s["icon-img-size"],anchor:s["icon-anchor"],anchorOrigin:s["icon-anchor-origin"],anchorXUnits:s["icon-anchor-x-units"],anchorYUnits:s["icon-anchor-y-units"],color:s["icon-color"],crossOrigin:s["icon-cross-origin"],offset:s["icon-offset"],displacement:s["icon-displacement"],opacity:s["icon-opacity"],scale:s["icon-scale"],width:s["icon-width"],height:s["icon-height"],rotation:s["icon-rotation"],rotateWithView:s["icon-rotate-with-view"],size:s["icon-size"],declutterMode:s["icon-declutter-mode"]});const n=s["shape-points"];if(n){const r="shape-";return new lh({points:n,fill:Di(s,r),stroke:Li(s,r),radius:s["shape-radius"],radius1:s["shape-radius1"],radius2:s["shape-radius2"],angle:s["shape-angle"],displacement:s["shape-displacement"],rotation:s["shape-rotation"],rotateWithView:s["shape-rotate-with-view"],scale:s["shape-scale"],declutterMode:s["shape-declutter-mode"]})}const i=s["circle-radius"];if(i){const r="circle-";return new Vo({radius:i,fill:Di(s,r),stroke:Li(s,r),displacement:s["circle-displacement"],scale:s["circle-scale"],rotation:s["circle-rotation"],rotateWithView:s["circle-rotate-with-view"],declutterMode:s["circle-declutter-mode"]})}}const Ga={RENDER_ORDER:"renderOrder"};class If extends er{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter!==void 0?e.declutter:!1,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Ga.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e){e.declutterTree||(e.declutterTree=new oh(9)),this.getRenderer().renderDeclutter(e)}setRenderOrder(e){this.set(Ga.RENDER_ORDER,e)}setStyle(e){let t;if(e===void 0)t=vf;else if(e===null)t=null;else if(typeof e=="function")t=e;else if(e instanceof lt)t=e;else if(Array.isArray(e)){const n=e.length,i=new Array(n);for(let r=0;r<n;++r){const o=e[r];o instanceof lt?i[r]=o:i[r]=Na(o)}t=i}else t=Na(e);this.style_=t,this.styleFunction_=e===null?void 0:xf(this.style_),this.changed()}}const Jo=If,Ui={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ss=[Ui.FILL],Zt=[Ui.STROKE],fn=[Ui.BEGIN_PATH],Ba=[Ui.CLOSE_PATH],Y=Ui;class bf{drawCustom(e,t,n,i){}drawGeometry(e){}setStyle(e){}drawCircle(e,t){}drawFeature(e,t){}drawGeometryCollection(e,t){}drawLineString(e,t){}drawMultiLineString(e,t){}drawMultiPoint(e,t){}drawMultiPolygon(e,t){}drawPoint(e,t){}drawPolygon(e,t){}drawText(e,t){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const dh=bf;class Mf extends dh{constructor(e,t,n,i){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(n){return n*t})}appendFlatPointCoordinates(e,t){const n=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=e.length;a<l;a+=t)i[0]=e[a],i[1]=e[a+1],yo(n,i)&&(r[o++]=i[0],r[o++]=i[1]);return o}appendFlatLineCoordinates(e,t,n,i,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=i);let c=e[t],u=e[t+1];const d=this.tmpCoordinate_;let f=!0,_,p,y;for(_=t+i;_<n;_+=i)d[0]=e[_],d[1]=e[_+1],y=Cc(h,d),y!==p?(f&&(a[l++]=c,a[l++]=u,f=!1),a[l++]=d[0],a[l++]=d[1]):y===wc.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,c=d[0],u=d[1],p=y;return(r&&f||_===t+i)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(e,t,n,i,r){for(let o=0,a=n.length;o<a;++o){const l=n[o],h=this.appendFlatLineCoordinates(e,t,l,i,!1,!1);r.push(h),t=l}return t}drawCustom(e,t,n,i){this.beginGeometry(e,t);const r=e.getType(),o=e.getStride(),a=this.coordinates.length;let l,h,c,u,d;switch(r){case"MultiPolygon":l=e.getOrientedFlatCoordinates(),u=[];const f=e.getEndss();d=0;for(let _=0,p=f.length;_<p;++_){const y=[];d=this.drawCustomCoordinates_(l,d,f[_],o,y),u.push(y)}this.instructions.push([Y.CUSTOM,a,u,e,n,Vr]),this.hitDetectionInstructions.push([Y.CUSTOM,a,u,e,i||n,Vr]);break;case"Polygon":case"MultiLineString":c=[],l=r=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,e.getEnds(),o,c),this.instructions.push([Y.CUSTOM,a,c,e,n,Ei]),this.hitDetectionInstructions.push([Y.CUSTOM,a,c,e,i||n,Ei]);break;case"LineString":case"Circle":l=e.getFlatCoordinates(),h=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([Y.CUSTOM,a,h,e,n,Ht]),this.hitDetectionInstructions.push([Y.CUSTOM,a,h,e,i||n,Ht]);break;case"MultiPoint":l=e.getFlatCoordinates(),h=this.appendFlatPointCoordinates(l,o),h>a&&(this.instructions.push([Y.CUSTOM,a,h,e,n,Ht]),this.hitDetectionInstructions.push([Y.CUSTOM,a,h,e,i||n,Ht]));break;case"Point":l=e.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),h=this.coordinates.length,this.instructions.push([Y.CUSTOM,a,h,e,n]),this.hitDetectionInstructions.push([Y.CUSTOM,a,h,e,i||n]);break}this.endGeometry(t)}beginGeometry(e,t){this.beginGeometryInstruction1_=[Y.BEGIN_GEOMETRY,t,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Y.BEGIN_GEOMETRY,t,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const n=e.length;let i,r,o=-1;for(t=0;t<n;++t)i=e[t],r=i[0],r==Y.END_GEOMETRY?o=t:r==Y.BEGIN_GEOMETRY&&(i[2]=t,kc(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const n=this.state;if(e){const i=e.getColor();n.fillStyle=xt(i||At)}else n.fillStyle=void 0;if(t){const i=t.getColor();n.strokeStyle=xt(i||Si);const r=t.getLineCap();n.lineCap=r!==void 0?r:Ls;const o=t.getLineDash();n.lineDash=o?o.slice():wi;const a=t.getLineDashOffset();n.lineDashOffset=a||Ti;const l=t.getLineJoin();n.lineJoin=l!==void 0?l:Vn;const h=t.getWidth();n.lineWidth=h!==void 0?h:bi;const c=t.getMiterLimit();n.miterLimit=c!==void 0?c:Ri,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(e){const t=e.fillStyle,n=[Y.SET_FILL_STYLE,t];return typeof t!="string"&&n.push(!0),n}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Y.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const n=e.fillStyle;(typeof n!="string"||e.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=n)}updateStrokeStyle(e,t){const n=e.strokeStyle,i=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=n||e.currentLineCap!=i||r!=e.currentLineDash&&!Ft(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(n!==void 0&&t.call(this,e),e.currentStrokeStyle=n,e.currentLineCap=i,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[Y.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=_l(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;Xs(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const ji=Mf;class Df extends ji{constructor(e,t,n,i){super(e,t,n,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const n=e.getFlatCoordinates(),i=e.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,i);this.instructions.push([Y.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Y.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const n=e.getFlatCoordinates(),i=e.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,i);this.instructions.push([Y.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Y.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const n=e.getAnchor(),i=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=i[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const Lf=Df;class Af extends ji{constructor(e,t,n,i){super(e,t,n,i)}drawFlatCoordinates_(e,t,n,i){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,n,i,!1,!1),a=[Y.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(e,t){const n=this.state,i=n.strokeStyle,r=n.lineWidth;if(i===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,wi,Ti],fn);const o=e.getFlatCoordinates(),a=e.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(Zt),this.endGeometry(t)}drawMultiLineString(e,t){const n=this.state,i=n.strokeStyle,r=n.lineWidth;if(i===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],fn);const o=e.getEnds(),a=e.getFlatCoordinates(),l=e.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinates_(a,h,o[c],l);this.hitDetectionInstructions.push(Zt),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Zt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Zt),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(fn)}}const Pf=Af;class Ff extends ji{constructor(e,t,n,i){super(e,t,n,i)}drawFlatCoordinatess_(e,t,n,i){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=n.length;this.instructions.push(fn),this.hitDetectionInstructions.push(fn);for(let h=0;h<l;++h){const c=n[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,c,i,!0,!a),f=[Y.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(Ba),this.hitDetectionInstructions.push(Ba)),t=c}return o&&(this.instructions.push(ss),this.hitDetectionInstructions.push(ss)),a&&(this.instructions.push(Zt),this.hitDetectionInstructions.push(Zt)),t}drawCircle(e,t){const n=this.state,i=n.fillStyle,r=n.strokeStyle;if(i===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([Y.SET_FILL_STYLE,At]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=e.getFlatCoordinates(),a=e.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[Y.CIRCLE,l];this.instructions.push(fn,h),this.hitDetectionInstructions.push(fn,h),n.fillStyle!==void 0&&(this.instructions.push(ss),this.hitDetectionInstructions.push(ss)),n.strokeStyle!==void 0&&(this.instructions.push(Zt),this.hitDetectionInstructions.push(Zt)),this.endGeometry(t)}drawPolygon(e,t){const n=this.state,i=n.fillStyle,r=n.strokeStyle;if(i===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([Y.SET_FILL_STYLE,At]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=e.getEnds(),a=e.getOrientedFlatCoordinates(),l=e.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(t)}drawMultiPolygon(e,t){const n=this.state,i=n.fillStyle,r=n.strokeStyle;if(i===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([Y.SET_FILL_STYLE,At]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Y.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=e.getEndss(),a=e.getOrientedFlatCoordinates(),l=e.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinatess_(a,h,o[c],l);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let n=0,i=t.length;n<i;++n)t[n]=an(t[n],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}const Wa=Ff;function Of(s,e,t,n,i){const r=[];let o=t,a=0,l=e.slice(t,2);for(;a<s&&o+i<n;){const[h,c]=l.slice(-2),u=e[o+i],d=e[o+i+1],f=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=f,a>=s){const _=(s-a+f)/f,p=$e(h,u,_),y=$e(c,d,_);l.push(p,y),r.push(l),l=[p,y],a==s&&(o+=i),a=0}else if(a<s)l.push(e[o+i],e[o+i+1]),o+=i;else{const _=f-a,p=$e(h,u,_/f),y=$e(c,d,_/f);l.push(p,y),r.push(l),l=[p,y],a=0,o+=i}}return a>0&&r.push(l),r}function kf(s,e,t,n,i){let r=t,o=t,a=0,l=0,h=t,c,u,d,f,_,p,y,E,w,v;for(u=t;u<n;u+=i){const C=e[u],R=e[u+1];_!==void 0&&(w=C-_,v=R-p,f=Math.sqrt(w*w+v*v),y!==void 0&&(l+=d,c=Math.acos((y*w+E*v)/(d*f)),c>s&&(l>a&&(a=l,r=h,o=u),l=0,h=u-i)),d=f,y=w,E=v),_=C,p=R}return l+=f,l>a?[h,u]:[r,o]}const _i={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Nf extends ji{constructor(e,t,n,i){super(e,t,n,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t){const n=this.textFillState_,i=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!n&&!i)return;const o=this.coordinates;let a=o.length;const l=e.getType();let h=null,c=e.getStride();if(r.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!je(this.getBufferedMaxExtent(),e.getExtent()))return;let u;if(h=e.getFlatCoordinates(),l=="LineString")u=[h.length];else if(l=="MultiLineString")u=e.getEnds();else if(l=="Polygon")u=e.getEnds().slice(0,1);else if(l=="MultiPolygon"){const p=e.getEndss();u=[];for(let y=0,E=p.length;y<E;++y)u.push(p[y][0])}this.beginGeometry(e,t);const d=r.repeat,f=d?void 0:r.textAlign;let _=0;for(let p=0,y=u.length;p<y;++p){let E;d?E=Of(d*this.resolution,h,_,u[p],c):E=[h.slice(_,u[p])];for(let w=0,v=E.length;w<v;++w){const C=E[w];let R=0,M=C.length;if(f==null){const L=kf(r.maxAngle,C,0,C.length,2);R=L[0],M=L[1]}for(let L=R;L<M;L+=c)o.push(C[L],C[L+1]);const A=o.length;_=u[p],this.drawChars_(a,A),a=A}}this.endGeometry(t)}else{let u=r.overflow?null:[];switch(l){case"Point":case"MultiPoint":h=e.getFlatCoordinates();break;case"LineString":h=e.getFlatMidpoint();break;case"Circle":h=e.getCenter();break;case"MultiLineString":h=e.getFlatMidpoints(),c=2;break;case"Polygon":h=e.getFlatInteriorPoint(),r.overflow||u.push(h[2]/this.resolution),c=3;break;case"MultiPolygon":const y=e.getFlatInteriorPoints();h=[];for(let E=0,w=y.length;E<w;E+=3)r.overflow||u.push(y[E+2]/this.resolution),h.push(y[E],y[E+1]);if(h.length===0)return;c=2;break}const d=this.appendFlatPointCoordinates(h,c);if(d===a)return;if(u&&(d-a)/2!==h.length/c){let y=a/2;u=u.filter((E,w)=>{const v=o[(y+w)*2]===h[w*c]&&o[(y+w)*2+1]===h[w*c+1];return v||--y,v})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t);let f=r.padding;if(f!=dn&&(r.scale[0]<0||r.scale[1]<0)){let y=r.padding[0],E=r.padding[1],w=r.padding[2],v=r.padding[3];r.scale[0]<0&&(E=-E,v=-v),r.scale[1]<0&&(y=-y,w=-w),f=[y,E,w,v]}const _=this.pixelRatio;this.instructions.push([Y.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,f==dn?dn:f.map(function(y){return y*_}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);const p=1/_;this.hitDetectionInstructions.push([Y.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,void 0,this.declutterImageWithText_,f,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,n=this.textFillState_,i=this.strokeKey_;e&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||Ii,justify:t.justify,textBaseline:t.textBaseline||As,scale:t.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(e,t){const n=this.textStrokeState_,i=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=_i[i.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=n?n.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([Y.DRAW_CHARS,e,t,h,i.overflow,a,i.maxAngle,l,c,r,d*l,u,o,1]),this.hitDetectionInstructions.push([Y.DRAW_CHARS,e,t,h,i.overflow,a,i.maxAngle,1,c,r,d,u,o,1/l])}setTextStyle(e,t){let n,i,r;if(!e)this.text_="";else{const o=e.getFill();o?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=xt(o.getColor()||At)):(i=null,this.textFillState_=i);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const _=a.getLineDash(),p=a.getLineDashOffset(),y=a.getWidth(),E=a.getMiterLimit();r.lineCap=a.getLineCap()||Ls,r.lineDash=_?_.slice():wi,r.lineDashOffset=p===void 0?Ti:p,r.lineJoin=a.getLineJoin()||Vn,r.lineWidth=y===void 0?bi:y,r.miterLimit=E===void 0?Ri:E,r.strokeStyle=xt(a.getColor()||Si)}n=this.textState_;const l=e.getFont()||jl;nd(l);const h=e.getScaleArray();n.overflow=e.getOverflow(),n.font=l,n.maxAngle=e.getMaxAngle(),n.placement=e.getPlacement(),n.textAlign=e.getTextAlign(),n.repeat=e.getRepeat(),n.justify=e.getJustify(),n.textBaseline=e.getTextBaseline()||As,n.backgroundFill=e.getBackgroundFill(),n.backgroundStroke=e.getBackgroundStroke(),n.padding=e.getPadding()||dn,n.scale=h===void 0?[1,1]:h;const c=e.getOffsetX(),u=e.getOffsetY(),d=e.getRotateWithView(),f=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=f===void 0?0:f,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:q(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=i?typeof i.fillStyle=="string"?i.fillStyle:"|"+q(i.fillStyle):""}this.declutterImageWithText_=t}}const Gf={Circle:Wa,Default:ji,Image:Lf,LineString:Pf,Polygon:Wa,Text:Nf};class Bf{constructor(e,t,n,i){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=i,this.resolution_=n,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const n=this.buildersByZIndex_[t];for(const i in n){const r=n[i].finish();e[t][i]=r}}return e}getBuilder(e,t){const n=e!==void 0?e.toString():"0";let i=this.buildersByZIndex_[n];i===void 0&&(i={},this.buildersByZIndex_[n]=i);let r=i[t];if(r===void 0){const o=Gf[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[t]=r}return r}}const za=Bf;class Wf extends Tl{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return X()}getData(e){return null}prepareFrame(e){return X()}renderFrame(e,t){return X()}loadedTileCallback(e,t,n){e[t]||(e[t]={}),e[t][n.tileCoord.toString()]=n}createLoadedTileFinder(e,t,n){return(i,r)=>{const o=this.loadedTileCallback.bind(this,n,i);return e.forEachLoadedTile(t,i,r,o)}}forEachFeatureAtCoordinate(e,t,n,i,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){e.target.getState()===pe.LOADED&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=pe.LOADED&&t!=pe.ERROR&&e.addEventListener(Z.CHANGE,this.boundHandleImageChange_),t==pe.IDLE&&(e.load(),t=e.getState()),t==pe.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const fh=Wf,Ya=[];let Ln=null;function zf(){Ln=Le(1,1,void 0,{willReadFrequently:!0})}class Yf extends fh{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Se(),this.pixelTransform=Se(),this.inversePixelTransform=Se(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,n){Ln||zf(),Ln.clearRect(0,0,1,1);let i;try{Ln.drawImage(e,t,n,1,1,0,0,1,1),i=Ln.getImageData(0,0,1,1).data}catch{return Ln=null,null}return i}getBackground(e){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(e.viewState.resolution)),n||void 0}useContainer(e,t,n){const i=this.getLayer().getClassName();let r,o;if(e&&e.className===i&&(!n||e&&e.style.backgroundColor&&Ft(Ms(e.style.backgroundColor),Ms(n)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){r=document.createElement("div"),r.className=i;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=Le();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const i=Hs(n),r=pl(n),o=yl(n),a=xl(n);xe(t.coordinateToPixelTransform,i),xe(t.coordinateToPixelTransform,r),xe(t.coordinateToPixelTransform,o),xe(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;xe(l,i),xe(l,r),xe(l,o),xe(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,n){const i=this.getLayer();if(i.hasListener(e)){const r=new gi(e,this.inversePixelTransform,n,t);i.dispatchEvent(r)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(Ue.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Ue.POSTRENDER,e,t)}getRenderTransform(e,t,n,i,r,o,a){const l=r/2,h=o/2,c=i/t,u=-c,d=-e[0]+a,f=-e[1];return vt(this.tempTransform,l,h,c,u,-n,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const gh=Yf;function Uf(s,e,t,n,i,r,o,a,l,h,c,u){let d=s[e],f=s[e+1],_=0,p=0,y=0,E=0;function w(){_=d,p=f,e+=n,d=s[e],f=s[e+1],E+=y,y=Math.sqrt((d-_)*(d-_)+(f-p)*(f-p))}do w();while(e<t-n&&E+y<r);let v=y===0?0:(r-E)/y;const C=$e(_,d,v),R=$e(p,f,v),M=e-n,A=E,L=r+a*l(h,i,c);for(;e<t-n&&E+y<L;)w();v=y===0?0:(L-E)/y;const B=$e(_,d,v),W=$e(p,f,v);let ee;if(u){const k=[C,R,B,W];To(k,0,4,2,u,k,k),ee=k[0]>k[2]}else ee=C>B;const $=Math.PI,U=[],_e=M+n===e;e=M,y=0,E=A,d=s[e],f=s[e+1];let V;if(_e){w(),V=Math.atan2(f-p,d-_),ee&&(V+=V>0?-$:$);const k=(B+C)/2,P=(W+R)/2;return U[0]=[k,P,(L-r)/2,V,i],U}i=i.replace(/\n/g," ");for(let k=0,P=i.length;k<P;){w();let O=Math.atan2(f-p,d-_);if(ee&&(O+=O>0?-$:$),V!==void 0){let ne=O-V;if(ne+=ne>$?-2*$:ne<-$?2*$:0,Math.abs(ne)>o)return null}V=O;const J=k;let ie=0;for(;k<P;++k){const ne=ee?P-k-1:k,te=a*l(h,i[ne],c);if(e+n<t&&E+y<r+ie+te/2)break;ie+=te}if(k===J)continue;const fe=ee?i.substring(P-J,P-k):i.substring(J,k);v=y===0?0:(r+ie/2-E)/y;const I=$e(_,d,v),Ae=$e(p,f,v);U.push([I,Ae,ie/2,O,fe]),r+=ie}return U}const In=at(),Wt=[],Tt=[],Rt=[],zt=[];function Ua(s){return s[3].declutterBox}const jf=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function ja(s,e){return(e==="start"||e==="end")&&!jf.test(s)&&(e=e==="start"?"left":"right"),_i[e]}function Xf(s,e,t){return t>0&&s.push(`
`,""),s.push(e,""),s}class Hf{constructor(e,t,n,i){this.overlaps=n,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=Se(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={}}createLabel(e,t,n,i){const r=e+t+n+i;if(this.labels_[r])return this.labels_[r];const o=i?this.strokeStates[i]:null,a=n?this.fillStates[n]:null,l=this.textStates[t],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=Array.isArray(e),d=l.justify?_i[l.justify]:ja(Array.isArray(e)?e[0]:e,l.textAlign||Ii),f=i&&o.lineWidth?o.lineWidth:0,_=u?e:e.split(`
`).reduce(Xf,[]),{width:p,height:y,widths:E,heights:w,lineWidths:v}=sd(l,_),C=p+f,R=[],M=(C+2)*c[0],A=(y+f)*c[1],L={width:M<0?Math.floor(M):Math.ceil(M),height:A<0?Math.floor(A):Math.ceil(A),contextInstructions:R};(c[0]!=1||c[1]!=1)&&R.push("scale",c),i&&(R.push("strokeStyle",o.strokeStyle),R.push("lineWidth",f),R.push("lineCap",o.lineCap),R.push("lineJoin",o.lineJoin),R.push("miterLimit",o.miterLimit),R.push("setLineDash",[o.lineDash]),R.push("lineDashOffset",o.lineDashOffset)),n&&R.push("fillStyle",a.fillStyle),R.push("textBaseline","middle"),R.push("textAlign","center");const B=.5-d;let W=d*C+B*f;const ee=[],$=[];let U=0,_e=0,V=0,k=0,P;for(let O=0,J=_.length;O<J;O+=2){const ie=_[O];if(ie===`
`){_e+=U,U=0,W=d*C+B*f,++k;continue}const fe=_[O+1]||l.font;fe!==P&&(i&&ee.push("font",fe),n&&$.push("font",fe),P=fe),U=Math.max(U,w[V]);const I=[ie,W+B*E[V]+d*(E[V]-v[k]),.5*(f+U)+_e];W+=E[V],i&&ee.push("strokeText",I),n&&$.push("fillText",I),++V}return Array.prototype.push.apply(R,ee),Array.prototype.push.apply(R,$),this.labels_[r]=L,L}replayTextBackground_(e,t,n,i,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,n),e.lineTo.apply(e,i),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,n,i,r,o,a,l,h,c,u,d,f,_,p,y){a*=d[0],l*=d[1];let E=n-a,w=i-l;const v=r+h>e?e-h:r,C=o+c>t?t-c:o,R=_[3]+v*d[0]+_[1],M=_[0]+C*d[1]+_[2],A=E-_[3],L=w-_[0];(p||u!==0)&&(Wt[0]=A,zt[0]=A,Wt[1]=L,Tt[1]=L,Tt[0]=A+R,Rt[0]=Tt[0],Rt[1]=L+M,zt[1]=Rt[1]);let B;return u!==0?(B=vt(Se(),n,i,1,1,u,-n,-i),xe(B,Wt),xe(B,Tt),xe(B,Rt),xe(B,zt),Ts(Math.min(Wt[0],Tt[0],Rt[0],zt[0]),Math.min(Wt[1],Tt[1],Rt[1],zt[1]),Math.max(Wt[0],Tt[0],Rt[0],zt[0]),Math.max(Wt[1],Tt[1],Rt[1],zt[1]),In)):Ts(Math.min(A,A+R),Math.min(L,L+M),Math.max(A,A+R),Math.max(L,L+M),In),f&&(E=Math.round(E),w=Math.round(w)),{drawImageX:E,drawImageY:w,drawImageW:v,drawImageH:C,originX:h,originY:c,declutterBox:{minX:In[0],minY:In[1],maxX:In[2],maxY:In[3],value:y},canvasTransform:B,scale:d}}replayImageOrLabel_(e,t,n,i,r,o,a){const l=!!(o||a),h=i.declutterBox,c=e.canvas,u=a?a[2]*i.scale[0]/2:0;return h.minX-u<=c.width/t&&h.maxX+u>=0&&h.minY-u<=c.height/t&&h.maxY+u>=0&&(l&&this.replayTextBackground_(e,Wt,Tt,Rt,zt,o,a),rd(e,i.canvasTransform,r,n,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(e){if(this.alignFill_){const t=xe(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;e.save(),e.translate(t[0]%n,t[1]%n),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,n,i){const r=this.textStates[t],o=this.createLabel(e,t,i,n),a=this.strokeStates[n],l=this.pixelRatio,h=ja(Array.isArray(e)?e[0]:e,r.textAlign||Ii),c=_i[r.textBaseline||As],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*r.scale[0],f=h*d+2*(.5-h)*u,_=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:f,anchorY:_}}execute_(e,t,n,i,r,o,a,l){let h;this.pixelCoordinates_&&Ft(n,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=_n(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),lu(this.renderedTransform_,n));let c=0;const u=i.length;let d=0,f,_,p,y,E,w,v,C,R,M,A,L,B=0,W=0,ee=null,$=null;const U=this.coordinateCache_,_e=this.viewRotation_,V=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,k={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:_e},P=this.instructions!=i||this.overlaps?0:200;let O,J,ie,fe;for(;c<u;){const I=i[c];switch(I[0]){case Y.BEGIN_GEOMETRY:O=I[1],fe=I[3],O.getGeometry()?a!==void 0&&!je(a,fe.getExtent())?c=I[2]+1:++c:c=I[2];break;case Y.BEGIN_PATH:B>P&&(this.fill_(e),B=0),W>P&&(e.stroke(),W=0),!B&&!W&&(e.beginPath(),y=NaN,E=NaN),++c;break;case Y.CIRCLE:d=I[1];const ne=h[d],te=h[d+1],Je=h[d+2],Pe=h[d+3],ue=Je-ne,Ge=Pe-te,Ot=Math.sqrt(ue*ue+Ge*Ge);e.moveTo(ne+Ot,te),e.arc(ne,te,Ot,0,2*Math.PI,!0),++c;break;case Y.CLOSE_PATH:e.closePath(),++c;break;case Y.CUSTOM:d=I[1],f=I[2];const en=I[3],et=I[4],En=I.length==6?I[5]:void 0;k.geometry=en,k.feature=O,c in U||(U[c]=[]);const ct=U[c];En?En(h,d,f,2,ct):(ct[0]=h[d],ct[1]=h[d+1],ct.length=2),et(ct,k),++c;break;case Y.DRAW_IMAGE:d=I[1],f=I[2],C=I[3],_=I[4],p=I[5];let kt=I[6];const ut=I[7],tn=I[8],nn=I[9],Et=I[10];let Nt=I[11];const ei=I[12];let Te=I[13];const Ie=I[14],Be=I[15];if(!C&&I.length>=20){R=I[19],M=I[20],A=I[21],L=I[22];const m=this.drawLabelWithPointPlacement_(R,M,A,L);C=m.label,I[3]=C;const x=I[23];_=(m.anchorX-x)*this.pixelRatio,I[4]=_;const T=I[24];p=(m.anchorY-T)*this.pixelRatio,I[5]=p,kt=C.height,I[6]=kt,Te=C.width,I[13]=Te}let We;I.length>25&&(We=I[25]);let Gt,dt,ft;I.length>17?(Gt=I[16],dt=I[17],ft=I[18]):(Gt=dn,dt=!1,ft=!1),Et&&V?Nt+=_e:!Et&&!V&&(Nt-=_e);let Ct=0;for(;d<f;d+=2){if(We&&We[Ct++]<Te/this.pixelRatio)continue;const m=this.calculateImageOrLabelDimensions_(C.width,C.height,h[d],h[d+1],Te,kt,_,p,tn,nn,Nt,ei,r,Gt,dt||ft,O),x=[e,t,C,m,ut,dt?ee:null,ft?$:null];if(l){if(Ie==="none")continue;if(Ie==="obstacle"){l.insert(m.declutterBox);continue}else{let T,S;if(Be){const b=f-d;if(!Be[b]){Be[b]=x;continue}if(T=Be[b],delete Be[b],S=Ua(T),l.collides(S))continue}if(l.collides(m.declutterBox))continue;T&&(l.insert(S),this.replayImageOrLabel_.apply(this,T)),l.insert(m.declutterBox)}}this.replayImageOrLabel_.apply(this,x)}++c;break;case Y.DRAW_CHARS:const Cn=I[1],Re=I[2],wn=I[3],rr=I[4];L=I[5];const or=I[6],ce=I[7],Tn=I[8];A=I[9];const sn=I[10];R=I[11],M=I[12];const $i=[I[13],I[13]],Bt=this.textStates[M],wt=Bt.font,Fe=[Bt.scale[0]*ce,Bt.scale[1]*ce];let rn;wt in this.widths_?rn=this.widths_[wt]:(rn={},this.widths_[wt]=rn);const qi=sh(h,Cn,Re,2),g=Math.abs(Fe[0])*La(wt,R,rn);if(rr||g<=qi){const m=this.textStates[M].textAlign,x=(qi-g)*_i[m],T=Uf(h,Cn,Re,2,R,x,or,Math.abs(Fe[0]),La,wt,rn,V?0:this.viewRotation_);e:if(T){const S=[];let b,j,F,z,D;if(A)for(b=0,j=T.length;b<j;++b){D=T[b],F=D[4],z=this.createLabel(F,M,"",A),_=D[2]+(Fe[0]<0?-sn:sn),p=wn*z.height+(.5-wn)*2*sn*Fe[1]/Fe[0]-Tn;const G=this.calculateImageOrLabelDimensions_(z.width,z.height,D[0],D[1],z.width,z.height,_,p,0,0,D[3],$i,!1,dn,!1,O);if(l&&l.collides(G.declutterBox))break e;S.push([e,t,z,G,1,null,null])}if(L)for(b=0,j=T.length;b<j;++b){D=T[b],F=D[4],z=this.createLabel(F,M,L,""),_=D[2],p=wn*z.height-Tn;const G=this.calculateImageOrLabelDimensions_(z.width,z.height,D[0],D[1],z.width,z.height,_,p,0,0,D[3],$i,!1,dn,!1,O);if(l&&l.collides(G.declutterBox))break e;S.push([e,t,z,G,1,null,null])}l&&l.load(S.map(Ua));for(let G=0,le=S.length;G<le;++G)this.replayImageOrLabel_.apply(this,S[G])}}++c;break;case Y.END_GEOMETRY:if(o!==void 0){O=I[1];const m=o(O,fe);if(m)return m}++c;break;case Y.FILL:P?B++:this.fill_(e),++c;break;case Y.MOVE_TO_LINE_TO:for(d=I[1],f=I[2],J=h[d],ie=h[d+1],w=J+.5|0,v=ie+.5|0,(w!==y||v!==E)&&(e.moveTo(J,ie),y=w,E=v),d+=2;d<f;d+=2)J=h[d],ie=h[d+1],w=J+.5|0,v=ie+.5|0,(d==f-2||w!==y||v!==E)&&(e.lineTo(J,ie),y=w,E=v);++c;break;case Y.SET_FILL_STYLE:ee=I,this.alignFill_=I[2],B&&(this.fill_(e),B=0,W&&(e.stroke(),W=0)),e.fillStyle=I[1],++c;break;case Y.SET_STROKE_STYLE:$=I,W&&(e.stroke(),W=0),this.setStrokeStyle_(e,I),++c;break;case Y.STROKE:P?W++:e.stroke(),++c;break;default:++c;break}}B&&this.fill_(e),W&&e.stroke()}execute(e,t,n,i,r,o){this.viewRotation_=i,this.execute_(e,t,n,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,n,i,r){return this.viewRotation_=n,this.execute_(e,1,t,this.hitDetectionInstructions,!0,i,r)}}const Vf=Hf,xr=["Polygon","Circle","LineString","Image","Text","Default"];class Zf{constructor(e,t,n,i,r,o){this.maxExtent_=e,this.overlaps_=i,this.pixelRatio_=n,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Se(),this.createExecutors_(r)}clip(e,t){const n=this.getClipCoords(t);e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(n[2],n[3]),e.lineTo(n[4],n[5]),e.lineTo(n[6],n[7]),e.clip()}createExecutors_(e){for(const t in e){let n=this.executorsByZIndex_[t];n===void 0&&(n={},this.executorsByZIndex_[t]=n);const i=e[t];for(const r in i){const o=i[r];n[r]=new Vf(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const n=this.executorsByZIndex_[t];for(let i=0,r=e.length;i<r;++i)if(e[i]in n)return!0}return!1}forEachFeatureAtCoordinate(e,t,n,i,r,o){i=Math.round(i);const a=i*2+1,l=vt(this.hitDetectionTransform_,i+.5,i+.5,1/t,-1/t,-n,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Le(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=at(),ps(u,e),Xs(u,t*(this.renderBuffer_+i),u));const d=Kf(i);let f;function _(R,M){const A=c.getImageData(0,0,a,a).data;for(let L=0,B=d.length;L<B;L++)if(A[d[L]]>0){if(!o||f!=="Image"&&f!=="Text"||o.includes(R)){const W=(d[L]-3)/4,ee=i-W%a,$=i-(W/a|0),U=r(R,M,ee*ee+$*$);if(U)return U}c.clearRect(0,0,a,a);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(yn);let y,E,w,v,C;for(y=p.length-1;y>=0;--y){const R=p[y].toString();for(w=this.executorsByZIndex_[R],E=xr.length-1;E>=0;--E)if(f=xr[E],v=w[f],v!==void 0&&(C=v.executeHitDetection(c,l,n,_,u),C))return C}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const n=t[0],i=t[1],r=t[2],o=t[3],a=[n,i,n,o,r,o,r,i];return _n(a,0,8,2,e,a),a}isEmpty(){return Xn(this.executorsByZIndex_)}execute(e,t,n,i,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(yn),this.maxExtent_&&(e.save(),this.clip(e,n)),o=o||xr;let h,c,u,d,f,_;for(a&&l.reverse(),h=0,c=l.length;h<c;++h){const p=l[h].toString();for(f=this.executorsByZIndex_[p],u=0,d=o.length;u<d;++u){const y=o[u];_=f[y],_!==void 0&&_.execute(e,t,n,i,r,a)}}this.maxExtent_&&e.restore()}}const vr={};function Kf(s){if(vr[s]!==void 0)return vr[s];const e=s*2+1,t=s*s,n=new Array(t+1);for(let r=0;r<=s;++r)for(let o=0;o<=s;++o){const a=r*r+o*o;if(a>t)break;let l=n[a];l||(l=[],n[a]=l),l.push(((s+r)*e+(s+o))*4+3),r>0&&l.push(((s-r)*e+(s+o))*4+3),o>0&&(l.push(((s+r)*e+(s-o))*4+3),r>0&&l.push(((s-r)*e+(s-o))*4+3))}const i=[];for(let r=0,o=n.length;r<o;++r)n[r]&&i.push(...n[r]);return vr[s]=i,i}const Xa=Zf;class $f extends dh{constructor(e,t,n,i,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=n,this.transform_=i,this.transformRotation_=i?vl(Math.atan2(i[1],i[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Se()}drawImages_(e,t,n,i){if(!this.image_)return;const r=_n(e,t,n,i,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const _=d+this.imageAnchorX_,p=f+this.imageAnchorY_;vt(a,_,p,1,1,h,-_,-p),o.setTransform.apply(o,a),o.translate(_,p),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,n,i){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=_n(e,t,n,i,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<n;t+=i){const l=r[t]+this.textOffsetX_,h=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,n,i,r){const o=this.context_,a=_n(e,t,n,i,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),n}drawRings_(e,t,n,i){for(let r=0,o=n.length;r<o;++r)t=this.moveToLineTo_(e,t,n[r],i,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!je(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=yu(e,this.transform_,this.pixelCoordinates_),n=t[2]-t[0],i=t[3]-t[1],r=Math.sqrt(n*n+i*i),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const n=t.getGeometryFunction()(e);n&&(this.setStyle(t),this.drawGeometry(n))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let n=0,i=t.length;n<i;++n)this.drawGeometry(t[n])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),this.text_!==""&&this.drawText_(t,0,t.length,n)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),this.text_!==""&&this.drawText_(t,0,t.length,n)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!je(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(n,0,n.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(je(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,i=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();n.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(i,r,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=e.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!je(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!je(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getOrientedFlatCoordinates();let i=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];i=this.drawRings_(n,i,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,n=this.contextFillState_;n?n.fillStyle!=e.fillStyle&&(n.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=e.lineCap&&(n.lineCap=e.lineCap,t.lineCap=e.lineCap),Ft(n.lineDash,e.lineDash)||t.setLineDash(n.lineDash=e.lineDash),n.lineDashOffset!=e.lineDashOffset&&(n.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),n.lineJoin!=e.lineJoin&&(n.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),n.lineWidth!=e.lineWidth&&(n.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),n.miterLimit!=e.miterLimit&&(n.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),n.strokeStyle!=e.strokeStyle&&(n.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,n=this.contextTextState_,i=e.textAlign?e.textAlign:Ii;n?(n.font!=e.font&&(n.font=e.font,t.font=e.font),n.textAlign!=i&&(n.textAlign=i,t.textAlign=i),n.textBaseline!=e.textBaseline&&(n.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=i,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:i,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const n=e.getColor();this.fillState_={fillStyle:xt(n||At)}}if(!t)this.strokeState_=null;else{const n=t.getColor(),i=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),c=r||wi;this.strokeState_={lineCap:i!==void 0?i:Ls,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||Ti)*this.pixelRatio_,lineJoin:a!==void 0?a:Vn,lineWidth:(l!==void 0?l:bi)*this.pixelRatio_,miterLimit:h!==void 0?h:Ri,strokeStyle:xt(n||Si)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const n=e.getPixelRatio(this.pixelRatio_),i=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*n,this.imageAnchorY_=i[1]*n,this.imageHeight_=t[1]*n,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=t[0]*n}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:xt(f||At)}}const n=e.getStroke();if(!n)this.textStrokeState_=null;else{const f=n.getColor(),_=n.getLineCap(),p=n.getLineDash(),y=n.getLineDashOffset(),E=n.getLineJoin(),w=n.getWidth(),v=n.getMiterLimit();this.textStrokeState_={lineCap:_!==void 0?_:Ls,lineDash:p||wi,lineDashOffset:y||Ti,lineJoin:E!==void 0?E:Vn,lineWidth:w!==void 0?w:bi,miterLimit:v!==void 0?v:Ri,strokeStyle:xt(f||Si)}}const i=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),c=e.getText(),u=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:i!==void 0?i:jl,textAlign:u!==void 0?u:Ii,textBaseline:d!==void 0?d:As},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,_,p)=>f+=p%2?" ":_,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const qf=$f,pt=.5;function Jf(s,e,t,n,i,r,o){const a=s[0]*pt,l=s[1]*pt,h=Le(a,l);h.imageSmoothingEnabled=!1;const c=h.canvas,u=new qf(h,pt,i,null,o),d=t.length,f=Math.floor((256*256*256-1)/d),_={};for(let y=1;y<=d;++y){const E=t[y-1],w=E.getStyleFunction()||n;if(!n)continue;let v=w(E,r);if(!v)continue;Array.isArray(v)||(v=[v]);const R=(y*f).toString(16).padStart(7,"#00000");for(let M=0,A=v.length;M<A;++M){const L=v[M],B=L.getGeometryFunction()(E);if(!B||!je(i,B.getExtent()))continue;const W=L.clone(),ee=W.getFill();ee&&ee.setColor(R);const $=W.getStroke();$&&($.setColor(R),$.setLineDash(null)),W.setText(void 0);const U=L.getImage();if(U&&U.getOpacity()!==0){const P=U.getImageSize();if(!P)continue;const O=Le(P[0],P[1],void 0,{alpha:!1}),J=O.canvas;O.fillStyle=R,O.fillRect(0,0,J.width,J.height),W.setImage(new ch({img:J,imgSize:P,anchor:U.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:U.getOrigin(),opacity:1,size:U.getSize(),scale:U.getScale(),rotation:U.getRotation(),rotateWithView:U.getRotateWithView()}))}const _e=W.getZIndex()||0;let V=_[_e];V||(V={},_[_e]=V,V.Polygon=[],V.Circle=[],V.LineString=[],V.Point=[]);const k=B.getType();if(k==="GeometryCollection"){const P=B.getGeometriesArrayRecursive();for(let O=0,J=P.length;O<J;++O){const ie=P[O];V[ie.getType().replace("Multi","")].push(ie,W)}}else V[k.replace("Multi","")].push(B,W)}}const p=Object.keys(_).map(Number).sort(yn);for(let y=0,E=p.length;y<E;++y){const w=_[p[y]];for(const v in w){const C=w[v];for(let R=0,M=C.length;R<M;R+=2){u.setStyle(C[R+1]);for(let A=0,L=e.length;A<L;++A)u.setTransform(e[A]),u.drawGeometry(C[R])}}}return h.getImageData(0,0,c.width,c.height)}function Qf(s,e,t){const n=[];if(t){const i=Math.floor(Math.round(s[0])*pt),r=Math.floor(Math.round(s[1])*pt),o=(ye(i,0,t.width-1)+ye(r,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],c=t.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/e.length);c&&c%u===0&&n.push(e[c/u-1])}return n}const eg=.5,_h={Point:hg,LineString:og,Polygon:ug,MultiPoint:cg,MultiLineString:ag,MultiPolygon:lg,GeometryCollection:rg,Circle:ig};function tg(s,e){return parseInt(q(s),10)-parseInt(q(e),10)}function ng(s,e){const t=to(s,e);return t*t}function to(s,e){return eg*s/e}function ig(s,e,t,n,i){const r=t.getFill(),o=t.getStroke();if(r||o){const l=s.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(e,n)}const a=t.getText();if(a&&a.getText()){const l=(i||s).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n)}}function Ha(s,e,t,n,i,r,o){let a=!1;const l=t.getImage();if(l){const h=l.getImageState();h==pe.LOADED||h==pe.ERROR?l.unlistenImageChange(i):(h==pe.IDLE&&l.load(),l.listenImageChange(i),a=!0)}return sg(s,e,t,n,r,o),a}function sg(s,e,t,n,i,r){const o=t.getGeometryFunction()(e);if(!o)return;const a=o.simplifyTransformed(n,i);if(t.getRenderer())mh(s,a,t,e);else{const h=_h[a.getType()];h(s,a,t,e,r)}}function mh(s,e,t,n){if(e.getType()=="GeometryCollection"){const r=e.getGeometries();for(let o=0,a=r.length;o<a;++o)mh(s,r[o],t,n);return}s.getBuilder(t.getZIndex(),"Default").drawCustom(e,n,t.getRenderer(),t.getHitDetectionRenderer())}function rg(s,e,t,n,i){const r=e.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o){const l=_h[r[o].getType()];l(s,r[o],t,n,i)}}function og(s,e,t,n,i){const r=t.getStroke();if(r){const a=s.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,n)}const o=t.getText();if(o&&o.getText()){const a=(i||s).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,n)}}function ag(s,e,t,n,i){const r=t.getStroke();if(r){const a=s.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,n)}const o=t.getText();if(o&&o.getText()){const a=(i||s).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,n)}}function lg(s,e,t,n,i){const r=t.getFill(),o=t.getStroke();if(o||r){const l=s.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(e,n)}const a=t.getText();if(a&&a.getText()){const l=(i||s).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n)}}function hg(s,e,t,n,i){const r=t.getImage(),o=t.getText();let a;if(r){if(r.getImageState()!=pe.LOADED)return;let l=s;if(i){const c=r.getDeclutterMode();if(c!=="none")if(l=i,c==="obstacle"){const u=s.getBuilder(t.getZIndex(),"Image");u.setImageStyle(r,a),u.drawPoint(e,n)}else o&&o.getText()&&(a={})}const h=l.getBuilder(t.getZIndex(),"Image");h.setImageStyle(r,a),h.drawPoint(e,n)}if(o&&o.getText()){let l=s;i&&(l=i);const h=l.getBuilder(t.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,n)}}function cg(s,e,t,n,i){const r=t.getImage(),o=t.getText();let a;if(r){if(r.getImageState()!=pe.LOADED)return;let l=s;if(i){const c=r.getDeclutterMode();if(c!=="none")if(l=i,c==="obstacle"){const u=s.getBuilder(t.getZIndex(),"Image");u.setImageStyle(r,a),u.drawMultiPoint(e,n)}else o&&o.getText()&&(a={})}const h=l.getBuilder(t.getZIndex(),"Image");h.setImageStyle(r,a),h.drawMultiPoint(e,n)}if(o&&o.getText()){let l=s;i&&(l=i);const h=l.getBuilder(t.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,n)}}function ug(s,e,t,n,i){const r=t.getFill(),o=t.getStroke();if(r||o){const l=s.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(e,n)}const a=t.getText();if(a&&a.getText()){const l=(i||s).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n)}}class dg extends gh{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=at(),this.wrappedRenderedExtent_=at(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,n){const i=t.extent,r=t.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=t.pixelRatio,f=t.viewHints,_=!(f[Ce.ANIMATING]||f[Ce.INTERACTING]),p=this.compositionContext_,y=Math.round(t.size[0]*d),E=Math.round(t.size[1]*d),w=u.getWrapX()&&l.canWrapX(),v=w?we(c):null,C=w?Math.ceil((i[2]-c[2])/v)+1:1;let R=w?Math.floor((i[0]-c[0])/v):0;do{const M=this.getRenderTransform(o,a,h,d,y,E,R*v);e.execute(p,1,M,h,_,void 0,n)}while(++R<C)}setupCompositionContext_(){if(this.opacity_!==1){const e=Le(this.context.canvas.width,this.context.canvas.height,Ya);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,$s(this.compositionContext_),Ya.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const n=e.pixelRatio,i=e.layerStatesArray[e.layerIndex];uu(this.pixelTransform,1/n,1/n),qs(this.inversePixelTransform,this.pixelTransform);const r=Ml(this.pixelTransform);this.useContainer(t,r,this.getBackground(e));const o=this.context,a=o.canvas,l=this.replayGroup_,h=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!h||h.isEmpty()))return null;const c=Math.round(e.size[0]*n),u=Math.round(e.size[1]*n);a.width!=c||a.height!=u?(a.width=c,a.height=u,a.style.transform!==r&&(a.style.transform=r)):this.containerReused||o.clearRect(0,0,c,u),this.preRender(o,e);const d=e.viewState,f=d.projection;this.opacity_=i.opacity,this.setupCompositionContext_();let _=!1,p=!0;if(i.extent&&this.clipping){const y=cn(i.extent,f);p=je(y,e.extent),_=p&&!hn(y,e.extent),_&&this.clipUnrotated(this.compositionContext_,e,y)}return p&&this.renderWorlds(l,e),_&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];xe(this.pixelTransform,n);const i=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=n[0]*pt,d=n[1]*pt;c.push(this.getRenderTransform(i,r,o,pt,u,d,0).slice());const f=h.getSource(),_=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!hn(_,l)){let p=l[0];const y=we(_);let E=0,w;for(;p<_[0];)--E,w=y*E,c.push(this.getRenderTransform(i,r,o,pt,u,d,w).slice()),p+=y;for(E=0,p=l[2];p>_[2];)++E,w=y*E,c.push(this.getRenderTransform(i,r,o,pt,u,d,w).slice()),p-=y}this.hitDetectionImageData_=Jf(n,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o)}t(Qf(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,n,i,r){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},c=function(f,_,p){const y=q(f),E=h[y];if(E){if(E!==!0&&p<E.distanceSq){if(p===0)return h[y]=!0,r.splice(r.lastIndexOf(E),1),i(f,l,_);E.geometry=_,E.distanceSq=p}}else{if(p===0)return h[y]=!0,i(f,l,_);r.push(h[y]={feature:f,layer:l,geometry:_,distanceSq:p,callback:i})}};let u;const d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some(f=>u=f.forEachFeatureAtCoordinate(e,o,a,n,c,f===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map(_=>_.value):null)),u}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),n=t.getSource();if(!n)return!1;const i=e.viewHints[Ce.ANIMATING],r=e.viewHints[Ce.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&i||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,c=h.projection,u=h.resolution,d=e.pixelRatio,f=t.getRevision(),_=t.getRenderBuffer();let p=t.getRenderOrder();p===void 0&&(p=tg);const y=h.center.slice(),E=Xs(l,_*u),w=E.slice(),v=[E.slice()],C=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!hn(C,e.extent)){const k=we(C),P=Math.max(we(E)/2,k);E[0]=C[0]-P,E[2]=C[2]+P,fo(y,c);const O=Tc(v[0],c);O[0]<C[0]&&O[2]<C[2]?v.push([O[0]+k,O[1],O[2]+k,O[3]]):O[0]>C[0]&&O[2]>C[2]&&v.push([O[0]-k,O[1],O[2]-k,O[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==p&&hn(this.wrappedRenderedExtent_,E))return Ft(this.renderedExtent_,w)||(this.hitDetectionImageData_=null,this.renderedExtent_=w),this.renderedCenter_=y,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const R=new za(to(u,d),E,u,d);let M;this.getLayer().getDeclutter()&&(M=new za(to(u,d),E,u,d));const A=js();let L;if(A){for(let k=0,P=v.length;k<P;++k){const O=v[k],J=Yr(O,c);n.loadFeatures(J,Rc(u,c),A)}L=Br(A,c)}else for(let k=0,P=v.length;k<P;++k)n.loadFeatures(v[k],u,c);const B=ng(u,d);let W=!0;const ee=k=>{let P;const O=k.getStyleFunction()||t.getStyleFunction();if(O&&(P=O(k,u)),P){const J=this.renderFeature(k,B,P,R,L,M);W=W&&!J}},$=Yr(E,c),U=n.getFeaturesInExtent($);p&&U.sort(p);for(let k=0,P=U.length;k<P;++k)ee(U[k]);this.renderedFeatures_=U,this.ready=W;const _e=R.finish(),V=new Xa(E,u,d,n.getOverlaps(),_e,t.getRenderBuffer());return M&&(this.declutterExecutorGroup=new Xa(E,u,d,n.getOverlaps(),M.finish(),t.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=p,this.renderedExtent_=w,this.wrappedRenderedExtent_=E,this.renderedCenter_=y,this.renderedProjection_=c,this.replayGroup_=V,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,n,i,r,o){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,h=n.length;l<h;++l)a=Ha(i,e,n[l],t,this.boundHandleStyleImageChange_,r,o)||a;else a=Ha(i,e,n,t,this.boundHandleStyleImageChange_,r,o);return a}}const fg=dg;class gg extends Jo{constructor(e){super(e)}createRenderer(){return new fg(this)}}const Xi=gg;class _g{constructor(e){this.rbush_=new oh(e),this.items_={}}insert(e,t){const n={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(n),this.items_[q(t)]=n}load(e,t){const n=new Array(t.length);for(let i=0,r=t.length;i<r;i++){const o=e[i],a=t[i],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[i]=l,this.items_[q(a)]=l}this.rbush_.load(n)}remove(e){const t=q(e),n=this.items_[t];return delete this.items_[t],this.rbush_.remove(n)!==null}update(e,t){const n=this.items_[q(t)],i=[n.minX,n.minY,n.maxX,n.maxY];Wn(i,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(i){return i.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let n;for(let i=0,r=e.length;i<r;i++)if(n=t(e[i]),n)return n;return n}isEmpty(){return Xn(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return Ts(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const Va=_g;class mg extends ht{constructor(e){super(),this.projection=ot(e.projection),this.attributions_=Za(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(n,i){t.viewResolver=n,t.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Za(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Za(s){return s?Array.isArray(s)?function(e){return s}:typeof s=="function"?s:function(e){return[s]}:null}const pg=mg,ke={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function yg(s,e){return[[-1/0,-1/0,1/0,1/0]]}let xg=!1;function vg(s,e,t,n,i,r,o){const a=new XMLHttpRequest;a.open("GET",typeof s=="function"?s(t,n,i):s,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=xg,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();let c;h=="json"||h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?r(e.readFeatures(c,{extent:t,featureProjection:i}),e.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function Ka(s,e){return function(t,n,i,r,o){const a=this;vg(s,e,t,n,i,function(l,h){a.addFeatures(l),r!==void 0&&r(l)},o||jn)}}class Yt extends Pt{constructor(e,t,n){super(e),this.feature=t,this.features=n}}class Eg extends pg{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=jn,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(ae(this.format_,7),this.loader_=Ka(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:yg;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new Va:null,this.loadedExtentsRtree_=new Va,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,i;Array.isArray(e.features)?i=e.features:e.features&&(n=e.features,i=n.getArray()),!t&&n===void 0&&(n=new yt(i)),i!==void 0&&this.addFeaturesInternal(i),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=q(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const n=e.getGeometry();if(n){const i=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Yt(ke.ADDFEATURE,e))}setupChangeEvents_(e,t){this.featureChangeKeys_[e]=[K(t,Z.CHANGE,this.handleFeatureChange_,this),K(t,Yn.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(e,t){let n=!0;const i=t.getId();return i!==void 0&&(i.toString()in this.idIndex_?n=!1:this.idIndex_[i.toString()]=t),n&&(ae(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),n}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],n=[],i=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=q(a);this.addToIndex_(l,a)&&n.push(a)}for(let r=0,o=n.length;r<o;r++){const a=n[r],l=q(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();t.push(c),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,i),this.hasListener(ke.ADDFEATURE))for(let r=0,o=n.length;r<o;r++)this.dispatchEvent(new Yt(ke.ADDFEATURE,n[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(ke.ADDFEATURE,function(n){t||(t=!0,e.push(n.feature),t=!1)}),this.addEventListener(ke.REMOVEFEATURE,function(n){t||(t=!0,e.remove(n.feature),t=!1)}),e.addEventListener(Ye.ADD,n=>{t||(t=!0,this.addFeature(n.element),t=!1)}),e.addEventListener(Ye.REMOVE,n=>{t||(t=!0,this.removeFeature(n.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(he);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=i=>{this.removeFeatureInternal(i)};this.featuresRtree_.forEach(n);for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Yt(ke.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const n=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(n,function(i){if(i.getGeometry().intersectsCoordinate(e))return t(i)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(n){if(n.getGeometry().intersectsExtent(e)){const r=t(n);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),Xn(this.nullGeometryFeatures_)||Lt(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(n){t.push(n)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const i=Sc(e,t);return[].concat(...i.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const n=e[0],i=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||Un,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const c=h.getGeometry(),u=a;if(a=c.closestPointXY(n,i,o,a),a<u){r=h;const d=Math.sqrt(a);l[0]=n-d,l[1]=i-d,l[2]=n+d,l[3]=i+d}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,n=q(t),i=t.getGeometry();if(!i)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[n]=t);else{const o=i.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[n]=t;this.changed(),this.dispatchEvent(new Yt(ke.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:q(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Xn(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,n){const i=this.loadedExtentsRtree_,r=this.strategy_(e,t,n);for(let o=0,a=r.length;o<a;++o){const l=r[o];i.forEachInExtent(l,function(c){return hn(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Yt(ke.FEATURESLOADSTART)),this.loader_.call(this,l,t,n,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new Yt(ke.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Yt(ke.FEATURESLOADERROR))}),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let n;t.forEachInExtent(e,function(i){if(Wn(i.extent,e))return n=i,!0}),n&&t.remove(n)}removeFeature(e){if(!e)return;const t=q(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=q(e),n=this.featureChangeKeys_[t];if(!n)return;n.forEach(he),delete this.featureChangeKeys_[t];const i=e.getId();return i!==void 0&&delete this.idIndex_[i.toString()],delete this.uidIndex_[t],this.dispatchEvent(new Yt(ke.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const n in this.idIndex_)if(this.idIndex_[n]===e){delete this.idIndex_[n],t=!0;break}return t}setLoader(e){this.loader_=e}setUrl(e){ae(this.format_,7),this.url_=e,this.setLoader(Ka(e,this.format_))}}const Qn=Eg,rs={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class os extends Pt{constructor(e,t){super(e),this.feature=t}}function Cg(s,e){const t=[];for(let n=0;n<e.length;++n){const r=e[n].getGeometry();ph(s,r,t)}return t}function as(s,e){return Kt(s[0],s[1],e[0],e[1])}function An(s,e){const t=s.length;return e<0?s[e+t]:e>=t?s[e-t]:s[e]}function ls(s,e,t){let n,i;e<t?(n=e,i=t):(n=t,i=e);const r=Math.ceil(n),o=Math.floor(i);if(r>o){const l=Pn(s,n),h=Pn(s,i);return as(l,h)}let a=0;if(n<r){const l=Pn(s,n),h=An(s,r);a+=as(l,h)}if(o<i){const l=An(s,o),h=Pn(s,i);a+=as(l,h)}for(let l=r;l<o-1;++l){const h=An(s,l),c=An(s,l+1);a+=as(h,c)}return a}function ph(s,e,t){if(e instanceof mn){hs(s,e.getCoordinates(),!1,t);return}if(e instanceof Wo){const n=e.getCoordinates();for(let i=0,r=n.length;i<r;++i)hs(s,n[i],!1,t);return}if(e instanceof Hn){const n=e.getCoordinates();for(let i=0,r=n.length;i<r;++i)hs(s,n[i],!0,t);return}if(e instanceof Uo){const n=e.getCoordinates();for(let i=0,r=n.length;i<r;++i){const o=n[i];for(let a=0,l=o.length;a<l;++a)hs(s,o[a],!0,t)}return}if(e instanceof nh){const n=e.getGeometries();for(let i=0;i<n.length;++i)ph(s,n[i],t);return}}const Er={index:-1,endIndex:NaN};function wg(s,e,t,n){const i=s[0],r=s[1];let o=1/0,a=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const d=e.targets[u],f=d.coordinates;let _=1/0,p;for(let y=0;y<f.length-1;++y){const E=f[y],w=f[y+1],v=yh(i,r,E,w);v.squaredDistance<_&&(_=v.squaredDistance,p=y+v.along)}_<o&&(o=_,d.ring&&e.targetIndex===u&&(d.endIndex>d.startIndex?p<d.startIndex&&(p+=f.length):d.endIndex<d.startIndex&&p>d.startIndex&&(p-=f.length)),l=p,a=u)}const h=e.targets[a];let c=h.ring;if(e.targetIndex===a&&c){const u=Pn(h.coordinates,l),d=t.getPixelFromCoordinate(u);El(d,e.startPx)>n&&(c=!1)}if(c){const u=h.coordinates,d=u.length,f=h.startIndex,_=l;if(f<_){const p=ls(u,f,_);ls(u,f,_-d)<p&&(l-=d)}else{const p=ls(u,f,_);ls(u,f,_+d)<p&&(l+=d)}}return Er.index=a,Er.endIndex=l,Er}function hs(s,e,t,n){const i=s[0],r=s[1];for(let o=0,a=e.length-1;o<a;++o){const l=e[o],h=e[o+1],c=yh(i,r,l,h);if(c.squaredDistance===0){const u=o+c.along;n.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}const Cr={along:0,squaredDistance:0};function yh(s,e,t,n){const i=t[0],r=t[1],o=n[0],a=n[1],l=o-i,h=a-r;let c=0,u=i,d=r;return(l!==0||h!==0)&&(c=ye(((s-i)*l+(e-r)*h)/(l*l+h*h),0,1),u+=l*c,d+=h*c),Cr.along=c,Cr.squaredDistance=vl(Kt(s,e,u,d),10),Cr}function Pn(s,e){const t=s.length;let n=Math.floor(e);const i=e-n;n>=t?n-=t:n<0&&(n+=t);let r=n+1;r>=t&&(r-=t);const o=s[n],a=o[0],l=o[1],h=s[r],c=h[0]-a,u=h[1]-l;return[a+c*i,l+u*i]}class Tg extends Jn{constructor(e){const t=e;t.stopDown||(t.stopDown=Kn),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=Sg(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Un,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let n=e.geometryFunction;if(!n){const i=this.mode_;if(i==="Circle")n=function(r,o,a){const l=o||new lf([NaN,NaN]),h=it(r[0],a),c=Ic(h,it(r[r.length-1],a));l.setCenterAndRadius(h,Math.sqrt(c),this.geometryLayout_);const u=js();return u&&l.transform(a,u),l};else{let r;i==="Point"?r=$t:i==="LineString"?r=mn:i==="Polygon"&&(r=Hn),n=function(o,a,l){return a?i==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new r(o,this.geometryLayout_),a}}}this.geometryFunction_=n,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Xi({source:new Qn({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:Rg(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Go,this.freehandCondition_,e.freehand?this.freehandCondition_=Qr:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Zl,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(qr.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Qr:t=e:t=Dd,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===Z.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===oe.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===oe.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===oe.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===oe.POINTERDOWN?n=!1:t&&this.getPointerCount()<2?(n=e.type===oe.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===oe.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===oe.DBLCLICK&&(n=!1),super.handleEvent(e)&&n}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new bt(oe.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),n=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),i=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=Xr([n,i]),o=this.traceSource_.getFeaturesInExtent(r);if(o.length===0)return;const a=Cg(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,i=e.startIndex<=t;n===i?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const i=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),n=r-i+1}else{const i=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),n=i-r+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,t,n){if(t===n)return;const i=[];if(t<n){const r=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let a=r;a<=o;++a)i.push(An(e.coordinates,a))}else{const r=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let a=r;a>=o;--a)i.push(An(e.coordinates,a))}i.length&&this.appendCoordinates(i)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&El(t.startPx,e.pixel)<this.snapTolerance_)return;const n=wg(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[n.index];this.addTracedCoordinates_(a,a.startIndex,n.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,n.endIndex)}t.targetIndex=n.index;const i=t.targets[t.targetIndex];i.endIndex=n.endIndex;const r=Pn(i.coordinates,i.endIndex),o=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const i=!this.finishCoordinate_;i&&this.startDrawing_(e.coordinate),!i&&this.freehand_?this.finishDrawing():!this.freehand_&&(!i||this.mode_==="Point")&&(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,n=e.pixel,i=t[0]-n[0],r=t[1]-n[1],o=i*i+r*r;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let n=!1;if(this.sketchFeature_){let i=!1,r=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")n=!0;else if(o==="Circle")n=this.sketchCoords_.length===2;else if(o==="LineString")i=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;i=a[0].length>this.minPoints_,r=[a[0][0],a[0][a[0].length-2]],t?r=[a[0][0]]:r=[a[0][0],a[0][a[0].length-2]]}if(i){const a=this.getMap();for(let l=0,h=r.length;l<h;l++){const c=r[l],u=a.getPixelFromCoordinate(c),d=e[0]-u[0],f=e[1]-u[1],_=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(d*d+f*f)<=_,n){this.finishCoordinate_=c;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Xt(new $t(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Xt);const t=e.getLinearRing(0);let n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),n.changed()):(n=new mn(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(e){const t=this.getMap().getView().getProjection(),n=Is(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Xt(new mn(this.sketchLineCoords_)));const i=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Xt,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new os(rs.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),n=this.sketchFeature_.getGeometry(),i=t.getView().getProjection(),r=Is(this.geometryLayout_);let o,a;for(;e.length<r;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,n,i),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),n.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();let i,r;const o=this.mode_;o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():i=!0),r.push(e.slice()),this.geometryFunction_(r,t,n)):o==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():i=!0),r.push(e.slice()),i&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,n)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),i&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),i=this.mode_;for(let r=0;r<e;++r){let o;if(i==="LineString"||i==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,t,n),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(i==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,n)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const n=e.getGeometry(),i=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,n,i)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,n,i),t=n.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new Yo([t])):this.type_==="MultiLineString"?e.setGeometry(new Wo([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Uo([t])),this.dispatchEvent(new os(rs.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new os(rs.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,n=!this.sketchFeature_;n&&this.startDrawing_(e[0]);let i;if(t==="LineString"||t==="Circle")i=this.sketchCoords_;else if(t==="Polygon")i=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;n&&i.shift(),i.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const r=e[e.length-1];this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const n=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=n.getCoordinates();const i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new Xt(new $t(i)),this.updateSketchFeatures_(),this.dispatchEvent(new os(rs.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function Rg(){const s=Ef();return function(e,t){return s[e.getGeometry().getType()]}}function Sg(s){switch(s){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+s)}}const Ig=Tg;class bg{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let n=t.dataProjection?ot(t.dataProjection):this.readProjection(e);t.extent&&n&&n.getUnits()==="tile-pixels"&&(n=ot(n),n.setWorldExtent(t.extent)),t={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)}getType(){return X()}readFeature(e,t){return X()}readFeatures(e,t){return X()}readGeometry(e,t){return X()}readProjection(e){return X()}writeFeature(e,t){return X()}writeFeatures(e,t){return X()}writeGeometry(e,t){return X()}}function xh(s,e,t){const n=t?ot(t.featureProjection):null,i=t?ot(t.dataProjection):null;let r;if(n&&i&&!bc(n,i)?r=(e?s.clone():s).transform(e?n:i,e?i:n):r=s,e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===s&&(r=s.clone()),r.applyTransform(a)}return r}class Mg extends bg{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(cs(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(cs(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return X()}readFeaturesFromObject(e,t){return X()}readGeometry(e,t){return this.readGeometryFromObject(cs(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return X()}readProjection(e){return this.readProjectionFromObject(cs(e))}readProjectionFromObject(e){return X()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return X()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return X()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return X()}}function cs(s){if(typeof s=="string"){const e=JSON.parse(s);return e||null}return s!==null?s:null}const Dg=Mg;class Lg extends Dg{constructor(e){e=e||{},super(),this.dataProjection=ot(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=ot(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let n=null;e.type==="Feature"?n=e:n={type:"Feature",geometry:e,properties:null};const i=no(n.geometry,t),r=new Xt;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&r.setGeometryName(n.geometry_name),r.setGeometry(i),"id"in n&&r.setId(n.id),n.properties&&r.setProperties(n.properties,!0),r}readFeaturesFromObject(e,t){const n=e;let i=null;if(n.type==="FeatureCollection"){const r=e;i=[];const o=r.features;for(let a=0,l=o.length;a<l;++a)i.push(this.readFeatureFromObject(o[a],t))}else i=[this.readFeatureFromObject(e,t)];return i}readGeometryFromObject(e,t){return no(e,t)}readProjectionFromObject(e){const t=e.crs;let n;return t?t.type=="name"?n=ot(t.properties.name):t.type==="EPSG"?n=ot("EPSG:"+t.properties.code):ae(!1,36):n=this.dataProjection,n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:"Feature",geometry:null,properties:null},i=e.getId();if(i!==void 0&&(n.id=i),!e.hasProperties())return n;const r=e.getProperties(),o=e.getGeometry();return o&&(n.geometry=io(o,t),delete r[e.getGeometryName()]),Xn(r)||(n.properties=r),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let i=0,r=e.length;i<r;++i)n.push(this.writeFeatureObject(e[i],t));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,t){return io(e,this.adaptOptions(t))}}function no(s,e){if(!s)return null;let t;switch(s.type){case"Point":{t=Pg(s);break}case"LineString":{t=Fg(s);break}case"Polygon":{t=Gg(s);break}case"MultiPoint":{t=kg(s);break}case"MultiLineString":{t=Og(s);break}case"MultiPolygon":{t=Ng(s);break}case"GeometryCollection":{t=Ag(s);break}default:throw new Error("Unsupported GeoJSON type: "+s.type)}return xh(t,!1,e)}function Ag(s,e){const t=s.geometries.map(function(n){return no(n,e)});return new nh(t)}function Pg(s){return new $t(s.coordinates)}function Fg(s){return new mn(s.coordinates)}function Og(s){return new Wo(s.coordinates)}function kg(s){return new Yo(s.coordinates)}function Ng(s){return new Uo(s.coordinates)}function Gg(s){return new Hn(s.coordinates)}function io(s,e){s=xh(s,!0,e);const t=s.getType();let n;switch(t){case"Point":{n=jg(s);break}case"LineString":{n=Wg(s);break}case"Polygon":{n=Xg(s,e);break}case"MultiPoint":{n=Yg(s);break}case"MultiLineString":{n=zg(s);break}case"MultiPolygon":{n=Ug(s,e);break}case"GeometryCollection":{n=Bg(s,e);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return n}function Bg(s,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:s.getGeometriesArray().map(function(n){return io(n,e)})}}function Wg(s,e){return{type:"LineString",coordinates:s.getCoordinates()}}function zg(s,e){return{type:"MultiLineString",coordinates:s.getCoordinates()}}function Yg(s,e){return{type:"MultiPoint",coordinates:s.getCoordinates()}}function Ug(s,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:s.getCoordinates(t)}}function jg(s,e){return{type:"Point",coordinates:s.getCoordinates()}}function Xg(s,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:s.getCoordinates(t)}}const vh=Lg,Bs=34962,Qo=34963,Hg=35040,Vg=35044,ys=35048,Zg=5121,Kg=5123,$g=5125,Eh=5126,$a=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Ch(s,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!jc},e);const t=$a.length;for(let n=0;n<t;++n)try{const i=s.getContext($a[n],e);if(i)return i}catch{}return null}const qg={STATIC_DRAW:Vg,STREAM_DRAW:Hg,DYNAMIC_DRAW:ys};class Jg{constructor(e,t){this.array=null,this.type=e,ae(e===Bs||e===Qo,62),this.usage=t!==void 0?t:qg.STATIC_DRAW}ofSize(e){return this.array=new(wr(this.type))(e),this}fromArray(e){return this.array=wr(this.type).from(e),this}fromArrayBuffer(e){return this.array=new(wr(this.type))(e),this}getType(){return this.type}getArray(){return this.array}getUsage(){return this.usage}getSize(){return this.array?this.array.length:0}}function wr(s){switch(s){case Bs:return Float32Array;case Qo:return Uint32Array;default:return Float32Array}}const Tr=Jg,us={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Qg=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,e_=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class t_{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||Qg),t.compileShader(n);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||e_),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const r=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const i=0,r=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,h=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,r,n[0],n[1],o,a,l,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0)}}apply(e,t,n,i){const r=this.getGL(),o=e.size;if(r.bindFramebuffer(r.FRAMEBUFFER,t?t.getFrameBuffer():null),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),!t){const l=q(r.canvas);if(!e.renderTargets[l]){const h=r.getContextAttributes();h&&h.preserveDrawingBuffer&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT)),e.renderTargets[l]=!0}}r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.useProgram(this.renderTargetProgram_),r.enableVertexAttribArray(this.renderTargetAttribLocation_),r.vertexAttribPointer(this.renderTargetAttribLocation_,2,r.FLOAT,!1,0,0),r.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),r.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;r.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(r,e),r.drawArrays(r.TRIANGLES,0,6),i&&i(r,e)}getFrameBuffer(){return this.frameBuffer_}applyUniforms(e){const t=this.getGL();let n,i=1;this.uniforms_.forEach(function(r){if(n=typeof r.value=="function"?r.value(e):r.value,n instanceof HTMLCanvasElement||n instanceof ImageData)r.texture||(r.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,r.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(r.location,i++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(r.location,n[0],n[1]);return;case 3:t.uniform3f(r.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(r.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(r.location,n)})}}const qa=t_;function n_(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Rr(s,e){return s[0]=e[0],s[1]=e[1],s[4]=e[2],s[5]=e[3],s[12]=e[4],s[13]=e[5],s}const Ut={PROJECTION_MATRIX:"u_projectionMatrix",OFFSET_SCALE_MATRIX:"u_offsetScaleMatrix",OFFSET_ROTATION_MATRIX:"u_offsetRotateMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio"},st={UNSIGNED_BYTE:Zg,UNSIGNED_SHORT:Kg,UNSIGNED_INT:$g,FLOAT:Eh},Ws={};function Ja(s){return"shared/"+s}let Qa=0;function i_(){const s="unique/"+Qa;return Qa+=1,s}function s_(s){let e=Ws[s];if(!e){const t=document.createElement("canvas");t.style.position="absolute",t.style.left="0",e={users:0,canvas:t},Ws[s]=e}return e.users+=1,e.canvas}function r_(s){const e=Ws[s];if(!e||(e.users-=1,e.users>0))return;const t=e.canvas,i=Ch(t).getExtension("WEBGL_lose_context");i&&i.loseContext(),delete Ws[s]}class o_ extends Vs{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Ja(e.canvasCacheKey):i_(),this.canvas_=s_(this.canvasCacheKey_),this.gl_=Ch(this.canvas_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.canvas_.addEventListener(us.LOST,this.boundHandleWebGLContextLost_),this.canvas_.addEventListener(us.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Se(),this.offsetScaleMatrix_=Se(),this.tmpMat4_=n_(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(t=>new qa({webGlContext:this.gl_,scaleRatio:t.scaleRatio,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms})):[new qa({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[];for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Ja(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=q(e);let i=this.bufferCache_[n];if(!i){const r=t.createBuffer();i={buffer:e,webGlBuffer:r},this.bufferCache_[n]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,n=q(e),i=this.bufferCache_[n];i&&!t.isContextLost()&&t.deleteBuffer(i.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){this.canvas_.removeEventListener(us.LOST,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(us.RESTORED,this.boundHandleWebGLContextRestored_),r_(this.canvasCacheKey_),delete this.gl_,delete this.canvas_}prepareDraw(e,t){const n=this.gl_,i=this.getCanvas(),r=e.size,o=e.pixelRatio;(i.width!==r[0]*o||i.height!==r[1]*o)&&(i.width=r[0]*o,i.height=r[1]*o,i.style.width=r[0]+"px",i.style.height=r[1]+"px");for(let a=this.postProcessPasses_.length-1;a>=0;a--)this.postProcessPasses_[a].init(e);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,t?n.ZERO:n.ONE_MINUS_SRC_ALPHA)}bindTexture(e,t,n){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(n),t)}prepareDrawToRenderTarget(e,t,n){const i=this.gl_,r=t.getSize();i.bindFramebuffer(i.FRAMEBUFFER,t.getFramebuffer()),i.viewport(0,0,r[0],r[1]),i.bindTexture(i.TEXTURE_2D,t.getTexture()),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,n?i.ZERO:i.ONE_MINUS_SRC_ALPHA)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const i=n.UNSIGNED_INT,r=4,o=t-e,a=e*r;n.drawElements(n.TRIANGLES,o,i,a)}finalizeDraw(e,t,n){for(let i=0,r=this.postProcessPasses_.length;i<r;i++)i===r-1?this.postProcessPasses_[i].apply(e,null,t,n):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.canvas_}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,i=e.pixelRatio,r=ya(this.offsetScaleMatrix_);cu(r,2/t[0],2/t[1]);const o=ya(this.offsetRotateMatrix_);n!==0&&hu(o,-n),this.setUniformMatrixValue(Ut.OFFSET_SCALE_MATRIX,Rr(this.tmpMat4_,r)),this.setUniformMatrixValue(Ut.OFFSET_ROTATION_MATRIX,Rr(this.tmpMat4_,o)),this.setUniformFloatValue(Ut.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Ut.ZOOM,e.viewState.zoom),this.setUniformFloatValue(Ut.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(Ut.PIXEL_RATIO,i),this.setUniformFloatVec2(Ut.VIEWPORT_SIZE_PX,[t[0],t[1]])}applyUniforms(e){const t=this.gl_;let n,i=0;this.uniforms_.forEach(r=>{if(n=typeof r.value=="function"?r.value(e):r.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData)r.texture||(r.prevValue=void 0,r.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,r.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(n instanceof HTMLImageElement)||n.complete)&&r.prevValue!==n&&(r.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),t.uniform1i(this.getUniformLocation(r.name),i++);else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(r.name,Rr(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(r.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(r.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(r.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(r.name),n)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const n=this.gl_,i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}getProgram(e,t){const n=this.gl_,i=this.compileShader(e,n.FRAGMENT_SHADER),r=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,i),n.attachShader(o,r),n.linkProgram(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(r,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(r)}`;throw new Error(a)}if(n.deleteShader(r),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=q(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=q(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,i=e.viewState.rotation,r=e.viewState.resolution,o=e.viewState.center;return vt(t,0,0,2/(r*n[0]),2/(r*n[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,n,i,r){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,i,r))}enableAttributes(e){const t=a_(e);let n=0;for(let i=0;i<e.length;i++){const r=e[i];this.enableAttributeArray_(r.name,r.size,r.type||Eh,t,n),n+=r.size*wh(r.type)}}handleWebGLContextLost(){$n(this.bufferCache_),this.currentProgram_=null}handleWebGLContextRestored(){}createTexture(e,t,n){const i=this.gl_;n=n||i.createTexture();const r=0,o=i.RGBA,a=0,l=i.RGBA,h=i.UNSIGNED_BYTE;return i.bindTexture(i.TEXTURE_2D,n),t?i.texImage2D(i.TEXTURE_2D,r,o,l,h,t):i.texImage2D(i.TEXTURE_2D,r,o,e[0],e[1],a,l,h,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n}}function a_(s){let e=0;for(let t=0;t<s.length;t++){const n=s[t];e+=n.size*wh(n.type)}return e}function wh(s){switch(s){case st.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case st.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case st.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case st.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class ea extends fh{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=Se(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(re.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(Ue.PRECOMPOSE)){const i=new gi(Ue.PRECOMPOSE,void 0,t,e);n.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(Ue.POSTCOMPOSE)){const i=new gi(Ue.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof ea)){t=!0;continue}const c=l.getClassName();if((t||c!==i)&&(n+=1,t=!1),i=c,h===this)break}const r="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(r))&&(this.removeHelper(),this.helper=new o_({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:r}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const i=this.getLayer();if(i.hasListener(e)){vt(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const r=new gi(e,this.inversePixelTransform_,n,t);i.dispatchEvent(r)}}preRender(e,t){this.dispatchRenderEvent_(Ue.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Ue.POSTRENDER,e,t)}}const l_=ea,_t=new Uint8Array(4);class h_{constructor(e,t){this.helper_=e;const n=e.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){Ft(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return _t[0]=0,_t[1]=0,_t[2]=0,_t[3]=0,_t;this.readAll();const n=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return _t[0]=this.data_[n*4],_t[1]=this.data_[n*4+1],_t[2]=this.data_[n*4+2],_t[3]=this.data_[n*4+3],_t}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(e[0]*e[1]*4)}}const c_=h_,Sr={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var Th={exports:{}};Th.exports=nr;Th.exports.default=nr;function nr(s,e,t){t=t||2;var n=e&&e.length,i=n?e[0]*t:s.length,r=Rh(s,0,i,t,!0),o=[];if(!r||r.next===r.prev)return o;var a,l,h,c,u,d,f;if(n&&(r=__(s,e,r,t)),s.length>80*t){a=h=s[0],l=c=s[1];for(var _=t;_<i;_+=t)u=s[_],d=s[_+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);f=Math.max(h-a,c-l),f=f!==0?32767/f:0}return Ai(r,o,t,a,l,f,0),o}function Rh(s,e,t,n,i){var r,o;if(i===oo(s,e,t,n)>0)for(r=e;r<t;r+=n)o=el(r,s[r],s[r+1],o);else for(r=t-n;r>=e;r-=n)o=el(r,s[r],s[r+1],o);return o&&ir(o,o.next)&&(Fi(o),o=o.next),o}function xn(s,e){if(!s)return s;e||(e=s);var t=s,n;do if(n=!1,!t.steiner&&(ir(t,t.next)||de(t.prev,t,t.next)===0)){if(Fi(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Ai(s,e,t,n,i,r,o){if(s){!o&&r&&v_(s,n,i,r);for(var a=s,l,h;s.prev!==s.next;){if(l=s.prev,h=s.next,r?d_(s,n,i,r):u_(s)){e.push(l.i/t|0),e.push(s.i/t|0),e.push(h.i/t|0),Fi(s),s=h.next,a=h.next;continue}if(s=h,s===a){o?o===1?(s=f_(xn(s),e,t),Ai(s,e,t,n,i,r,2)):o===2&&g_(s,e,t,n,i,r):Ai(xn(s),e,t,n,i,r,1);break}}}}function u_(s){var e=s.prev,t=s,n=s.next;if(de(e,t,n)>=0)return!1;for(var i=e.x,r=t.x,o=n.x,a=e.y,l=t.y,h=n.y,c=i<r?i<o?i:o:r<o?r:o,u=a<l?a<h?a:h:l<h?l:h,d=i>r?i>o?i:o:r>o?r:o,f=a>l?a>h?a:h:l>h?l:h,_=n.next;_!==e;){if(_.x>=c&&_.x<=d&&_.y>=u&&_.y<=f&&Fn(i,a,r,l,o,h,_.x,_.y)&&de(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function d_(s,e,t,n){var i=s.prev,r=s,o=s.next;if(de(i,r,o)>=0)return!1;for(var a=i.x,l=r.x,h=o.x,c=i.y,u=r.y,d=o.y,f=a<l?a<h?a:h:l<h?l:h,_=c<u?c<d?c:d:u<d?u:d,p=a>l?a>h?a:h:l>h?l:h,y=c>u?c>d?c:d:u>d?u:d,E=so(f,_,e,t,n),w=so(p,y,e,t,n),v=s.prevZ,C=s.nextZ;v&&v.z>=E&&C&&C.z<=w;){if(v.x>=f&&v.x<=p&&v.y>=_&&v.y<=y&&v!==i&&v!==o&&Fn(a,c,l,u,h,d,v.x,v.y)&&de(v.prev,v,v.next)>=0||(v=v.prevZ,C.x>=f&&C.x<=p&&C.y>=_&&C.y<=y&&C!==i&&C!==o&&Fn(a,c,l,u,h,d,C.x,C.y)&&de(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;v&&v.z>=E;){if(v.x>=f&&v.x<=p&&v.y>=_&&v.y<=y&&v!==i&&v!==o&&Fn(a,c,l,u,h,d,v.x,v.y)&&de(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;C&&C.z<=w;){if(C.x>=f&&C.x<=p&&C.y>=_&&C.y<=y&&C!==i&&C!==o&&Fn(a,c,l,u,h,d,C.x,C.y)&&de(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function f_(s,e,t){var n=s;do{var i=n.prev,r=n.next.next;!ir(i,r)&&Sh(i,n,n.next,r)&&Pi(i,r)&&Pi(r,i)&&(e.push(i.i/t|0),e.push(n.i/t|0),e.push(r.i/t|0),Fi(n),Fi(n.next),n=s=r),n=n.next}while(n!==s);return xn(n)}function g_(s,e,t,n,i,r){var o=s;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&w_(o,a)){var l=Ih(o,a);o=xn(o,o.next),l=xn(l,l.next),Ai(o,e,t,n,i,r,0),Ai(l,e,t,n,i,r,0);return}a=a.next}o=o.next}while(o!==s)}function __(s,e,t,n){var i=[],r,o,a,l,h;for(r=0,o=e.length;r<o;r++)a=e[r]*n,l=r<o-1?e[r+1]*n:s.length,h=Rh(s,a,l,n,!1),h===h.next&&(h.steiner=!0),i.push(C_(h));for(i.sort(m_),r=0;r<i.length;r++)t=p_(i[r],t);return t}function m_(s,e){return s.x-e.x}function p_(s,e){var t=y_(s,e);if(!t)return e;var n=Ih(t,s);return xn(n,n.next),xn(t,t.next)}function y_(s,e){var t=e,n=s.x,i=s.y,r=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var a=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=n&&a>r&&(r=a,o=t.x<t.next.x?t:t.next,a===n))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,h=o.x,c=o.y,u=1/0,d;t=o;do n>=t.x&&t.x>=h&&n!==t.x&&Fn(i<c?n:r,i,h,c,i<c?r:n,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(n-t.x),Pi(t,s)&&(d<u||d===u&&(t.x>o.x||t.x===o.x&&x_(o,t)))&&(o=t,u=d)),t=t.next;while(t!==l);return o}function x_(s,e){return de(s.prev,s,e.prev)<0&&de(e.next,s,s.next)<0}function v_(s,e,t,n){var i=s;do i.z===0&&(i.z=so(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==s);i.prevZ.nextZ=null,i.prevZ=null,E_(i)}function E_(s){var e,t,n,i,r,o,a,l,h=1;do{for(t=s,s=null,r=null,o=0;t;){for(o++,n=t,a=0,e=0;e<h&&(a++,n=n.nextZ,!!n);e++);for(l=h;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,l--),r?r.nextZ=i:s=i,i.prevZ=r,r=i;t=n}r.nextZ=null,h*=2}while(o>1);return s}function so(s,e,t,n,i){return s=(s-t)*i|0,e=(e-n)*i|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function C_(s){var e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function Fn(s,e,t,n,i,r,o,a){return(i-o)*(e-a)>=(s-o)*(r-a)&&(s-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(i-o)*(n-a)}function w_(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!T_(s,e)&&(Pi(s,e)&&Pi(e,s)&&R_(s,e)&&(de(s.prev,s,e.prev)||de(s,e.prev,e))||ir(s,e)&&de(s.prev,s,s.next)>0&&de(e.prev,e,e.next)>0)}function de(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function ir(s,e){return s.x===e.x&&s.y===e.y}function Sh(s,e,t,n){var i=fs(de(s,e,t)),r=fs(de(s,e,n)),o=fs(de(t,n,s)),a=fs(de(t,n,e));return!!(i!==r&&o!==a||i===0&&ds(s,t,e)||r===0&&ds(s,n,e)||o===0&&ds(t,s,n)||a===0&&ds(t,e,n))}function ds(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function fs(s){return s>0?1:s<0?-1:0}function T_(s,e){var t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&Sh(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function Pi(s,e){return de(s.prev,s,s.next)<0?de(s,e,s.next)>=0&&de(s,s.prev,e)>=0:de(s,e,s.prev)<0||de(s,s.next,e)<0}function R_(s,e){var t=s,n=!1,i=(s.x+e.x)/2,r=(s.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==s);return n}function Ih(s,e){var t=new ro(s.i,s.x,s.y),n=new ro(e.i,e.x,e.y),i=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function el(s,e,t,n){var i=new ro(s,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Fi(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function ro(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}nr.deviation=function(s,e,t,n){var i=e&&e.length,r=i?e[0]*t:s.length,o=Math.abs(oo(s,0,r,t));if(i)for(var a=0,l=e.length;a<l;a++){var h=e[a]*t,c=a<l-1?e[a+1]*t:s.length;o-=Math.abs(oo(s,h,c,t))}var u=0;for(a=0;a<n.length;a+=3){var d=n[a]*t,f=n[a+1]*t,_=n[a+2]*t;u+=Math.abs((s[d]-s[_])*(s[f+1]-s[d+1])-(s[d]-s[f])*(s[_+1]-s[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function oo(s,e,t,n){for(var i=0,r=e,o=t-n;r<t;r+=n)i+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return i}nr.flatten=function(s){for(var e=s[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,i=0;i<s.length;i++){for(var r=0;r<s[i].length;r++)for(var o=0;o<e;o++)t.vertices.push(s[i][r][o]);i>0&&(n+=s[i-1].length,t.holes.push(n))}return t};function S_(s,e){e=e||[];const t=256,n=t-1;return e[0]=Math.floor(s/t/t/t)/n,e[1]=Math.floor(s/t/t)%t/n,e[2]=Math.floor(s/t)%t/n,e[3]=s%t/n,e}function I_(s){let e=0;const t=256,n=t-1;return e+=Math.round(s[0]*t*t*t*n),e+=Math.round(s[1]*t*t*n),e+=Math.round(s[2]*t*n),e+=Math.round(s[3]*n),e}function b_(){const s='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS",r={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:\'`renderMode` must be `"hybrid"` or `"vector"`\',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class o extends Error{constructor(e){const t=r[e];super(t),this.code=e,this.name="AssertionError",this.message=t}}var i=o;function a(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function s(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new i(t)}(0!==n,32);const o=t[0],a=t[1],s=t[2],u=t[3],f=t[4],x=t[5];return e[0]=u/n,e[1]=-a/n,e[2]=-s/n,e[3]=o/n,e[4]=(s*x-u*f)/n,e[5]=-(o*x-a*f)/n,e}function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var f={exports:{}};function x(e,t,n){n=n||2;var r,o,i,a,s,u,f,x=t&&t.length,h=x?t[0]*n:e.length,v=l(e,0,h,n,!0),d=[];if(!v||v.next===v.prev)return d;if(x&&(v=function(e,t,n,r){var o,i,a,s=[];for(o=0,i=t.length;o<i;o++)(a=l(e,t[o]*r,o<i-1?t[o+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(A(a));for(s.sort(b),o=0;o<s.length;o++)n=g(s[o],n);return n}(e,t,v,n)),e.length>80*n){r=i=e[0],o=a=e[1];for(var y=n;y<h;y+=n)(s=e[y])<r&&(r=s),(u=e[y+1])<o&&(o=u),s>i&&(i=s),u>a&&(a=u);f=0!==(f=Math.max(i-r,a-o))?32767/f:0}return c(v,d,n,r,o,f,0),d}function l(e,t,n,r,o){var i,a;if(o===P(e,t,n,r)>0)for(i=t;i<n;i+=r)a=k(i,e[i],e[i+1],a);else for(i=n-r;i>=t;i-=r)a=k(i,e[i],e[i+1],a);return a&&F(a,a.next)&&(R(a),a=a.next),a}function h(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!F(r,r.next)&&0!==Z(r.prev,r,r.next))r=r.next;else{if(R(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function c(e,t,n,r,o,i,a){if(e){!a&&i&&function(e,t,n,r){var o=e;do{0===o.z&&(o.z=w(o.x,o.y,t,n,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,n,r,o,i,a,s,u,f=1;do{for(n=e,e=null,i=null,a=0;n;){for(a++,r=n,s=0,t=0;t<f&&(s++,r=r.nextZ);t++);for(u=f;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(o=n,n=n.nextZ,s--):(o=r,r=r.nextZ,u--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;n=r}i.nextZ=null,f*=2}while(a>1)}(o)}(e,r,o,i);for(var s,u,f=e;e.prev!==e.next;)if(s=e.prev,u=e.next,i?d(e,r,o,i):v(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(u.i/n|0),R(e),e=u.next,f=u.next;else if((e=u)===f){a?1===a?c(e=y(h(e),t,n),t,n,r,o,i,2):2===a&&p(e,t,n,r,o,i):c(h(e),t,n,r,o,i,1);break}}}function v(e){var t=e.prev,n=e,r=e.next;if(Z(t,n,r)>=0)return!1;for(var o=t.x,i=n.x,a=r.x,s=t.y,u=n.y,f=r.y,x=o<i?o<a?o:a:i<a?i:a,l=s<u?s<f?s:f:u<f?u:f,h=o>i?o>a?o:a:i>a?i:a,c=s>u?s>f?s:f:u>f?u:f,v=r.next;v!==t;){if(v.x>=x&&v.x<=h&&v.y>=l&&v.y<=c&&E(o,s,i,u,a,f,v.x,v.y)&&Z(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function d(e,t,n,r){var o=e.prev,i=e,a=e.next;if(Z(o,i,a)>=0)return!1;for(var s=o.x,u=i.x,f=a.x,x=o.y,l=i.y,h=a.y,c=s<u?s<f?s:f:u<f?u:f,v=x<l?x<h?x:h:l<h?l:h,d=s>u?s>f?s:f:u>f?u:f,y=x>l?x>h?x:h:l>h?l:h,p=w(c,v,t,n,r),b=w(d,y,t,n,r),g=e.prevZ,m=e.nextZ;g&&g.z>=p&&m&&m.z<=b;){if(g.x>=c&&g.x<=d&&g.y>=v&&g.y<=y&&g!==o&&g!==a&&E(s,x,u,l,f,h,g.x,g.y)&&Z(g.prev,g,g.next)>=0)return!1;if(g=g.prevZ,m.x>=c&&m.x<=d&&m.y>=v&&m.y<=y&&m!==o&&m!==a&&E(s,x,u,l,f,h,m.x,m.y)&&Z(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;g&&g.z>=p;){if(g.x>=c&&g.x<=d&&g.y>=v&&g.y<=y&&g!==o&&g!==a&&E(s,x,u,l,f,h,g.x,g.y)&&Z(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;m&&m.z<=b;){if(m.x>=c&&m.x<=d&&m.y>=v&&m.y<=y&&m!==o&&m!==a&&E(s,x,u,l,f,h,m.x,m.y)&&Z(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function y(e,t,n){var r=e;do{var o=r.prev,i=r.next.next;!F(o,i)&&T(o,r,r.next,i)&&z(o,i)&&z(i,o)&&(t.push(o.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),R(r),R(r.next),r=e=i),r=r.next}while(r!==e);return h(r)}function p(e,t,n,r,o,i){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&M(a,s)){var u=U(a,s);return a=h(a,a.next),u=h(u,u.next),c(a,t,n,r,o,i,0),void c(u,t,n,r,o,i,0)}s=s.next}a=a.next}while(a!==e)}function b(e,t){return e.x-t.x}function g(e,t){var n=function(e,t){var n,r=t,o=e.x,i=e.y,a=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=o&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===o))return n}r=r.next}while(r!==t);if(!n)return null;var u,f=n,x=n.x,l=n.y,h=1/0;r=n;do{o>=r.x&&r.x>=x&&o!==r.x&&E(i<l?o:a,i,x,l,i<l?a:o,i,r.x,r.y)&&(u=Math.abs(i-r.y)/(o-r.x),z(r,e)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&m(n,r)))&&(n=r,h=u)),r=r.next}while(r!==f);return n}(e,t);if(!n)return t;var r=U(n,e);return h(r,r.next),h(n,n.next)}function m(e,t){return Z(e.prev,e,t.prev)<0&&Z(t.next,e,e.next)<0}function w(e,t,n,r,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function A(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function E(e,t,n,r,o,i,a,s){return(o-a)*(t-s)>=(e-a)*(i-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(i-s)>=(o-a)*(r-s)}function M(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&T(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,o=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&o<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Z(e.prev,e,t.prev)||Z(e,t.prev,t))||F(e,t)&&Z(e.prev,e,e.next)>0&&Z(t.prev,t,t.next)>0)}function Z(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function F(e,t){return e.x===t.x&&e.y===t.y}function T(e,t,n,r){var o=S(Z(e,t,n)),i=S(Z(e,t,r)),a=S(Z(n,r,e)),s=S(Z(n,r,t));return o!==i&&a!==s||(!(0!==o||!I(e,n,t))||(!(0!==i||!I(e,r,t))||(!(0!==a||!I(n,e,r))||!(0!==s||!I(n,t,r)))))}function I(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function S(e){return e>0?1:e<0?-1:0}function z(e,t){return Z(e.prev,e,e.next)<0?Z(e,t,e.next)>=0&&Z(e,e.prev,t)>=0:Z(e,t,e.prev)<0||Z(e,e.next,t)<0}function U(e,t){var n=new B(e.i,e.x,e.y),r=new B(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function k(e,t,n,r){var o=new B(e,t,n);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function R(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function B(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P(e,t,n,r){for(var o=0,i=t,a=n-r;i<n;i+=r)o+=(e[a]-e[i])*(e[i+1]+e[a+1]),a=i;return o}f.exports=x,f.exports.default=x,x.deviation=function(e,t,n,r){var o=t&&t.length,i=o?t[0]*n:e.length,a=Math.abs(P(e,0,i,n));if(o)for(var s=0,u=t.length;s<u;s++){var f=t[s]*n,x=s<u-1?t[s+1]*n:e.length;a-=Math.abs(P(e,f,x,n))}var l=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,c=r[s+1]*n,v=r[s+2]*n;l+=Math.abs((e[h]-e[v])*(e[c+1]-e[h+1])-(e[h]-e[c])*(e[v+1]-e[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},x.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var a=0;a<t;a++)n.vertices.push(e[o][i][a]);o>0&&(r+=e[o-1].length,n.holes.push(r))}return n};var N=u(f.exports);const _=[],O={vertexPosition:0,indexPosition:0};function q(e,t,n,r,o){e[t+0]=n,e[t+1]=r,e[t+2]=o}function L(e,t,n,r,o,i){const a=3+o,s=e[t+0],u=e[t+1],f=_;f.length=o;for(let n=0;n<f.length;n++)f[n]=e[t+2+n];let x=i?i.vertexPosition:0,l=i?i.indexPosition:0;const h=x/a;return q(n,x,s,u,0),f.length&&n.set(f,x+3),x+=a,q(n,x,s,u,1),f.length&&n.set(f,x+3),x+=a,q(n,x,s,u,2),f.length&&n.set(f,x+3),x+=a,q(n,x,s,u,3),f.length&&n.set(f,x+3),x+=a,r[l++]=h,r[l++]=h+1,r[l++]=h+3,r[l++]=h+1,r[l++]=h+2,r[l++]=h+3,O.vertexPosition=x,O.indexPosition=l,O}function C(e,t,n,r,o,i,s,u,f,x){const l=5+u.length,h=i.length/l,c=[e[t+0],e[t+1]],v=[e[n],e[n+1]],d=a(x,[...c]),y=a(x,[...v]);function p(e,t,n){const r=1e4;return Math.round(1500*t)+Math.round(1500*n)*r+e*r*r}function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),o=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-o[1],o[0]],a=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),s=[(n[0]-e[0])/a,(n[1]-e[1])/a],u=0===r||0===a?0:Math.acos((f=s[0]*o[0]+s[1]*o[1],x=-1,l=1,Math.min(Math.max(f,x),l)));var f,x,l;return s[0]*i[0]+s[1]*i[1]>0?u:2*Math.PI-u}const g=null!==o;let m=0,w=0;if(null!==r){m=b(d,y,a(x,[...[e[r],e[r+1]]]))}if(g){w=b(y,d,a(x,[...[e[o],e[o+1]]]))}i.push(c[0],c[1],v[0],v[1],p(0,m,w)),i.push(...u),i.push(c[0],c[1],v[0],v[1],p(1,m,w)),i.push(...u),i.push(c[0],c[1],v[0],v[1],p(2,m,w)),i.push(...u),i.push(c[0],c[1],v[0],v[1],p(3,m,w)),i.push(...u),s.push(h,h+1,h+2,h+1,h+3,h+2)}function G(e,t,n,r,o){const i=2+o;let a=t;const s=e.slice(a,a+o);a+=o;const u=e[a++];let f=0;const x=new Array(u-1);for(let t=0;t<u;t++)f+=e[a++],t<u-1&&(x[t]=f);const l=e.slice(a,a+2*f),h=N(l,x,2);for(let e=0;e<h.length;e++)r.push(h[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...s);return a+2*f}const j=self;j.onmessage=r=>{const o=r.data;switch(o.type){case t:{const e=3,t=2,n=o.customAttributesSize,r=t+n,i=new Float32Array(o.renderInstructions),a=i.length/r,s=4*a*(n+e),u=new Uint32Array(6*a),f=new Float32Array(s);let x;for(let e=0;e<i.length;e+=r)x=L(i,e,f,u,n,x);const l=Object.assign({vertexBuffer:f.buffer,indexBuffer:u.buffer,renderInstructions:i.buffer},o);j.postMessage(l,[f.buffer,u.buffer,i.buffer]);break}case n:{const e=[],t=[],n=o.customAttributesSize,r=2,i=new Float32Array(o.renderInstructions);let a=0;const u=o.renderInstructionsTransform,f=[1,0,0,1,0,0];let x,l;for(s(f,u);a<i.length;){l=Array.from(i.slice(a,a+n)),a+=n,x=i[a++];for(let n=0;n<x-1;n++)C(i,a+n*r,a+(n+1)*r,n>0?a+(n-1)*r:null,n<x-2?a+(n+2)*r:null,e,t,l,0,f);a+=x*r}const h=Uint32Array.from(t),c=Float32Array.from(e),v=Object.assign({vertexBuffer:c.buffer,indexBuffer:h.buffer,renderInstructions:i.buffer},o);j.postMessage(v,[c.buffer,h.buffer,i.buffer]);break}case e:{const e=[],t=[],n=o.customAttributesSize,r=new Float32Array(o.renderInstructions);let i=0;for(;i<r.length;)i=G(r,i,e,t,n);const a=Uint32Array.from(t),s=Float32Array.from(e),u=Object.assign({vertexBuffer:s.buffer,indexBuffer:a.buffer,renderInstructions:r.buffer},o);j.postMessage(u,[s.buffer,a.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(s,"binary").toString("base64"):URL.createObjectURL(new Blob([s],{type:"application/javascript"})))}class M_ extends l_{constructor(e,t){const n=t.uniforms||{},i=Se();n[Ut.PROJECTION_MATRIX]=i,super(e,{uniforms:n,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new Tr(Bs,ys),this.hitVerticesBuffer_=new Tr(Bs,ys),this.indicesBuffer_=new Tr(Qo,ys),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=!!(t.hitFragmentShader&&t.hitVertexShader),this.hitVertexShader_=t.hitVertexShader,this.hitFragmentShader_=t.hitFragmentShader,this.hitProgram_;const r=t.attributes?t.attributes.map(function(a){return{name:"a_"+a.name,size:1,type:st.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:st.FLOAT},{name:"a_index",size:1,type:st.FLOAT}].concat(r),this.hitDetectionAttributes=[{name:"a_position",size:2,type:st.FLOAT},{name:"a_index",size:1,type:st.FLOAT},{name:"a_hitColor",size:4,type:st.FLOAT},{name:"a_featureUid",size:1,type:st.FLOAT}].concat(r),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=at(),this.currentTransform_=i,this.renderTransform_=Se(),this.invertRenderTransform_=Se(),this.renderInstructions_=new Float32Array(0),this.hitRenderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=b_(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===Sr.GENERATE_POINT_BUFFERS){const h=l.projectionTransform;l.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,qs(this.invertRenderTransform_,this.renderTransform_),l.hitDetection?this.hitRenderInstructions_=new Float32Array(a.data.renderInstructions):(this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0)),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[K(o,ke.ADDFEATURE,this.handleSourceFeatureAdded_,this),K(o,ke.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),K(o,ke.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),K(o,ke.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{this.featureCache_[q(a)]={feature:a,properties:a.getProperties(),geometry:a.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitProgram_=this.helper.getProgram(this.hitFragmentShader_,this.hitVertexShader_),this.hitRenderTarget_=new c_(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[q(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[q(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[q(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState.projection,o=this.getLayer().getSource().getWrapX()&&n.canWrapX(),a=n.getExtent(),l=e.extent,h=o?we(a):null,c=o?Math.ceil((l[2]-a[2])/h)+1:1,u=o?Math.floor((l[0]-a[0])/h):0;let d=u;const f=this.indicesBuffer_.getSize();do this.helper.makeProjectionTransform(e,this.currentTransform_),xa(this.currentTransform_,d*h,0),vi(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.drawElements(0,f);while(++d<c);this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const _=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderHitDetection(e,u,c,h),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),_}prepareFrameInternal(e){const t=this.getLayer(),n=t.getSource(),i=e.viewState,r=!e.viewHints[Ce.ANIMATING]&&!e.viewHints[Ce.INTERACTING],o=!Wn(this.previousExtent_,e.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),r&&(o||a)){const l=i.projection,h=i.resolution,c=t instanceof Jo?t.getRenderBuffer():0,u=Xs(e.extent,c*h);n.loadFeatures(u,h,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=Se();this.helper.makeProjectionTransform(e,t);const n=(2+this.customAttributes.length)*this.featureCount_;if((!this.renderInstructions_||this.renderInstructions_.length!==n)&&(this.renderInstructions_=new Float32Array(n)),this.hitDetectionEnabled_){const d=(7+this.customAttributes.length)*this.featureCount_;(!this.hitRenderInstructions_||this.hitRenderInstructions_.length!==d)&&(this.hitRenderInstructions_=new Float32Array(d))}let i,r;const o=[],a=[];let l=0,h=0,c;for(const d in this.featureCache_){if(i=this.featureCache_[d],r=i.geometry,!r||r.getType()!=="Point")continue;o[0]=r.getFlatCoordinates()[0],o[1]=r.getFlatCoordinates()[1],xe(t,o),c=S_(h+6,a),this.renderInstructions_[l++]=o[0],this.renderInstructions_[l++]=o[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=o[0],this.hitRenderInstructions_[h++]=o[1],this.hitRenderInstructions_[h++]=c[0],this.hitRenderInstructions_[h++]=c[1],this.hitRenderInstructions_[h++]=c[2],this.hitRenderInstructions_[h++]=c[3],this.hitRenderInstructions_[h++]=Number(d));let f;for(let _=0;_<this.customAttributes.length;_++)f=this.customAttributes[_].callback(i.feature,i.properties),this.renderInstructions_[l++]=f,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=f)}const u={id:++this.lastSentId,type:Sr.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:this.customAttributes.length};if(u.projectionTransform=t,this.ready=!1,this.worker_.postMessage(u,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){const d={id:0,type:Sr.GENERATE_POINT_BUFFERS,renderInstructions:this.hitRenderInstructions_.buffer,customAttributesSize:5+this.customAttributes.length};d.projectionTransform=t,d.hitDetection=!0,this.worker_.postMessage(d,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}}forEachFeatureAtCoordinate(e,t,n,i,r){if(ae(this.hitDetectionEnabled_,66),!this.hitRenderInstructions_)return;const o=xe(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],h=I_(l),c=this.hitRenderInstructions_[h],u=Math.floor(c).toString(),f=this.getLayer().getSource().getFeatureByUid(u);if(f)return i(f,this.getLayer(),null)}renderHitDetection(e,t,n,i){if(!this.hitVerticesBuffer_.getSize())return;let r=t;this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.useProgram(this.hitProgram_,e),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),xa(this.currentTransform_,r*i,0),vi(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e);const o=this.indicesBuffer_.getSize();this.helper.drawElements(0,o)}while(++r<n)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(e){he(e)}),this.sourceListenKeys_=null,super.disposeInternal()}}const D_=M_,nt={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},L_=["#00f","#0ff","#0f0","#ff0","#f00"];class A_ extends Jo{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.gradient_=null,this.addChangeListener(nt.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:L_),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const n=e.weight?e.weight:"weight";typeof n=="string"?this.weightFunction_=function(i){return i.get(n)}:this.weightFunction_=n,this.setRenderOrder(null)}getBlur(){return this.get(nt.BLUR)}getGradient(){return this.get(nt.GRADIENT)}getRadius(){return this.get(nt.RADIUS)}handleGradientChanged_(){this.gradient_=P_(this.getGradient())}setBlur(e){this.set(nt.BLUR,e)}setGradient(e){this.set(nt.GRADIENT,e)}setRadius(e){this.set(nt.RADIUS,e)}createRenderer(){return new D_(this,{className:this.getClassName(),attributes:[{name:"weight",callback:e=>{const t=this.weightFunction_(e);return t!==void 0?ye(t,0,1):1}}],vertexShader:`
        precision mediump float;
        uniform mat4 u_projectionMatrix;
        uniform mat4 u_offsetScaleMatrix;
        uniform float u_size;
        attribute vec2 a_position;
        attribute float a_index;
        attribute float a_weight;

        varying vec2 v_texCoord;
        varying float v_weight;

        void main(void) {
          mat4 offsetMatrix = u_offsetScaleMatrix;
          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;
          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;
          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);
          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;
          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;
          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;
          v_texCoord = vec2(u, v);
          v_weight = a_weight;
        }`,fragmentShader:`
        precision mediump float;
        uniform float u_blurSlope;

        varying vec2 v_texCoord;
        varying float v_weight;

        void main(void) {
          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);
          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;
          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;
          float alpha = smoothstep(0.0, 1.0, value) * v_weight;
          gl_FragColor = vec4(alpha, alpha, alpha, alpha);
        }`,hitVertexShader:`
        precision mediump float;
        uniform mat4 u_projectionMatrix;
        uniform mat4 u_offsetScaleMatrix;
        uniform float u_size;
        attribute vec2 a_position;
        attribute float a_index;
        attribute float a_weight;
        attribute vec4 a_hitColor;

        varying vec2 v_texCoord;
        varying float v_weight;
        varying vec4 v_hitColor;

        void main(void) {
          mat4 offsetMatrix = u_offsetScaleMatrix;
          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;
          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;
          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);
          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;
          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;
          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;
          v_texCoord = vec2(u, v);
          v_hitColor = a_hitColor;
          v_weight = a_weight;
        }`,hitFragmentShader:`
        precision mediump float;
        uniform float u_blurSlope;

        varying vec2 v_texCoord;
        varying float v_weight;
        varying vec4 v_hitColor;

        void main(void) {
          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);
          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;
          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;
          float alpha = smoothstep(0.0, 1.0, value) * v_weight;
          if (alpha < 0.05) {
            discard;
          }

          gl_FragColor = v_hitColor;
        }`,uniforms:{u_size:()=>(this.get(nt.RADIUS)+this.get(nt.BLUR))*2,u_blurSlope:()=>this.get(nt.RADIUS)/Math.max(1,this.get(nt.BLUR))},postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function P_(s){const n=Le(1,256),i=n.createLinearGradient(0,0,1,256),r=1/(s.length-1);for(let o=0,a=s.length;o<a;++o)i.addColorStop(o*r,s[o]);return n.fillStyle=i,n.fillRect(0,0,1,256),n.canvas}const F_=A_,gs={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class O_ extends er{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(gs.PRELOAD)}setPreload(e){this.set(gs.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(gs.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(gs.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const k_=O_;class N_ extends Zs{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(Z.CHANGE)}release(){this.state===H.ERROR&&this.setState(H.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==H.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==H.LOADED){e.interimTile=null;break}else e.getState()==H.LOADING?t=e:e.getState()==H.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==H.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){X()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;const i=t-n+1e3/60;return i>=this.transition_?1:bl(i/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const bh=N_;class G_ extends bh{constructor(e,t,n,i,r,o){super(e,t,o),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_=new Image,i!==null&&(this.image_.crossOrigin=i),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=H.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=H.ERROR,this.unlistenImage_(),this.image_=B_(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=H.LOADED:this.state=H.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==H.ERROR&&(this.state=H.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==H.IDLE&&(this.state=H.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=hh(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function B_(){const s=Le(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}const W_=G_,z_=.5,Y_=10,tl=.25;class U_{constructor(e,t,n,i,r,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=Wr(this.targetProj_,this.sourceProj_);this.transformInv_=function(w){const v=w[0]+"/"+w[1];return a[v]||(a[v]=l(w)),a[v]},this.maxSourceExtent_=i,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&we(i)>=we(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?we(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?we(this.targetProj_.getExtent()):null;const h=Hs(n),c=pl(n),u=yl(n),d=xl(n),f=this.transformInv_(h),_=this.transformInv_(c),p=this.transformInv_(u),y=this.transformInv_(d),E=Y_+(o?Math.max(0,Math.ceil(Math.log2(Hr(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,f,_,p,y,E),this.wrapsXInSource_){let w=1/0;this.triangles_.forEach(function(v,C,R){w=Math.min(w,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-w>this.sourceWorldWidth_/2){const C=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];C[0][0]-w>this.sourceWorldWidth_/2&&(C[0][0]-=this.sourceWorldWidth_),C[1][0]-w>this.sourceWorldWidth_/2&&(C[1][0]-=this.sourceWorldWidth_),C[2][0]-w>this.sourceWorldWidth_/2&&(C[2][0]-=this.sourceWorldWidth_);const R=Math.min(C[0][0],C[1][0],C[2][0]);Math.max(C[0][0],C[1][0],C[2][0])-R<this.sourceWorldWidth_/2&&(v.source=C)}})}a={}}addTriangle_(e,t,n,i,r,o){this.triangles_.push({source:[i,r,o],target:[e,t,n]})}addQuad_(e,t,n,i,r,o,a,l,h){const c=Xr([r,o,a,l]),u=this.sourceWorldWidth_?we(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let _=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const y=Xr([e,t,n,i]);_=we(y)/this.targetWorldWidth_>tl||_}!f&&this.sourceProj_.isGlobal()&&u&&(_=u>tl||_)}if(!_&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!je(c,this.maxSourceExtent_))return;let p=0;if(!_&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)_=!0;else if(p=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),p!=1&&p!=2&&p!=4&&p!=8)return}if(h>0){if(!_){const y=[(e[0]+n[0])/2,(e[1]+n[1])/2],E=this.transformInv_(y);let w;f?w=(di(r[0],d)+di(a[0],d))/2-di(E[0],d):w=(r[0]+a[0])/2-E[0];const v=(r[1]+a[1])/2-E[1];_=w*w+v*v>this.errorThresholdSquared_}if(_){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const y=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(y),w=[(i[0]+e[0])/2,(i[1]+e[1])/2],v=this.transformInv_(w);this.addQuad_(e,t,y,w,r,o,E,v,h-1),this.addQuad_(w,y,n,i,v,E,a,l,h-1)}else{const y=[(e[0]+t[0])/2,(e[1]+t[1])/2],E=this.transformInv_(y),w=[(n[0]+i[0])/2,(n[1]+i[1])/2],v=this.transformInv_(w);this.addQuad_(e,y,w,i,r,E,v,l,h-1),this.addQuad_(y,t,n,w,E,o,a,v,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}p&11||this.addTriangle_(e,n,i,r,a,l),p&14||this.addTriangle_(e,n,t,r,a,o),p&&(p&13||this.addTriangle_(t,i,e,o,l,r),p&7||this.addTriangle_(t,i,n,o,l,a))}calculateSourceExtent(){const e=at();return this.triangles_.forEach(function(t,n,i){const r=t.source;ps(e,r[0]),ps(e,r[1]),ps(e,r[2])}),e}getTriangles(){return this.triangles_}}const j_=U_;let Ir;const On=[];function nl(s,e,t,n,i){s.beginPath(),s.moveTo(0,0),s.lineTo(e,t),s.lineTo(n,i),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(e,n)+1,Math.max(t,i)),s.restore()}function br(s,e){return Math.abs(s[e*4]-210)>2||Math.abs(s[e*4+3]-.75*255)>2}function X_(){if(Ir===void 0){const s=Le(6,6,On);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",nl(s,4,5,4,0),nl(s,4,5,0,5);const e=s.getImageData(0,0,3,3).data;Ir=br(e,0)||br(e,4)||br(e,8),$s(s),On.push(s.canvas)}return Ir}function il(s,e,t,n){const i=Dc(t,e,s);let r=ws(e,n,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=s.getMetersPerUnit();a!==void 0&&(r/=a);const l=s.getExtent();if(!l||yo(l,i)){const h=ws(s,r,i)/r;isFinite(h)&&h>0&&(r/=h)}return r}function H_(s,e,t,n){const i=Bn(t);let r=il(s,e,i,n);return(!isFinite(r)||r<=0)&&_o(t,function(o){return r=il(s,e,o,n),isFinite(r)&&r>0}),r}function V_(s,e,t,n,i,r,o,a,l,h,c,u){const d=Le(Math.round(t*s),Math.round(t*e),On);if(u||(d.imageSmoothingEnabled=!1),l.length===0)return d.canvas;d.scale(t,t);function f(C){return Math.round(C*t)/t}d.globalCompositeOperation="lighter";const _=at();l.forEach(function(C,R,M){ml(_,C.extent)});const p=we(_),y=qt(_),E=Le(Math.round(t*p/n),Math.round(t*y/n),On);u||(E.imageSmoothingEnabled=!1);const w=t/n;l.forEach(function(C,R,M){const A=C.extent[0]-_[0],L=-(C.extent[3]-_[3]),B=we(C.extent),W=qt(C.extent);C.image.width>0&&C.image.height>0&&E.drawImage(C.image,h,h,C.image.width-2*h,C.image.height-2*h,A*w,L*w,B*w,W*w)});const v=Hs(o);return a.getTriangles().forEach(function(C,R,M){const A=C.source,L=C.target;let B=A[0][0],W=A[0][1],ee=A[1][0],$=A[1][1],U=A[2][0],_e=A[2][1];const V=f((L[0][0]-v[0])/r),k=f(-(L[0][1]-v[1])/r),P=f((L[1][0]-v[0])/r),O=f(-(L[1][1]-v[1])/r),J=f((L[2][0]-v[0])/r),ie=f(-(L[2][1]-v[1])/r),fe=B,I=W;B=0,W=0,ee-=fe,$-=I,U-=fe,_e-=I;const Ae=[[ee,$,0,0,P-V],[U,_e,0,0,J-V],[0,0,ee,$,O-k],[0,0,U,_e,ie-k]],ne=Mc(Ae);if(ne){if(d.save(),d.beginPath(),X_()||!u){d.moveTo(P,O);const te=4,Je=V-P,Pe=k-O;for(let ue=0;ue<te;ue++)d.lineTo(P+f((ue+1)*Je/te),O+f(ue*Pe/(te-1))),ue!=te-1&&d.lineTo(P+f((ue+1)*Je/te),O+f((ue+1)*Pe/(te-1)));d.lineTo(J,ie)}else d.moveTo(P,O),d.lineTo(V,k),d.lineTo(J,ie);d.clip(),d.transform(ne[0],ne[2],ne[1],ne[3],V,k),d.translate(_[0]-fe,_[3]-I),d.scale(n/t,-n/t),d.drawImage(E.canvas,0,0),d.restore()}}),$s(E),On.push(E.canvas),c&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach(function(C,R,M){const A=C.target,L=(A[0][0]-v[0])/r,B=-(A[0][1]-v[1])/r,W=(A[1][0]-v[0])/r,ee=-(A[1][1]-v[1])/r,$=(A[2][0]-v[0])/r,U=-(A[2][1]-v[1])/r;d.beginPath(),d.moveTo(W,ee),d.lineTo(L,B),d.lineTo($,U),d.closePath(),d.stroke()}),d.restore()),d.canvas}class Z_ extends bh{constructor(e,t,n,i,r,o,a,l,h,c,u,d){super(r,H.IDLE,{interpolate:!!d}),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=i,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=i.getTileCoordExtent(this.wrappedTileCoord_),_=this.targetTileGrid_.getExtent();let p=this.sourceTileGrid_.getExtent();const y=_?fi(f,_):f;if(Hr(y)===0){this.state=H.EMPTY;return}const E=e.getExtent();E&&(p?p=fi(p,E):p=E);const w=i.getResolution(this.wrappedTileCoord_[0]),v=H_(e,n,y,w);if(!isFinite(v)||v<=0){this.state=H.EMPTY;return}const C=c!==void 0?c:z_;if(this.triangulation_=new j_(e,n,y,p,v*C,w),this.triangulation_.getTriangles().length===0){this.state=H.EMPTY;return}this.sourceZ_=t.getZForResolution(v);let R=this.triangulation_.calculateSourceExtent();if(p&&(e.canWrapX()?(R[1]=ye(R[1],p[1],p[3]),R[3]=ye(R[3],p[1],p[3])):R=fi(R,p)),!Hr(R))this.state=H.EMPTY;else{const M=t.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let A=M.minX;A<=M.maxX;A++)for(let L=M.minY;L<=M.maxY;L++){const B=h(this.sourceZ_,A,L,a);B&&this.sourceTiles_.push(B)}this.sourceTiles_.length===0&&(this.state=H.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==H.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=H.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),i=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=V_(i,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=H.LOADED}this.changed()}load(){if(this.state==H.IDLE){this.state=H.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n==H.IDLE||n==H.LOADING){e++;const i=K(t,Z.CHANGE,function(r){const o=t.getState();(o==H.LOADED||o==H.ERROR||o==H.EMPTY)&&(he(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,n,i){t.getState()==H.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(he),this.sourcesListenerKeys_=null}release(){this.canvas_&&($s(this.canvas_.getContext("2d")),On.push(this.canvas_),this.canvas_=null),super.release()}}const sl=Z_;class Mh{constructor(e,t,n,i){this.minX=e,this.maxX=t,this.minY=n,this.maxY=i}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function km(s,e,t,n,i){return i!==void 0?(i.minX=s,i.maxX=e,i.minY=t,i.maxY=n,i):new Mh(s,e,t,n)}const K_=Mh;class $_ extends gh{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=at(),this.tmpTileRange_=new K_(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),n=e.getState(),i=t.getUseInterimTilesOnError();return n==H.LOADED||n==H.EMPTY||n==H.ERROR&&!i}getTile(e,t,n,i){const r=i.pixelRatio,o=i.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(e,t,n,r,o);return h.getState()==H.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),i=xe(t.pixelToCoordinateTransform,e.slice()),r=n.getExtent();if(r&&!yo(r,i))return null;const o=t.pixelRatio,a=t.viewState.projection,l=t.viewState,h=n.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(t.pixelRatio);for(let d=c.getZForResolution(l.resolution);d>=c.getMinZoom();--d){const f=c.getTileCoordForCoordAndZ(i,d),_=h.getTile(d,f[1],f[2],o,a);if(!(_ instanceof W_||_ instanceof sl)||_ instanceof sl&&_.getState()===H.EMPTY)return null;if(_.getState()!==H.LOADED)continue;const p=c.getOrigin(d),y=Mi(c.getTileSize(d)),E=c.getResolution(d),w=Math.floor(u*((i[0]-p[0])/E-f[1]*y[0])),v=Math.floor(u*((p[1]-i[1])/E-f[2]*y[1])),C=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(_.getImage(),w+C,v+C)}return null}loadedTileCallback(e,t,n){return this.isDrawableTile(n)?super.loadedTileCallback(e,t,n):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const n=e.layerStatesArray[e.layerIndex],i=e.viewState,r=i.projection,o=i.resolution,a=i.center,l=i.rotation,h=e.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),f=u.getTileGridForProjection(r),_=f.getZForResolution(o,u.zDirection),p=f.getResolution(_);let y=e.extent;const E=e.viewState.resolution,w=u.getTilePixelRatio(h),v=Math.round(we(y)/E*h),C=Math.round(qt(y)/E*h),R=n.extent&&cn(n.extent,r);R&&(y=fi(y,cn(n.extent,r)));const M=p*v/2/w,A=p*C/2/w,L=[a[0]-M,a[1]-A,a[0]+M,a[1]+A],B=f.getTileRangeForExtentAndZ(y,_),W={};W[_]={};const ee=this.createLoadedTileFinder(u,r,W),$=this.tmpExtent,U=this.tmpTileRange_;this.newTiles_=!1;const _e=l?ca(i.center,E,l,e.size):void 0;for(let Ae=B.minX;Ae<=B.maxX;++Ae)for(let ne=B.minY;ne<=B.maxY;++ne){if(l&&!f.tileCoordIntersectsViewport([_,Ae,ne],_e))continue;const te=this.getTile(_,Ae,ne,e);if(this.isDrawableTile(te)){const ue=q(this);if(te.getState()==H.LOADED){W[_][te.tileCoord.toString()]=te;let Ge=te.inTransition(ue);Ge&&n.opacity!==1&&(te.endTransition(ue),Ge=!1),!this.newTiles_&&(Ge||!this.renderedTiles.includes(te))&&(this.newTiles_=!0)}if(te.getAlpha(ue,e.time)===1)continue}const Je=f.getTileCoordChildTileRange(te.tileCoord,U,$);let Pe=!1;Je&&(Pe=ee(_+1,Je)),Pe||f.forEachTileCoordParentTileRange(te.tileCoord,ee,U,$)}const V=p/o*h/w;vt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/h,1/h,l,-v/2,-C/2);const k=Ml(this.pixelTransform);this.useContainer(t,k,this.getBackground(e));const P=this.context,O=P.canvas;qs(this.inversePixelTransform,this.pixelTransform),vt(this.tempTransform,v/2,C/2,V,V,0,-v/2,-C/2),O.width!=v||O.height!=C?(O.width=v,O.height=C):this.containerReused||P.clearRect(0,0,v,C),R&&this.clipUnrotated(P,e,R),u.getInterpolate()||(P.imageSmoothingEnabled=!1),this.preRender(P,e),this.renderedTiles.length=0;let J=Object.keys(W).map(Number);J.sort(yn);let ie,fe,I;n.opacity===1&&(!this.containerReused||u.getOpaque(e.viewState.projection))?J=J.reverse():(ie=[],fe=[]);for(let Ae=J.length-1;Ae>=0;--Ae){const ne=J[Ae],te=u.getTilePixelSize(ne,h,r),Pe=f.getResolution(ne)/p,ue=te[0]*Pe*V,Ge=te[1]*Pe*V,Ot=f.getTileCoordForCoordAndZ(Hs(L),ne),en=f.getTileCoordExtent(Ot),et=xe(this.tempTransform,[w*(en[0]-L[0])/p,w*(L[3]-en[3])/p]),En=w*u.getGutterForProjection(r),ct=W[ne];for(const kt in ct){const ut=ct[kt],tn=ut.tileCoord,nn=Ot[1]-tn[1],Et=Math.round(et[0]-(nn-1)*ue),Nt=Ot[2]-tn[2],ei=Math.round(et[1]-(Nt-1)*Ge),Te=Math.round(et[0]-nn*ue),Ie=Math.round(et[1]-Nt*Ge),Be=Et-Te,We=ei-Ie,Gt=_===ne,dt=Gt&&ut.getAlpha(q(this),e.time)!==1;let ft=!1;if(!dt)if(ie){I=[Te,Ie,Te+Be,Ie,Te+Be,Ie+We,Te,Ie+We];for(let Ct=0,Cn=ie.length;Ct<Cn;++Ct)if(_!==ne&&ne<fe[Ct]){const Re=ie[Ct];je([Te,Ie,Te+Be,Ie+We],[Re[0],Re[3],Re[4],Re[7]])&&(ft||(P.save(),ft=!0),P.beginPath(),P.moveTo(I[0],I[1]),P.lineTo(I[2],I[3]),P.lineTo(I[4],I[5]),P.lineTo(I[6],I[7]),P.moveTo(Re[6],Re[7]),P.lineTo(Re[4],Re[5]),P.lineTo(Re[2],Re[3]),P.lineTo(Re[0],Re[1]),P.clip())}ie.push(I),fe.push(ne)}else P.clearRect(Te,Ie,Be,We);this.drawTileImage(ut,e,Te,Ie,Be,We,En,Gt),ie&&!dt?(ft&&P.restore(),this.renderedTiles.unshift(ut)):this.renderedTiles.push(ut),this.updateUsedTiles(e.usedTiles,u,ut)}}return this.renderedRevision=d,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!Wn(this.renderedExtent_,L),this.renderedExtent_=L,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(e,u,f,h,r,y,_,c.getPreload()),this.scheduleExpireCache(e,u),this.postRender(P,e),n.extent&&P.restore(),P.imageSmoothingEnabled=!0,k!==O.style.transform&&(O.style.transform=k),this.container}drawTileImage(e,t,n,i,r,o,a,l){const h=this.getTileImage(e);if(!h)return;const c=q(this),u=t.layerStatesArray[t.layerIndex],d=u.opacity*(l?e.getAlpha(c,t.time):1),f=d!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(h,a,a,h.width-2*a,h.height-2*a,n,i,r,o),f&&this.context.restore(),d!==u.opacity?t.animate=!0:l&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const n=(function(i,r,o){const a=q(i);a in o.usedTiles&&i.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,t);e.postRenderFunctions.push(n)}}updateUsedTiles(e,t,n){const i=q(t);i in e||(e[i]={}),e[i][n.getKey()]=!0}manageTilePyramid(e,t,n,i,r,o,a,l,h){const c=q(t);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],d=e.tileQueue,f=n.getMinZoom(),_=e.viewState.rotation,p=_?ca(e.viewState.center,e.viewState.resolution,_,e.size):void 0;let y=0,E,w,v,C,R,M;for(M=f;M<=a;++M)for(w=n.getTileRangeForExtentAndZ(o,M,w),v=n.getResolution(M),C=w.minX;C<=w.maxX;++C)for(R=w.minY;R<=w.maxY;++R)_&&!n.tileCoordIntersectsViewport([M,C,R],p)||(a-M<=l?(++y,E=t.getTile(M,C,R,i,r),E.getState()==H.IDLE&&(u[E.getKey()]=!0,d.isKeyQueued(E.getKey())||d.enqueue([E,c,n.getTileCoordCenter(E.tileCoord),v])),h!==void 0&&h(E)):t.useTile(M,C,R,r));t.updateCacheSize(y,r)}}const q_=$_;class J_ extends k_{constructor(e){super(e)}createRenderer(){return new q_(this)}}const rl=J_;var Mr=["onChange","onClose","onDayCreate","onDestroy","onKeyDown","onMonthChange","onOpen","onParseConfig","onReady","onValueUpdate","onYearChange","onPreCalendarPosition"],kn={_disable:[],allowInput:!1,allowInvalidPreload:!1,altFormat:"F j, Y",altInput:!1,altInputClass:"form-control input",animate:typeof window=="object"&&window.navigator.userAgent.indexOf("MSIE")===-1,ariaDateFormat:"F j, Y",autoFillDefaultTime:!0,clickOpens:!0,closeOnSelect:!0,conjunction:", ",dateFormat:"Y-m-d",defaultHour:12,defaultMinute:0,defaultSeconds:0,disable:[],disableMobile:!1,enableSeconds:!1,enableTime:!1,errorHandler:function(s){return typeof console<"u"&&console.warn(s)},getWeek:function(s){var e=new Date(s.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)},hourIncrement:1,ignoredFocusElements:[],inline:!1,locale:"default",minuteIncrement:5,mode:"single",monthSelectorType:"dropdown",nextArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M13.207 8.472l-7.854 7.854-0.707-0.707 7.146-7.146-7.146-7.148 0.707-0.707 7.854 7.854z' /></svg>",noCalendar:!1,now:new Date,onChange:[],onClose:[],onDayCreate:[],onDestroy:[],onKeyDown:[],onMonthChange:[],onOpen:[],onParseConfig:[],onReady:[],onValueUpdate:[],onYearChange:[],onPreCalendarPosition:[],plugins:[],position:"auto",positionElement:void 0,prevArrow:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M5.207 8.471l7.146 7.147-0.707 0.707-7.853-7.854 7.854-7.853 0.707 0.707-7.147 7.146z' /></svg>",shorthandCurrentMonth:!1,showMonths:1,static:!1,time_24hr:!1,weekNumbers:!1,wrap:!1},Oi={weekdays:{shorthand:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longhand:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{shorthand:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longhand:["January","February","March","April","May","June","July","August","September","October","November","December"]},daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0,ordinal:function(s){var e=s%100;if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},rangeSeparator:" to ",weekAbbreviation:"Wk",scrollTitle:"Scroll to increment",toggleTitle:"Click to toggle",amPM:["AM","PM"],yearAriaLabel:"Year",monthAriaLabel:"Month",hourAriaLabel:"Hour",minuteAriaLabel:"Minute",time_24hr:!1},ze=function(s,e){return e===void 0&&(e=2),("000"+s).slice(e*-1)},Qe=function(s){return s===!0?1:0};function ol(s,e){var t;return function(){var n=this,i=arguments;clearTimeout(t),t=setTimeout(function(){return s.apply(n,i)},e)}}var Dr=function(s){return s instanceof Array?s:[s]};function Oe(s,e,t){if(t===!0)return s.classList.add(e);s.classList.remove(e)}function se(s,e,t){var n=window.document.createElement(s);return e=e||"",t=t||"",n.className=e,t!==void 0&&(n.textContent=t),n}function _s(s){for(;s.firstChild;)s.removeChild(s.firstChild)}function Dh(s,e){if(e(s))return s;if(s.parentNode)return Dh(s.parentNode,e)}function ms(s,e){var t=se("div","numInputWrapper"),n=se("input","numInput "+s),i=se("span","arrowUp"),r=se("span","arrowDown");if(navigator.userAgent.indexOf("MSIE 9.0")===-1?n.type="number":(n.type="text",n.pattern="\\d*"),e!==void 0)for(var o in e)n.setAttribute(o,e[o]);return t.appendChild(n),t.appendChild(i),t.appendChild(r),t}function Ze(s){try{if(typeof s.composedPath=="function"){var e=s.composedPath();return e[0]}return s.target}catch{return s.target}}var Lr=function(){},zs=function(s,e,t){return t.months[e?"shorthand":"longhand"][s]},Q_={D:Lr,F:function(s,e,t){s.setMonth(t.months.longhand.indexOf(e))},G:function(s,e){s.setHours((s.getHours()>=12?12:0)+parseFloat(e))},H:function(s,e){s.setHours(parseFloat(e))},J:function(s,e){s.setDate(parseFloat(e))},K:function(s,e,t){s.setHours(s.getHours()%12+12*Qe(new RegExp(t.amPM[1],"i").test(e)))},M:function(s,e,t){s.setMonth(t.months.shorthand.indexOf(e))},S:function(s,e){s.setSeconds(parseFloat(e))},U:function(s,e){return new Date(parseFloat(e)*1e3)},W:function(s,e,t){var n=parseInt(e),i=new Date(s.getFullYear(),0,2+(n-1)*7,0,0,0,0);return i.setDate(i.getDate()-i.getDay()+t.firstDayOfWeek),i},Y:function(s,e){s.setFullYear(parseFloat(e))},Z:function(s,e){return new Date(e)},d:function(s,e){s.setDate(parseFloat(e))},h:function(s,e){s.setHours((s.getHours()>=12?12:0)+parseFloat(e))},i:function(s,e){s.setMinutes(parseFloat(e))},j:function(s,e){s.setDate(parseFloat(e))},l:Lr,m:function(s,e){s.setMonth(parseFloat(e)-1)},n:function(s,e){s.setMonth(parseFloat(e)-1)},s:function(s,e){s.setSeconds(parseFloat(e))},u:function(s,e){return new Date(parseFloat(e))},w:Lr,y:function(s,e){s.setFullYear(2e3+parseFloat(e))}},ln={D:"",F:"",G:"(\\d\\d|\\d)",H:"(\\d\\d|\\d)",J:"(\\d\\d|\\d)\\w+",K:"",M:"",S:"(\\d\\d|\\d)",U:"(.+)",W:"(\\d\\d|\\d)",Y:"(\\d{4})",Z:"(.+)",d:"(\\d\\d|\\d)",h:"(\\d\\d|\\d)",i:"(\\d\\d|\\d)",j:"(\\d\\d|\\d)",l:"",m:"(\\d\\d|\\d)",n:"(\\d\\d|\\d)",s:"(\\d\\d|\\d)",u:"(.+)",w:"(\\d\\d|\\d)",y:"(\\d{2})"},mi={Z:function(s){return s.toISOString()},D:function(s,e,t){return e.weekdays.shorthand[mi.w(s,e,t)]},F:function(s,e,t){return zs(mi.n(s,e,t)-1,!1,e)},G:function(s,e,t){return ze(mi.h(s,e,t))},H:function(s){return ze(s.getHours())},J:function(s,e){return e.ordinal!==void 0?s.getDate()+e.ordinal(s.getDate()):s.getDate()},K:function(s,e){return e.amPM[Qe(s.getHours()>11)]},M:function(s,e){return zs(s.getMonth(),!0,e)},S:function(s){return ze(s.getSeconds())},U:function(s){return s.getTime()/1e3},W:function(s,e,t){return t.getWeek(s)},Y:function(s){return ze(s.getFullYear(),4)},d:function(s){return ze(s.getDate())},h:function(s){return s.getHours()%12?s.getHours()%12:12},i:function(s){return ze(s.getMinutes())},j:function(s){return s.getDate()},l:function(s,e){return e.weekdays.longhand[s.getDay()]},m:function(s){return ze(s.getMonth()+1)},n:function(s){return s.getMonth()+1},s:function(s){return s.getSeconds()},u:function(s){return s.getTime()},w:function(s){return s.getDay()},y:function(s){return String(s.getFullYear()).substring(2)}},Lh=function(s){var e=s.config,t=e===void 0?kn:e,n=s.l10n,i=n===void 0?Oi:n,r=s.isMobile,o=r===void 0?!1:r;return function(a,l,h){var c=h||i;return t.formatDate!==void 0&&!o?t.formatDate(a,l,c):l.split("").map(function(u,d,f){return mi[u]&&f[d-1]!=="\\"?mi[u](a,c,t):u!=="\\"?u:""}).join("")}},ao=function(s){var e=s.config,t=e===void 0?kn:e,n=s.l10n,i=n===void 0?Oi:n;return function(r,o,a,l){if(!(r!==0&&!r)){var h=l||i,c,u=r;if(r instanceof Date)c=new Date(r.getTime());else if(typeof r!="string"&&r.toFixed!==void 0)c=new Date(r);else if(typeof r=="string"){var d=o||(t||kn).dateFormat,f=String(r).trim();if(f==="today")c=new Date,a=!0;else if(t&&t.parseDate)c=t.parseDate(r,d);else if(/Z$/.test(f)||/GMT$/.test(f))c=new Date(r);else{for(var _=void 0,p=[],y=0,E=0,w="";y<d.length;y++){var v=d[y],C=v==="\\",R=d[y-1]==="\\"||C;if(ln[v]&&!R){w+=ln[v];var M=new RegExp(w).exec(r);M&&(_=!0)&&p[v!=="Y"?"push":"unshift"]({fn:Q_[v],val:M[++E]})}else C||(w+=".")}c=!t||!t.noCalendar?new Date(new Date().getFullYear(),0,1,0,0,0,0):new Date(new Date().setHours(0,0,0,0)),p.forEach(function(A){var L=A.fn,B=A.val;return c=L(c,B,h)||c}),c=_?c:void 0}}if(!(c instanceof Date&&!isNaN(c.getTime()))){t.errorHandler(new Error("Invalid date provided: "+u));return}return a===!0&&c.setHours(0,0,0,0),c}}};function Ke(s,e,t){return t===void 0&&(t=!0),t!==!1?new Date(s.getTime()).setHours(0,0,0,0)-new Date(e.getTime()).setHours(0,0,0,0):s.getTime()-e.getTime()}var em=function(s,e,t){return s>Math.min(e,t)&&s<Math.max(e,t)},Ar=function(s,e,t){return s*3600+e*60+t},tm=function(s){var e=Math.floor(s/3600),t=(s-e*3600)/60;return[e,t,s-e*3600-t*60]},nm={DAY:864e5};function Pr(s){var e=s.defaultHour,t=s.defaultMinute,n=s.defaultSeconds;if(s.minDate!==void 0){var i=s.minDate.getHours(),r=s.minDate.getMinutes(),o=s.minDate.getSeconds();e<i&&(e=i),e===i&&t<r&&(t=r),e===i&&t===r&&n<o&&(n=s.minDate.getSeconds())}if(s.maxDate!==void 0){var a=s.maxDate.getHours(),l=s.maxDate.getMinutes();e=Math.min(e,a),e===a&&(t=Math.min(l,t)),e===a&&t===l&&(n=s.maxDate.getSeconds())}return{hours:e,minutes:t,seconds:n}}typeof Object.assign!="function"&&(Object.assign=function(s){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];if(!s)throw TypeError("Cannot convert undefined or null to object");for(var n=function(a){a&&Object.keys(a).forEach(function(l){return s[l]=a[l]})},i=0,r=e;i<r.length;i++){var o=r[i];n(o)}return s});var De=globalThis&&globalThis.__assign||function(){return De=Object.assign||function(s){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])}return s},De.apply(this,arguments)},al=globalThis&&globalThis.__spreadArrays||function(){for(var s=0,e=0,t=arguments.length;e<t;e++)s+=arguments[e].length;for(var n=Array(s),i=0,e=0;e<t;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)n[i]=r[o];return n},im=300;function sm(s,e){var t={config:De(De({},kn),me.defaultConfig),l10n:Oi};t.parseDate=ao({config:t.config,l10n:t.l10n}),t._handlers=[],t.pluginElements=[],t.loadedPlugins=[],t._bind=p,t._setHoursFromDate=d,t._positionCalendar=Et,t.changeMonth=fe,t.changeYear=Pe,t.clear=I,t.close=Ae,t.onMouseOver=et,t._createElement=se,t.createDay=M,t.destroy=ne,t.isEnabled=ue,t.jumpToDate=w,t.updateValue=Fe,t.open=ct,t.redraw=Te,t.set=Gt,t.setDate=ft,t.toggle=or;function n(){t.utils={getDaysInMonth:function(g,m){return g===void 0&&(g=t.currentMonth),m===void 0&&(m=t.currentYear),g===1&&(m%4===0&&m%100!==0||m%400===0)?29:t.l10n.daysInMonth[g]}}}function i(){t.element=t.input=s,t.isOpen=!1,ut(),nn(),Re(),Cn(),n(),t.isMobile||R(),E(),(t.selectedDates.length||t.config.noCalendar)&&(t.config.enableTime&&d(t.config.noCalendar?t.latestSelectedDateObj:void 0),Fe(!1)),a();var g=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);!t.isMobile&&g&&Et(),ce("onReady")}function r(){var g;return((g=t.calendarContainer)===null||g===void 0?void 0:g.getRootNode()).activeElement||document.activeElement}function o(g){return g.bind(t)}function a(){var g=t.config;g.weekNumbers===!1&&g.showMonths===1||g.noCalendar!==!0&&window.requestAnimationFrame(function(){if(t.calendarContainer!==void 0&&(t.calendarContainer.style.visibility="hidden",t.calendarContainer.style.display="block"),t.daysContainer!==void 0){var m=(t.days.offsetWidth+1)*g.showMonths;t.daysContainer.style.width=m+"px",t.calendarContainer.style.width=m+(t.weekWrapper!==void 0?t.weekWrapper.offsetWidth:0)+"px",t.calendarContainer.style.removeProperty("visibility"),t.calendarContainer.style.removeProperty("display")}})}function l(g){if(t.selectedDates.length===0){var m=t.config.minDate===void 0||Ke(new Date,t.config.minDate)>=0?new Date:new Date(t.config.minDate.getTime()),x=Pr(t.config);m.setHours(x.hours,x.minutes,x.seconds,m.getMilliseconds()),t.selectedDates=[m],t.latestSelectedDateObj=m}g!==void 0&&g.type!=="blur"&&qi(g);var T=t._input.value;u(),Fe(),t._input.value!==T&&t._debouncedChange()}function h(g,m){return g%12+12*Qe(m===t.l10n.amPM[1])}function c(g){switch(g%24){case 0:case 12:return 12;default:return g%12}}function u(){if(!(t.hourElement===void 0||t.minuteElement===void 0)){var g=(parseInt(t.hourElement.value.slice(-2),10)||0)%24,m=(parseInt(t.minuteElement.value,10)||0)%60,x=t.secondElement!==void 0?(parseInt(t.secondElement.value,10)||0)%60:0;t.amPM!==void 0&&(g=h(g,t.amPM.textContent));var T=t.config.minTime!==void 0||t.config.minDate&&t.minDateHasTime&&t.latestSelectedDateObj&&Ke(t.latestSelectedDateObj,t.config.minDate,!0)===0,S=t.config.maxTime!==void 0||t.config.maxDate&&t.maxDateHasTime&&t.latestSelectedDateObj&&Ke(t.latestSelectedDateObj,t.config.maxDate,!0)===0;if(t.config.maxTime!==void 0&&t.config.minTime!==void 0&&t.config.minTime>t.config.maxTime){var b=Ar(t.config.minTime.getHours(),t.config.minTime.getMinutes(),t.config.minTime.getSeconds()),j=Ar(t.config.maxTime.getHours(),t.config.maxTime.getMinutes(),t.config.maxTime.getSeconds()),F=Ar(g,m,x);if(F>j&&F<b){var z=tm(b);g=z[0],m=z[1],x=z[2]}}else{if(S){var D=t.config.maxTime!==void 0?t.config.maxTime:t.config.maxDate;g=Math.min(g,D.getHours()),g===D.getHours()&&(m=Math.min(m,D.getMinutes())),m===D.getMinutes()&&(x=Math.min(x,D.getSeconds()))}if(T){var G=t.config.minTime!==void 0?t.config.minTime:t.config.minDate;g=Math.max(g,G.getHours()),g===G.getHours()&&m<G.getMinutes()&&(m=G.getMinutes()),m===G.getMinutes()&&(x=Math.max(x,G.getSeconds()))}}f(g,m,x)}}function d(g){var m=g||t.latestSelectedDateObj;m&&m instanceof Date&&f(m.getHours(),m.getMinutes(),m.getSeconds())}function f(g,m,x){t.latestSelectedDateObj!==void 0&&t.latestSelectedDateObj.setHours(g%24,m,x||0,0),!(!t.hourElement||!t.minuteElement||t.isMobile)&&(t.hourElement.value=ze(t.config.time_24hr?g:(12+g)%12+12*Qe(g%12===0)),t.minuteElement.value=ze(m),t.amPM!==void 0&&(t.amPM.textContent=t.l10n.amPM[Qe(g>=12)]),t.secondElement!==void 0&&(t.secondElement.value=ze(x)))}function _(g){var m=Ze(g),x=parseInt(m.value)+(g.delta||0);(x/1e3>1||g.key==="Enter"&&!/[^\d]/.test(x.toString()))&&Pe(x)}function p(g,m,x,T){if(m instanceof Array)return m.forEach(function(S){return p(g,S,x,T)});if(g instanceof Array)return g.forEach(function(S){return p(S,m,x,T)});g.addEventListener(m,x,T),t._handlers.push({remove:function(){return g.removeEventListener(m,x,T)}})}function y(){ce("onChange")}function E(){if(t.config.wrap&&["open","close","toggle","clear"].forEach(function(x){Array.prototype.forEach.call(t.element.querySelectorAll("[data-"+x+"]"),function(T){return p(T,"click",t[x])})}),t.isMobile){rr();return}var g=ol(En,50);if(t._debouncedChange=ol(y,im),t.daysContainer&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)&&p(t.daysContainer,"mouseover",function(x){t.config.mode==="range"&&et(Ze(x))}),p(t._input,"keydown",en),t.calendarContainer!==void 0&&p(t.calendarContainer,"keydown",en),!t.config.inline&&!t.config.static&&p(window,"resize",g),window.ontouchstart!==void 0?p(window.document,"touchstart",Je):p(window.document,"mousedown",Je),p(window.document,"focus",Je,{capture:!0}),t.config.clickOpens===!0&&(p(t._input,"focus",t.open),p(t._input,"click",t.open)),t.daysContainer!==void 0&&(p(t.monthNav,"click",rn),p(t.monthNav,["keyup","increment"],_),p(t.daysContainer,"click",Be)),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0){var m=function(x){return Ze(x).select()};p(t.timeContainer,["increment"],l),p(t.timeContainer,"blur",l,{capture:!0}),p(t.timeContainer,"click",v),p([t.hourElement,t.minuteElement],["focus","click"],m),t.secondElement!==void 0&&p(t.secondElement,"focus",function(){return t.secondElement&&t.secondElement.select()}),t.amPM!==void 0&&p(t.amPM,"click",function(x){l(x)})}t.config.allowInput&&p(t._input,"blur",Ot)}function w(g,m){var x=g!==void 0?t.parseDate(g):t.latestSelectedDateObj||(t.config.minDate&&t.config.minDate>t.now?t.config.minDate:t.config.maxDate&&t.config.maxDate<t.now?t.config.maxDate:t.now),T=t.currentYear,S=t.currentMonth;try{x!==void 0&&(t.currentYear=x.getFullYear(),t.currentMonth=x.getMonth())}catch(b){b.message="Invalid date supplied: "+x,t.config.errorHandler(b)}m&&t.currentYear!==T&&(ce("onYearChange"),U()),m&&(t.currentYear!==T||t.currentMonth!==S)&&ce("onMonthChange"),t.redraw()}function v(g){var m=Ze(g);~m.className.indexOf("arrow")&&C(g,m.classList.contains("arrowUp")?1:-1)}function C(g,m,x){var T=g&&Ze(g),S=x||T&&T.parentNode&&T.parentNode.firstChild,b=Tn("increment");b.delta=m,S&&S.dispatchEvent(b)}function R(){var g=window.document.createDocumentFragment();if(t.calendarContainer=se("div","flatpickr-calendar"),t.calendarContainer.tabIndex=-1,!t.config.noCalendar){if(g.appendChild(k()),t.innerContainer=se("div","flatpickr-innerContainer"),t.config.weekNumbers){var m=ie(),x=m.weekWrapper,T=m.weekNumbers;t.innerContainer.appendChild(x),t.weekNumbers=T,t.weekWrapper=x}t.rContainer=se("div","flatpickr-rContainer"),t.rContainer.appendChild(O()),t.daysContainer||(t.daysContainer=se("div","flatpickr-days"),t.daysContainer.tabIndex=-1),$(),t.rContainer.appendChild(t.daysContainer),t.innerContainer.appendChild(t.rContainer),g.appendChild(t.innerContainer)}t.config.enableTime&&g.appendChild(P()),Oe(t.calendarContainer,"rangeMode",t.config.mode==="range"),Oe(t.calendarContainer,"animate",t.config.animate===!0),Oe(t.calendarContainer,"multiMonth",t.config.showMonths>1),t.calendarContainer.appendChild(g);var S=t.config.appendTo!==void 0&&t.config.appendTo.nodeType!==void 0;if((t.config.inline||t.config.static)&&(t.calendarContainer.classList.add(t.config.inline?"inline":"static"),t.config.inline&&(!S&&t.element.parentNode?t.element.parentNode.insertBefore(t.calendarContainer,t._input.nextSibling):t.config.appendTo!==void 0&&t.config.appendTo.appendChild(t.calendarContainer)),t.config.static)){var b=se("div","flatpickr-wrapper");t.element.parentNode&&t.element.parentNode.insertBefore(b,t.element),b.appendChild(t.element),t.altInput&&b.appendChild(t.altInput),b.appendChild(t.calendarContainer)}!t.config.static&&!t.config.inline&&(t.config.appendTo!==void 0?t.config.appendTo:window.document.body).appendChild(t.calendarContainer)}function M(g,m,x,T){var S=ue(m,!0),b=se("span",g,m.getDate().toString());return b.dateObj=m,b.$i=T,b.setAttribute("aria-label",t.formatDate(m,t.config.ariaDateFormat)),g.indexOf("hidden")===-1&&Ke(m,t.now)===0&&(t.todayDateElem=b,b.classList.add("today"),b.setAttribute("aria-current","date")),S?(b.tabIndex=-1,sn(m)&&(b.classList.add("selected"),t.selectedDateElem=b,t.config.mode==="range"&&(Oe(b,"startRange",t.selectedDates[0]&&Ke(m,t.selectedDates[0],!0)===0),Oe(b,"endRange",t.selectedDates[1]&&Ke(m,t.selectedDates[1],!0)===0),g==="nextMonthDay"&&b.classList.add("inRange")))):b.classList.add("flatpickr-disabled"),t.config.mode==="range"&&$i(m)&&!sn(m)&&b.classList.add("inRange"),t.weekNumbers&&t.config.showMonths===1&&g!=="prevMonthDay"&&T%7===6&&t.weekNumbers.insertAdjacentHTML("beforeend","<span class='flatpickr-day'>"+t.config.getWeek(m)+"</span>"),ce("onDayCreate",b),b}function A(g){g.focus(),t.config.mode==="range"&&et(g)}function L(g){for(var m=g>0?0:t.config.showMonths-1,x=g>0?t.config.showMonths:-1,T=m;T!=x;T+=g)for(var S=t.daysContainer.children[T],b=g>0?0:S.children.length-1,j=g>0?S.children.length:-1,F=b;F!=j;F+=g){var z=S.children[F];if(z.className.indexOf("hidden")===-1&&ue(z.dateObj))return z}}function B(g,m){for(var x=g.className.indexOf("Month")===-1?g.dateObj.getMonth():t.currentMonth,T=m>0?t.config.showMonths:-1,S=m>0?1:-1,b=x-t.currentMonth;b!=T;b+=S)for(var j=t.daysContainer.children[b],F=x-t.currentMonth===b?g.$i+m:m<0?j.children.length-1:0,z=j.children.length,D=F;D>=0&&D<z&&D!=(m>0?z:-1);D+=S){var G=j.children[D];if(G.className.indexOf("hidden")===-1&&ue(G.dateObj)&&Math.abs(g.$i-D)>=Math.abs(m))return A(G)}t.changeMonth(S),W(L(S),0)}function W(g,m){var x=r(),T=Ge(x||document.body),S=g!==void 0?g:T?x:t.selectedDateElem!==void 0&&Ge(t.selectedDateElem)?t.selectedDateElem:t.todayDateElem!==void 0&&Ge(t.todayDateElem)?t.todayDateElem:L(m>0?1:-1);S===void 0?t._input.focus():T?B(S,m):A(S)}function ee(g,m){for(var x=(new Date(g,m,1).getDay()-t.l10n.firstDayOfWeek+7)%7,T=t.utils.getDaysInMonth((m-1+12)%12,g),S=t.utils.getDaysInMonth(m,g),b=window.document.createDocumentFragment(),j=t.config.showMonths>1,F=j?"prevMonthDay hidden":"prevMonthDay",z=j?"nextMonthDay hidden":"nextMonthDay",D=T+1-x,G=0;D<=T;D++,G++)b.appendChild(M("flatpickr-day "+F,new Date(g,m-1,D),D,G));for(D=1;D<=S;D++,G++)b.appendChild(M("flatpickr-day",new Date(g,m,D),D,G));for(var le=S+1;le<=42-x&&(t.config.showMonths===1||G%7!==0);le++,G++)b.appendChild(M("flatpickr-day "+z,new Date(g,m+1,le%S),le,G));var gt=se("div","dayContainer");return gt.appendChild(b),gt}function $(){if(t.daysContainer!==void 0){_s(t.daysContainer),t.weekNumbers&&_s(t.weekNumbers);for(var g=document.createDocumentFragment(),m=0;m<t.config.showMonths;m++){var x=new Date(t.currentYear,t.currentMonth,1);x.setMonth(t.currentMonth+m),g.appendChild(ee(x.getFullYear(),x.getMonth()))}t.daysContainer.appendChild(g),t.days=t.daysContainer.firstChild,t.config.mode==="range"&&t.selectedDates.length===1&&et()}}function U(){if(!(t.config.showMonths>1||t.config.monthSelectorType!=="dropdown")){var g=function(T){return t.config.minDate!==void 0&&t.currentYear===t.config.minDate.getFullYear()&&T<t.config.minDate.getMonth()?!1:!(t.config.maxDate!==void 0&&t.currentYear===t.config.maxDate.getFullYear()&&T>t.config.maxDate.getMonth())};t.monthsDropdownContainer.tabIndex=-1,t.monthsDropdownContainer.innerHTML="";for(var m=0;m<12;m++)if(g(m)){var x=se("option","flatpickr-monthDropdown-month");x.value=new Date(t.currentYear,m).getMonth().toString(),x.textContent=zs(m,t.config.shorthandCurrentMonth,t.l10n),x.tabIndex=-1,t.currentMonth===m&&(x.selected=!0),t.monthsDropdownContainer.appendChild(x)}}}function _e(){var g=se("div","flatpickr-month"),m=window.document.createDocumentFragment(),x;t.config.showMonths>1||t.config.monthSelectorType==="static"?x=se("span","cur-month"):(t.monthsDropdownContainer=se("select","flatpickr-monthDropdown-months"),t.monthsDropdownContainer.setAttribute("aria-label",t.l10n.monthAriaLabel),p(t.monthsDropdownContainer,"change",function(j){var F=Ze(j),z=parseInt(F.value,10);t.changeMonth(z-t.currentMonth),ce("onMonthChange")}),U(),x=t.monthsDropdownContainer);var T=ms("cur-year",{tabindex:"-1"}),S=T.getElementsByTagName("input")[0];S.setAttribute("aria-label",t.l10n.yearAriaLabel),t.config.minDate&&S.setAttribute("min",t.config.minDate.getFullYear().toString()),t.config.maxDate&&(S.setAttribute("max",t.config.maxDate.getFullYear().toString()),S.disabled=!!t.config.minDate&&t.config.minDate.getFullYear()===t.config.maxDate.getFullYear());var b=se("div","flatpickr-current-month");return b.appendChild(x),b.appendChild(T),m.appendChild(b),g.appendChild(m),{container:g,yearElement:S,monthElement:x}}function V(){_s(t.monthNav),t.monthNav.appendChild(t.prevMonthNav),t.config.showMonths&&(t.yearElements=[],t.monthElements=[]);for(var g=t.config.showMonths;g--;){var m=_e();t.yearElements.push(m.yearElement),t.monthElements.push(m.monthElement),t.monthNav.appendChild(m.container)}t.monthNav.appendChild(t.nextMonthNav)}function k(){return t.monthNav=se("div","flatpickr-months"),t.yearElements=[],t.monthElements=[],t.prevMonthNav=se("span","flatpickr-prev-month"),t.prevMonthNav.innerHTML=t.config.prevArrow,t.nextMonthNav=se("span","flatpickr-next-month"),t.nextMonthNav.innerHTML=t.config.nextArrow,V(),Object.defineProperty(t,"_hidePrevMonthArrow",{get:function(){return t.__hidePrevMonthArrow},set:function(g){t.__hidePrevMonthArrow!==g&&(Oe(t.prevMonthNav,"flatpickr-disabled",g),t.__hidePrevMonthArrow=g)}}),Object.defineProperty(t,"_hideNextMonthArrow",{get:function(){return t.__hideNextMonthArrow},set:function(g){t.__hideNextMonthArrow!==g&&(Oe(t.nextMonthNav,"flatpickr-disabled",g),t.__hideNextMonthArrow=g)}}),t.currentYearElement=t.yearElements[0],Bt(),t.monthNav}function P(){t.calendarContainer.classList.add("hasTime"),t.config.noCalendar&&t.calendarContainer.classList.add("noCalendar");var g=Pr(t.config);t.timeContainer=se("div","flatpickr-time"),t.timeContainer.tabIndex=-1;var m=se("span","flatpickr-time-separator",":"),x=ms("flatpickr-hour",{"aria-label":t.l10n.hourAriaLabel});t.hourElement=x.getElementsByTagName("input")[0];var T=ms("flatpickr-minute",{"aria-label":t.l10n.minuteAriaLabel});if(t.minuteElement=T.getElementsByTagName("input")[0],t.hourElement.tabIndex=t.minuteElement.tabIndex=-1,t.hourElement.value=ze(t.latestSelectedDateObj?t.latestSelectedDateObj.getHours():t.config.time_24hr?g.hours:c(g.hours)),t.minuteElement.value=ze(t.latestSelectedDateObj?t.latestSelectedDateObj.getMinutes():g.minutes),t.hourElement.setAttribute("step",t.config.hourIncrement.toString()),t.minuteElement.setAttribute("step",t.config.minuteIncrement.toString()),t.hourElement.setAttribute("min",t.config.time_24hr?"0":"1"),t.hourElement.setAttribute("max",t.config.time_24hr?"23":"12"),t.hourElement.setAttribute("maxlength","2"),t.minuteElement.setAttribute("min","0"),t.minuteElement.setAttribute("max","59"),t.minuteElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(x),t.timeContainer.appendChild(m),t.timeContainer.appendChild(T),t.config.time_24hr&&t.timeContainer.classList.add("time24hr"),t.config.enableSeconds){t.timeContainer.classList.add("hasSeconds");var S=ms("flatpickr-second");t.secondElement=S.getElementsByTagName("input")[0],t.secondElement.value=ze(t.latestSelectedDateObj?t.latestSelectedDateObj.getSeconds():g.seconds),t.secondElement.setAttribute("step",t.minuteElement.getAttribute("step")),t.secondElement.setAttribute("min","0"),t.secondElement.setAttribute("max","59"),t.secondElement.setAttribute("maxlength","2"),t.timeContainer.appendChild(se("span","flatpickr-time-separator",":")),t.timeContainer.appendChild(S)}return t.config.time_24hr||(t.amPM=se("span","flatpickr-am-pm",t.l10n.amPM[Qe((t.latestSelectedDateObj?t.hourElement.value:t.config.defaultHour)>11)]),t.amPM.title=t.l10n.toggleTitle,t.amPM.tabIndex=-1,t.timeContainer.appendChild(t.amPM)),t.timeContainer}function O(){t.weekdayContainer?_s(t.weekdayContainer):t.weekdayContainer=se("div","flatpickr-weekdays");for(var g=t.config.showMonths;g--;){var m=se("div","flatpickr-weekdaycontainer");t.weekdayContainer.appendChild(m)}return J(),t.weekdayContainer}function J(){if(t.weekdayContainer){var g=t.l10n.firstDayOfWeek,m=al(t.l10n.weekdays.shorthand);g>0&&g<m.length&&(m=al(m.splice(g,m.length),m.splice(0,g)));for(var x=t.config.showMonths;x--;)t.weekdayContainer.children[x].innerHTML=`
      <span class='flatpickr-weekday'>
        `+m.join("</span><span class='flatpickr-weekday'>")+`
      </span>
      `}}function ie(){t.calendarContainer.classList.add("hasWeeks");var g=se("div","flatpickr-weekwrapper");g.appendChild(se("span","flatpickr-weekday",t.l10n.weekAbbreviation));var m=se("div","flatpickr-weeks");return g.appendChild(m),{weekWrapper:g,weekNumbers:m}}function fe(g,m){m===void 0&&(m=!0);var x=m?g:g-t.currentMonth;x<0&&t._hidePrevMonthArrow===!0||x>0&&t._hideNextMonthArrow===!0||(t.currentMonth+=x,(t.currentMonth<0||t.currentMonth>11)&&(t.currentYear+=t.currentMonth>11?1:-1,t.currentMonth=(t.currentMonth+12)%12,ce("onYearChange"),U()),$(),ce("onMonthChange"),Bt())}function I(g,m){if(g===void 0&&(g=!0),m===void 0&&(m=!0),t.input.value="",t.altInput!==void 0&&(t.altInput.value=""),t.mobileInput!==void 0&&(t.mobileInput.value=""),t.selectedDates=[],t.latestSelectedDateObj=void 0,m===!0&&(t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth()),t.config.enableTime===!0){var x=Pr(t.config),T=x.hours,S=x.minutes,b=x.seconds;f(T,S,b)}t.redraw(),g&&ce("onChange")}function Ae(){t.isOpen=!1,t.isMobile||(t.calendarContainer!==void 0&&t.calendarContainer.classList.remove("open"),t._input!==void 0&&t._input.classList.remove("active")),ce("onClose")}function ne(){t.config!==void 0&&ce("onDestroy");for(var g=t._handlers.length;g--;)t._handlers[g].remove();if(t._handlers=[],t.mobileInput)t.mobileInput.parentNode&&t.mobileInput.parentNode.removeChild(t.mobileInput),t.mobileInput=void 0;else if(t.calendarContainer&&t.calendarContainer.parentNode)if(t.config.static&&t.calendarContainer.parentNode){var m=t.calendarContainer.parentNode;if(m.lastChild&&m.removeChild(m.lastChild),m.parentNode){for(;m.firstChild;)m.parentNode.insertBefore(m.firstChild,m);m.parentNode.removeChild(m)}}else t.calendarContainer.parentNode.removeChild(t.calendarContainer);t.altInput&&(t.input.type="text",t.altInput.parentNode&&t.altInput.parentNode.removeChild(t.altInput),delete t.altInput),t.input&&(t.input.type=t.input._type,t.input.classList.remove("flatpickr-input"),t.input.removeAttribute("readonly")),["_showTimeInput","latestSelectedDateObj","_hideNextMonthArrow","_hidePrevMonthArrow","__hideNextMonthArrow","__hidePrevMonthArrow","isMobile","isOpen","selectedDateElem","minDateHasTime","maxDateHasTime","days","daysContainer","_input","_positionElement","innerContainer","rContainer","monthNav","todayDateElem","calendarContainer","weekdayContainer","prevMonthNav","nextMonthNav","monthsDropdownContainer","currentMonthElement","currentYearElement","navigationCurrentMonth","selectedDateElem","config"].forEach(function(x){try{delete t[x]}catch{}})}function te(g){return t.calendarContainer.contains(g)}function Je(g){if(t.isOpen&&!t.config.inline){var m=Ze(g),x=te(m),T=m===t.input||m===t.altInput||t.element.contains(m)||g.path&&g.path.indexOf&&(~g.path.indexOf(t.input)||~g.path.indexOf(t.altInput)),S=!T&&!x&&!te(g.relatedTarget),b=!t.config.ignoredFocusElements.some(function(j){return j.contains(m)});S&&b&&(t.config.allowInput&&t.setDate(t._input.value,!1,t.config.altInput?t.config.altFormat:t.config.dateFormat),t.timeContainer!==void 0&&t.minuteElement!==void 0&&t.hourElement!==void 0&&t.input.value!==""&&t.input.value!==void 0&&l(),t.close(),t.config&&t.config.mode==="range"&&t.selectedDates.length===1&&t.clear(!1))}}function Pe(g){if(!(!g||t.config.minDate&&g<t.config.minDate.getFullYear()||t.config.maxDate&&g>t.config.maxDate.getFullYear())){var m=g,x=t.currentYear!==m;t.currentYear=m||t.currentYear,t.config.maxDate&&t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth=Math.min(t.config.maxDate.getMonth(),t.currentMonth):t.config.minDate&&t.currentYear===t.config.minDate.getFullYear()&&(t.currentMonth=Math.max(t.config.minDate.getMonth(),t.currentMonth)),x&&(t.redraw(),ce("onYearChange"),U())}}function ue(g,m){var x;m===void 0&&(m=!0);var T=t.parseDate(g,void 0,m);if(t.config.minDate&&T&&Ke(T,t.config.minDate,m!==void 0?m:!t.minDateHasTime)<0||t.config.maxDate&&T&&Ke(T,t.config.maxDate,m!==void 0?m:!t.maxDateHasTime)>0)return!1;if(!t.config.enable&&t.config.disable.length===0)return!0;if(T===void 0)return!1;for(var S=!!t.config.enable,b=(x=t.config.enable)!==null&&x!==void 0?x:t.config.disable,j=0,F=void 0;j<b.length;j++){if(F=b[j],typeof F=="function"&&F(T))return S;if(F instanceof Date&&T!==void 0&&F.getTime()===T.getTime())return S;if(typeof F=="string"){var z=t.parseDate(F,void 0,!0);return z&&z.getTime()===T.getTime()?S:!S}else if(typeof F=="object"&&T!==void 0&&F.from&&F.to&&T.getTime()>=F.from.getTime()&&T.getTime()<=F.to.getTime())return S}return!S}function Ge(g){return t.daysContainer!==void 0?g.className.indexOf("hidden")===-1&&g.className.indexOf("flatpickr-disabled")===-1&&t.daysContainer.contains(g):!1}function Ot(g){var m=g.target===t._input,x=t._input.value.trimEnd()!==wt();m&&x&&!(g.relatedTarget&&te(g.relatedTarget))&&t.setDate(t._input.value,!0,g.target===t.altInput?t.config.altFormat:t.config.dateFormat)}function en(g){var m=Ze(g),x=t.config.wrap?s.contains(m):m===t._input,T=t.config.allowInput,S=t.isOpen&&(!T||!x),b=t.config.inline&&x&&!T;if(g.keyCode===13&&x){if(T)return t.setDate(t._input.value,!0,m===t.altInput?t.config.altFormat:t.config.dateFormat),t.close(),m.blur();t.open()}else if(te(m)||S||b){var j=!!t.timeContainer&&t.timeContainer.contains(m);switch(g.keyCode){case 13:j?(g.preventDefault(),l(),Ie()):Be(g);break;case 27:g.preventDefault(),Ie();break;case 8:case 46:x&&!t.config.allowInput&&(g.preventDefault(),t.clear());break;case 37:case 39:if(!j&&!x){g.preventDefault();var F=r();if(t.daysContainer!==void 0&&(T===!1||F&&Ge(F))){var z=g.keyCode===39?1:-1;g.ctrlKey?(g.stopPropagation(),fe(z),W(L(1),0)):W(void 0,z)}}else t.hourElement&&t.hourElement.focus();break;case 38:case 40:g.preventDefault();var D=g.keyCode===40?1:-1;t.daysContainer&&m.$i!==void 0||m===t.input||m===t.altInput?g.ctrlKey?(g.stopPropagation(),Pe(t.currentYear-D),W(L(1),0)):j||W(void 0,D*7):m===t.currentYearElement?Pe(t.currentYear-D):t.config.enableTime&&(!j&&t.hourElement&&t.hourElement.focus(),l(g),t._debouncedChange());break;case 9:if(j){var G=[t.hourElement,t.minuteElement,t.secondElement,t.amPM].concat(t.pluginElements).filter(function(Ve){return Ve}),le=G.indexOf(m);if(le!==-1){var gt=G[le+(g.shiftKey?-1:1)];g.preventDefault(),(gt||t._input).focus()}}else!t.config.noCalendar&&t.daysContainer&&t.daysContainer.contains(m)&&g.shiftKey&&(g.preventDefault(),t._input.focus());break}}if(t.amPM!==void 0&&m===t.amPM)switch(g.key){case t.l10n.amPM[0].charAt(0):case t.l10n.amPM[0].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[0],u(),Fe();break;case t.l10n.amPM[1].charAt(0):case t.l10n.amPM[1].charAt(0).toLowerCase():t.amPM.textContent=t.l10n.amPM[1],u(),Fe();break}(x||te(m))&&ce("onKeyDown",g)}function et(g,m){if(m===void 0&&(m="flatpickr-day"),!(t.selectedDates.length!==1||g&&(!g.classList.contains(m)||g.classList.contains("flatpickr-disabled")))){for(var x=g?g.dateObj.getTime():t.days.firstElementChild.dateObj.getTime(),T=t.parseDate(t.selectedDates[0],void 0,!0).getTime(),S=Math.min(x,t.selectedDates[0].getTime()),b=Math.max(x,t.selectedDates[0].getTime()),j=!1,F=0,z=0,D=S;D<b;D+=nm.DAY)ue(new Date(D),!0)||(j=j||D>S&&D<b,D<T&&(!F||D>F)?F=D:D>T&&(!z||D<z)&&(z=D));var G=Array.from(t.rContainer.querySelectorAll("*:nth-child(-n+"+t.config.showMonths+") > ."+m));G.forEach(function(le){var gt=le.dateObj,Ve=gt.getTime(),ti=F>0&&Ve<F||z>0&&Ve>z;if(ti){le.classList.add("notAllowed"),["inRange","startRange","endRange"].forEach(function(Rn){le.classList.remove(Rn)});return}else if(j&&!ti)return;["startRange","inRange","endRange","notAllowed"].forEach(function(Rn){le.classList.remove(Rn)}),g!==void 0&&(g.classList.add(x<=t.selectedDates[0].getTime()?"startRange":"endRange"),T<x&&Ve===T?le.classList.add("startRange"):T>x&&Ve===T&&le.classList.add("endRange"),Ve>=F&&(z===0||Ve<=z)&&em(Ve,T,x)&&le.classList.add("inRange"))})}}function En(){t.isOpen&&!t.config.static&&!t.config.inline&&Et()}function ct(g,m){if(m===void 0&&(m=t._positionElement),t.isMobile===!0){if(g){g.preventDefault();var x=Ze(g);x&&x.blur()}t.mobileInput!==void 0&&(t.mobileInput.focus(),t.mobileInput.click()),ce("onOpen");return}else if(t._input.disabled||t.config.inline)return;var T=t.isOpen;t.isOpen=!0,T||(t.calendarContainer.classList.add("open"),t._input.classList.add("active"),ce("onOpen"),Et(m)),t.config.enableTime===!0&&t.config.noCalendar===!0&&t.config.allowInput===!1&&(g===void 0||!t.timeContainer.contains(g.relatedTarget))&&setTimeout(function(){return t.hourElement.select()},50)}function kt(g){return function(m){var x=t.config["_"+g+"Date"]=t.parseDate(m,t.config.dateFormat),T=t.config["_"+(g==="min"?"max":"min")+"Date"];x!==void 0&&(t[g==="min"?"minDateHasTime":"maxDateHasTime"]=x.getHours()>0||x.getMinutes()>0||x.getSeconds()>0),t.selectedDates&&(t.selectedDates=t.selectedDates.filter(function(S){return ue(S)}),!t.selectedDates.length&&g==="min"&&d(x),Fe()),t.daysContainer&&(Te(),x!==void 0?t.currentYearElement[g]=x.getFullYear().toString():t.currentYearElement.removeAttribute(g),t.currentYearElement.disabled=!!T&&x!==void 0&&T.getFullYear()===x.getFullYear())}}function ut(){var g=["wrap","weekNumbers","allowInput","allowInvalidPreload","clickOpens","time_24hr","enableTime","noCalendar","altInput","shorthandCurrentMonth","inline","static","enableSeconds","disableMobile"],m=De(De({},JSON.parse(JSON.stringify(s.dataset||{}))),e),x={};t.config.parseDate=m.parseDate,t.config.formatDate=m.formatDate,Object.defineProperty(t.config,"enable",{get:function(){return t.config._enable},set:function(G){t.config._enable=Ct(G)}}),Object.defineProperty(t.config,"disable",{get:function(){return t.config._disable},set:function(G){t.config._disable=Ct(G)}});var T=m.mode==="time";if(!m.dateFormat&&(m.enableTime||T)){var S=me.defaultConfig.dateFormat||kn.dateFormat;x.dateFormat=m.noCalendar||T?"H:i"+(m.enableSeconds?":S":""):S+" H:i"+(m.enableSeconds?":S":"")}if(m.altInput&&(m.enableTime||T)&&!m.altFormat){var b=me.defaultConfig.altFormat||kn.altFormat;x.altFormat=m.noCalendar||T?"h:i"+(m.enableSeconds?":S K":" K"):b+(" h:i"+(m.enableSeconds?":S":"")+" K")}Object.defineProperty(t.config,"minDate",{get:function(){return t.config._minDate},set:kt("min")}),Object.defineProperty(t.config,"maxDate",{get:function(){return t.config._maxDate},set:kt("max")});var j=function(G){return function(le){t.config[G==="min"?"_minTime":"_maxTime"]=t.parseDate(le,"H:i:S")}};Object.defineProperty(t.config,"minTime",{get:function(){return t.config._minTime},set:j("min")}),Object.defineProperty(t.config,"maxTime",{get:function(){return t.config._maxTime},set:j("max")}),m.mode==="time"&&(t.config.noCalendar=!0,t.config.enableTime=!0),Object.assign(t.config,x,m);for(var F=0;F<g.length;F++)t.config[g[F]]=t.config[g[F]]===!0||t.config[g[F]]==="true";Mr.filter(function(G){return t.config[G]!==void 0}).forEach(function(G){t.config[G]=Dr(t.config[G]||[]).map(o)}),t.isMobile=!t.config.disableMobile&&!t.config.inline&&t.config.mode==="single"&&!t.config.disable.length&&!t.config.enable&&!t.config.weekNumbers&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);for(var F=0;F<t.config.plugins.length;F++){var z=t.config.plugins[F](t)||{};for(var D in z)Mr.indexOf(D)>-1?t.config[D]=Dr(z[D]).map(o).concat(t.config[D]):typeof m[D]>"u"&&(t.config[D]=z[D])}m.altInputClass||(t.config.altInputClass=tn().className+" "+t.config.altInputClass),ce("onParseConfig")}function tn(){return t.config.wrap?s.querySelector("[data-input]"):s}function nn(){typeof t.config.locale!="object"&&typeof me.l10ns[t.config.locale]>"u"&&t.config.errorHandler(new Error("flatpickr: invalid locale "+t.config.locale)),t.l10n=De(De({},me.l10ns.default),typeof t.config.locale=="object"?t.config.locale:t.config.locale!=="default"?me.l10ns[t.config.locale]:void 0),ln.D="("+t.l10n.weekdays.shorthand.join("|")+")",ln.l="("+t.l10n.weekdays.longhand.join("|")+")",ln.M="("+t.l10n.months.shorthand.join("|")+")",ln.F="("+t.l10n.months.longhand.join("|")+")",ln.K="("+t.l10n.amPM[0]+"|"+t.l10n.amPM[1]+"|"+t.l10n.amPM[0].toLowerCase()+"|"+t.l10n.amPM[1].toLowerCase()+")";var g=De(De({},e),JSON.parse(JSON.stringify(s.dataset||{})));g.time_24hr===void 0&&me.defaultConfig.time_24hr===void 0&&(t.config.time_24hr=t.l10n.time_24hr),t.formatDate=Lh(t),t.parseDate=ao({config:t.config,l10n:t.l10n})}function Et(g){if(typeof t.config.position=="function")return void t.config.position(t,g);if(t.calendarContainer!==void 0){ce("onPreCalendarPosition");var m=g||t._positionElement,x=Array.prototype.reduce.call(t.calendarContainer.children,function(lc,hc){return lc+hc.offsetHeight},0),T=t.calendarContainer.offsetWidth,S=t.config.position.split(" "),b=S[0],j=S.length>1?S[1]:null,F=m.getBoundingClientRect(),z=window.innerHeight-F.bottom,D=b==="above"||b!=="below"&&z<x&&F.top>x,G=window.pageYOffset+F.top+(D?-x-2:m.offsetHeight+2);if(Oe(t.calendarContainer,"arrowTop",!D),Oe(t.calendarContainer,"arrowBottom",D),!t.config.inline){var le=window.pageXOffset+F.left,gt=!1,Ve=!1;j==="center"?(le-=(T-F.width)/2,gt=!0):j==="right"&&(le-=T-F.width,Ve=!0),Oe(t.calendarContainer,"arrowLeft",!gt&&!Ve),Oe(t.calendarContainer,"arrowCenter",gt),Oe(t.calendarContainer,"arrowRight",Ve);var ti=window.document.body.offsetWidth-(window.pageXOffset+F.right),Rn=le+T>window.document.body.offsetWidth,tc=ti+T>window.document.body.offsetWidth;if(Oe(t.calendarContainer,"rightMost",Rn),!t.config.static)if(t.calendarContainer.style.top=G+"px",!Rn)t.calendarContainer.style.left=le+"px",t.calendarContainer.style.right="auto";else if(!tc)t.calendarContainer.style.left="auto",t.calendarContainer.style.right=ti+"px";else{var ar=Nt();if(ar===void 0)return;var nc=window.document.body.offsetWidth,ic=Math.max(0,nc/2-T/2),sc=".flatpickr-calendar.centerMost:before",rc=".flatpickr-calendar.centerMost:after",oc=ar.cssRules.length,ac="{left:"+F.left+"px;right:auto;}";Oe(t.calendarContainer,"rightMost",!1),Oe(t.calendarContainer,"centerMost",!0),ar.insertRule(sc+","+rc+ac,oc),t.calendarContainer.style.left=ic+"px",t.calendarContainer.style.right="auto"}}}}function Nt(){for(var g=null,m=0;m<document.styleSheets.length;m++){var x=document.styleSheets[m];if(x.cssRules){try{x.cssRules}catch{continue}g=x;break}}return g??ei()}function ei(){var g=document.createElement("style");return document.head.appendChild(g),g.sheet}function Te(){t.config.noCalendar||t.isMobile||(U(),Bt(),$())}function Ie(){t._input.focus(),window.navigator.userAgent.indexOf("MSIE")!==-1||navigator.msMaxTouchPoints!==void 0?setTimeout(t.close,0):t.close()}function Be(g){g.preventDefault(),g.stopPropagation();var m=function(G){return G.classList&&G.classList.contains("flatpickr-day")&&!G.classList.contains("flatpickr-disabled")&&!G.classList.contains("notAllowed")},x=Dh(Ze(g),m);if(x!==void 0){var T=x,S=t.latestSelectedDateObj=new Date(T.dateObj.getTime()),b=(S.getMonth()<t.currentMonth||S.getMonth()>t.currentMonth+t.config.showMonths-1)&&t.config.mode!=="range";if(t.selectedDateElem=T,t.config.mode==="single")t.selectedDates=[S];else if(t.config.mode==="multiple"){var j=sn(S);j?t.selectedDates.splice(parseInt(j),1):t.selectedDates.push(S)}else t.config.mode==="range"&&(t.selectedDates.length===2&&t.clear(!1,!1),t.latestSelectedDateObj=S,t.selectedDates.push(S),Ke(S,t.selectedDates[0],!0)!==0&&t.selectedDates.sort(function(G,le){return G.getTime()-le.getTime()}));if(u(),b){var F=t.currentYear!==S.getFullYear();t.currentYear=S.getFullYear(),t.currentMonth=S.getMonth(),F&&(ce("onYearChange"),U()),ce("onMonthChange")}if(Bt(),$(),Fe(),!b&&t.config.mode!=="range"&&t.config.showMonths===1?A(T):t.selectedDateElem!==void 0&&t.hourElement===void 0&&t.selectedDateElem&&t.selectedDateElem.focus(),t.hourElement!==void 0&&t.hourElement!==void 0&&t.hourElement.focus(),t.config.closeOnSelect){var z=t.config.mode==="single"&&!t.config.enableTime,D=t.config.mode==="range"&&t.selectedDates.length===2&&!t.config.enableTime;(z||D)&&Ie()}y()}}var We={locale:[nn,J],showMonths:[V,a,O],minDate:[w],maxDate:[w],positionElement:[wn],clickOpens:[function(){t.config.clickOpens===!0?(p(t._input,"focus",t.open),p(t._input,"click",t.open)):(t._input.removeEventListener("focus",t.open),t._input.removeEventListener("click",t.open))}]};function Gt(g,m){if(g!==null&&typeof g=="object"){Object.assign(t.config,g);for(var x in g)We[x]!==void 0&&We[x].forEach(function(T){return T()})}else t.config[g]=m,We[g]!==void 0?We[g].forEach(function(T){return T()}):Mr.indexOf(g)>-1&&(t.config[g]=Dr(m));t.redraw(),Fe(!0)}function dt(g,m){var x=[];if(g instanceof Array)x=g.map(function(T){return t.parseDate(T,m)});else if(g instanceof Date||typeof g=="number")x=[t.parseDate(g,m)];else if(typeof g=="string")switch(t.config.mode){case"single":case"time":x=[t.parseDate(g,m)];break;case"multiple":x=g.split(t.config.conjunction).map(function(T){return t.parseDate(T,m)});break;case"range":x=g.split(t.l10n.rangeSeparator).map(function(T){return t.parseDate(T,m)});break}else t.config.errorHandler(new Error("Invalid date supplied: "+JSON.stringify(g)));t.selectedDates=t.config.allowInvalidPreload?x:x.filter(function(T){return T instanceof Date&&ue(T,!1)}),t.config.mode==="range"&&t.selectedDates.sort(function(T,S){return T.getTime()-S.getTime()})}function ft(g,m,x){if(m===void 0&&(m=!1),x===void 0&&(x=t.config.dateFormat),g!==0&&!g||g instanceof Array&&g.length===0)return t.clear(m);dt(g,x),t.latestSelectedDateObj=t.selectedDates[t.selectedDates.length-1],t.redraw(),w(void 0,m),d(),t.selectedDates.length===0&&t.clear(!1),Fe(m),m&&ce("onChange")}function Ct(g){return g.slice().map(function(m){return typeof m=="string"||typeof m=="number"||m instanceof Date?t.parseDate(m,void 0,!0):m&&typeof m=="object"&&m.from&&m.to?{from:t.parseDate(m.from,void 0),to:t.parseDate(m.to,void 0)}:m}).filter(function(m){return m})}function Cn(){t.selectedDates=[],t.now=t.parseDate(t.config.now)||new Date;var g=t.config.defaultDate||((t.input.nodeName==="INPUT"||t.input.nodeName==="TEXTAREA")&&t.input.placeholder&&t.input.value===t.input.placeholder?null:t.input.value);g&&dt(g,t.config.dateFormat),t._initialDate=t.selectedDates.length>0?t.selectedDates[0]:t.config.minDate&&t.config.minDate.getTime()>t.now.getTime()?t.config.minDate:t.config.maxDate&&t.config.maxDate.getTime()<t.now.getTime()?t.config.maxDate:t.now,t.currentYear=t._initialDate.getFullYear(),t.currentMonth=t._initialDate.getMonth(),t.selectedDates.length>0&&(t.latestSelectedDateObj=t.selectedDates[0]),t.config.minTime!==void 0&&(t.config.minTime=t.parseDate(t.config.minTime,"H:i")),t.config.maxTime!==void 0&&(t.config.maxTime=t.parseDate(t.config.maxTime,"H:i")),t.minDateHasTime=!!t.config.minDate&&(t.config.minDate.getHours()>0||t.config.minDate.getMinutes()>0||t.config.minDate.getSeconds()>0),t.maxDateHasTime=!!t.config.maxDate&&(t.config.maxDate.getHours()>0||t.config.maxDate.getMinutes()>0||t.config.maxDate.getSeconds()>0)}function Re(){if(t.input=tn(),!t.input){t.config.errorHandler(new Error("Invalid input element specified"));return}t.input._type=t.input.type,t.input.type="text",t.input.classList.add("flatpickr-input"),t._input=t.input,t.config.altInput&&(t.altInput=se(t.input.nodeName,t.config.altInputClass),t._input=t.altInput,t.altInput.placeholder=t.input.placeholder,t.altInput.disabled=t.input.disabled,t.altInput.required=t.input.required,t.altInput.tabIndex=t.input.tabIndex,t.altInput.type="text",t.input.setAttribute("type","hidden"),!t.config.static&&t.input.parentNode&&t.input.parentNode.insertBefore(t.altInput,t.input.nextSibling)),t.config.allowInput||t._input.setAttribute("readonly","readonly"),wn()}function wn(){t._positionElement=t.config.positionElement||t._input}function rr(){var g=t.config.enableTime?t.config.noCalendar?"time":"datetime-local":"date";t.mobileInput=se("input",t.input.className+" flatpickr-mobile"),t.mobileInput.tabIndex=1,t.mobileInput.type=g,t.mobileInput.disabled=t.input.disabled,t.mobileInput.required=t.input.required,t.mobileInput.placeholder=t.input.placeholder,t.mobileFormatStr=g==="datetime-local"?"Y-m-d\\TH:i:S":g==="date"?"Y-m-d":"H:i:S",t.selectedDates.length>0&&(t.mobileInput.defaultValue=t.mobileInput.value=t.formatDate(t.selectedDates[0],t.mobileFormatStr)),t.config.minDate&&(t.mobileInput.min=t.formatDate(t.config.minDate,"Y-m-d")),t.config.maxDate&&(t.mobileInput.max=t.formatDate(t.config.maxDate,"Y-m-d")),t.input.getAttribute("step")&&(t.mobileInput.step=String(t.input.getAttribute("step"))),t.input.type="hidden",t.altInput!==void 0&&(t.altInput.type="hidden");try{t.input.parentNode&&t.input.parentNode.insertBefore(t.mobileInput,t.input.nextSibling)}catch{}p(t.mobileInput,"change",function(m){t.setDate(Ze(m).value,!1,t.mobileFormatStr),ce("onChange"),ce("onClose")})}function or(g){if(t.isOpen===!0)return t.close();t.open(g)}function ce(g,m){if(t.config!==void 0){var x=t.config[g];if(x!==void 0&&x.length>0)for(var T=0;x[T]&&T<x.length;T++)x[T](t.selectedDates,t.input.value,t,m);g==="onChange"&&(t.input.dispatchEvent(Tn("change")),t.input.dispatchEvent(Tn("input")))}}function Tn(g){var m=document.createEvent("Event");return m.initEvent(g,!0,!0),m}function sn(g){for(var m=0;m<t.selectedDates.length;m++){var x=t.selectedDates[m];if(x instanceof Date&&Ke(x,g)===0)return""+m}return!1}function $i(g){return t.config.mode!=="range"||t.selectedDates.length<2?!1:Ke(g,t.selectedDates[0])>=0&&Ke(g,t.selectedDates[1])<=0}function Bt(){t.config.noCalendar||t.isMobile||!t.monthNav||(t.yearElements.forEach(function(g,m){var x=new Date(t.currentYear,t.currentMonth,1);x.setMonth(t.currentMonth+m),t.config.showMonths>1||t.config.monthSelectorType==="static"?t.monthElements[m].textContent=zs(x.getMonth(),t.config.shorthandCurrentMonth,t.l10n)+" ":t.monthsDropdownContainer.value=x.getMonth().toString(),g.value=x.getFullYear().toString()}),t._hidePrevMonthArrow=t.config.minDate!==void 0&&(t.currentYear===t.config.minDate.getFullYear()?t.currentMonth<=t.config.minDate.getMonth():t.currentYear<t.config.minDate.getFullYear()),t._hideNextMonthArrow=t.config.maxDate!==void 0&&(t.currentYear===t.config.maxDate.getFullYear()?t.currentMonth+1>t.config.maxDate.getMonth():t.currentYear>t.config.maxDate.getFullYear()))}function wt(g){var m=g||(t.config.altInput?t.config.altFormat:t.config.dateFormat);return t.selectedDates.map(function(x){return t.formatDate(x,m)}).filter(function(x,T,S){return t.config.mode!=="range"||t.config.enableTime||S.indexOf(x)===T}).join(t.config.mode!=="range"?t.config.conjunction:t.l10n.rangeSeparator)}function Fe(g){g===void 0&&(g=!0),t.mobileInput!==void 0&&t.mobileFormatStr&&(t.mobileInput.value=t.latestSelectedDateObj!==void 0?t.formatDate(t.latestSelectedDateObj,t.mobileFormatStr):""),t.input.value=wt(t.config.dateFormat),t.altInput!==void 0&&(t.altInput.value=wt(t.config.altFormat)),g!==!1&&ce("onValueUpdate")}function rn(g){var m=Ze(g),x=t.prevMonthNav.contains(m),T=t.nextMonthNav.contains(m);x||T?fe(x?-1:1):t.yearElements.indexOf(m)>=0?m.select():m.classList.contains("arrowUp")?t.changeYear(t.currentYear+1):m.classList.contains("arrowDown")&&t.changeYear(t.currentYear-1)}function qi(g){g.preventDefault();var m=g.type==="keydown",x=Ze(g),T=x;t.amPM!==void 0&&x===t.amPM&&(t.amPM.textContent=t.l10n.amPM[Qe(t.amPM.textContent===t.l10n.amPM[0])]);var S=parseFloat(T.getAttribute("min")),b=parseFloat(T.getAttribute("max")),j=parseFloat(T.getAttribute("step")),F=parseInt(T.value,10),z=g.delta||(m?g.which===38?1:-1:0),D=F+j*z;if(typeof T.value<"u"&&T.value.length===2){var G=T===t.hourElement,le=T===t.minuteElement;D<S?(D=b+D+Qe(!G)+(Qe(G)&&Qe(!t.amPM)),le&&C(void 0,-1,t.hourElement)):D>b&&(D=T===t.hourElement?D-b-Qe(!t.amPM):S,le&&C(void 0,1,t.hourElement)),t.amPM&&G&&(j===1?D+F===23:Math.abs(D-F)>j)&&(t.amPM.textContent=t.l10n.amPM[Qe(t.amPM.textContent===t.l10n.amPM[0])]),T.value=ze(D)}}return i(),t}function Nn(s,e){for(var t=Array.prototype.slice.call(s).filter(function(o){return o instanceof HTMLElement}),n=[],i=0;i<t.length;i++){var r=t[i];try{if(r.getAttribute("data-fp-omit")!==null)continue;r._flatpickr!==void 0&&(r._flatpickr.destroy(),r._flatpickr=void 0),r._flatpickr=sm(r,e||{}),n.push(r._flatpickr)}catch(o){console.error(o)}}return n.length===1?n[0]:n}typeof HTMLElement<"u"&&typeof HTMLCollection<"u"&&typeof NodeList<"u"&&(HTMLCollection.prototype.flatpickr=NodeList.prototype.flatpickr=function(s){return Nn(this,s)},HTMLElement.prototype.flatpickr=function(s){return Nn([this],s)});var me=function(s,e){return typeof s=="string"?Nn(window.document.querySelectorAll(s),e):s instanceof Node?Nn([s],e):Nn(s,e)};me.defaultConfig={};me.l10ns={en:De({},Oi),default:De({},Oi)};me.localize=function(s){me.l10ns.default=De(De({},me.l10ns.default),s)};me.setDefaults=function(s){me.defaultConfig=De(De({},me.defaultConfig),s)};me.parseDate=ao({});me.formatDate=Lh({});me.compareDates=Ke;typeof jQuery<"u"&&typeof jQuery.fn<"u"&&(jQuery.fn.flatpickr=function(s){return Nn(this,s)});Date.prototype.fp_incr=function(s){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+(typeof s=="string"?parseInt(s,10):s))};typeof window<"u"&&(window.flatpickr=me);function sr(s){let n=s/100+3;return n<2&&(n=2),n>7&&(n=7),n}const Ah=function(s){return new uh({stroke:new He({color:"white",width:3}),align:"center",text:s.get("meta_string"),overflow:!0,fill:new qe({color:"black"})})},li=function(s){return new lt({stroke:new He({color:"#000000"}),fill:new qe({color:"rgba(255,255,255,0.3)"}),text:Ah(s)})},ll=function(s){return new lt({fill:new qe({color:"rgba(255, 255, 255, 0.4)"}),stroke:new He({color:"rgba(255, 255, 255, 0.7)",width:4}),text:Ah(s)})},Ph=new lt({fill:new qe({color:"rgba(255, 255, 255, 0)"}),stroke:new He({color:"rgba(255, 255, 255, 0)",width:0})}),rm=new lt({fill:new qe({color:"rgba(255, 255, 255, 0)"}),stroke:new He({color:"rgba(0, 200, 255, .5)",width:3})}),Fh=[[213,255,0],[255,0,86],[0,155,255],[158,0,142],[255,110,65],[0,255,0],[0,174,126],[194,140,159],[190,153,112],[0,143,156],[95,173,78],[255,0,0],[255,0,246],[255,2,157],[104,61,59],[255,116,163],[152,255,82],[150,138,232],[167,87,64],[1,255,254],[254,137,0],[255,229,2],[1,208,255],[187,136,0],[255,166,254],[119,77,0],[181,0,255],[255,177,103],[144,251,146],[126,45,210],[189,211,147],[229,111,254],[0,255,120],[189,198,255],[0,118,255],[133,169,0],[120,130,49],[0,255,198],[232,94,190]],ta=["Anti-Pollution","Beacon, Starboard Hand","Cargo","Dive Vessel","Dredger","Fishing","High Speed Craft","Isolated Danger","Law Enforce","Local Vessel","Manned VTS","Military Ops","Medical Trans","Other","Passenger","Pilot Vessel","Pleasure Craft","Port Hand Mark","Port Tender","Reference Point","Reserved","SAR","SAR Aircraft","Sailing Vessel","Special Craft","Safe Water","Tanker","Tug","Wing In Grnd","Towing"],N={};for(const[s,e]of ta.entries())N[e]=Fh[s];for(const[s,e]of ta.entries())N[e.replace(/\s/g,"")]=Fh[s];N.Unspecified="#EEEEEE";N[""]="#EEEEEE";N["-"]="#EEEEEE";N["Cargo - Hazard A (Major)"]=N.Cargo;N["Cargo - Hazard B"]=N.Cargo;N["Cargo - Hazard C (Minor)"]=N.Cargo;N["Cargo - Hazard D (Recognizable)"]=N.Cargo;N["Cargo-HazardA(Major)"]=N.Cargo;N["Cargo-HazardB"]=N.Cargo;N["Cargo-HazardC(Minor)"]=N.Cargo;N["Cargo-HazardD(Recognizable)"]=N.Cargo;N["Tanker - Hazard A (Major)"]=N.Tanker;N["Tanker - Hazard B"]=N.Tanker;N["Tanker - Hazard C (Minor)"]=N.Tanker;N["Tanker - Hazard D (Recognizable)"]=N.Tanker;N["Tanker-HazardA(Major)"]=N.Tanker;N["Tanker-HazardB"]=N.Tanker;N["Tanker-HazardC(Minor)"]=N.Tanker;N["Tanker-HazardD(Recognizable)"]=N.Tanker;N["Passenger, hazardous category A"]=N.Passenger;N["Passenger, hazardous category B"]=N.Passenger;N["Passenger, hazardous category C"]=N.Passenger;N["Passenger, hazardous category D"]=N.Passenger;N["Wing In Grnd, hazardous category A"]=N["Wing In Grnd"];N["Wing In Grnd, hazardous category B"]=N["Wing In Grnd"];N["Wing In Grnd, hazardous category C"]=N["Wing In Grnd"];N["Wing In Grnd, hazardous category D"]=N["Wing In Grnd"];N["Towing - length >200m or breadth >25m"]=N.Towing;function om(s){return function(e,t){return new lt({fill:new qe({color:N[s]}),stroke:new He({color:N[s],width:sr(t)})})}}const Zn={};for(const s of Object.keys(N))Zn[s]=om(s);const Fr=function(s){return new function(e,t){return new lt({fill:new qe({color:"rgba(255, 255, 255, 0.4)"}),stroke:new He({color:"rgba(255, 255, 255, 0.7)",width:sr(t)})})}},Nm=function(s,e){return new lt({fill:"#EEEEEE",stroke:new He({color:"white",width:sr(e)})})},Hi=document.querySelector("#searchbtn"),Oh=document.querySelector("#clearbtn"),Ys=document.querySelector("#vesseltype-menu"),na=document.querySelector("#vesseltype-select"),ve=document.querySelector("#status-div"),ki=document.querySelector("#time-select-start"),Ni=document.querySelector("#time-select-end");let Gn=!0;async function ia(){Gn=!0}async function am(){for(;Gn===!1;)await new Promise(s=>setTimeout(s,10))}async function hl(s){Hi.textContent="Search",ve.textContent="Cancelled search",window.statusmsg=ve.textContent,document.body.style.cursor="initial",await ia(),await s.send(JSON.stringify({type:"stop"}))}async function lm(s,e,t){t===null&&console.error("async error: db_socket not initialized"),Gn=!1,ve.textContent="Searching...",Hi.textContent="Cancel",window.statusmsg=ve.textContent;let n="track_vectors";window.heatmaptest===!0&&(n="heatmap",console.log("debugging heatmap..."));const i=JSON.stringify({msgtype:n,start:s,end:e,area:window.searcharea});console.log(`Sending database request to: ${t.url}
${i}`),await t.send(i),window.searcharea=null}const lo=me(ki,{onChange:function(s,e,t){ki.value=e},altInput:!0,altFormat:"Z",enableTime:!0,time_24hr:!0,defaultDate:new Date(Date.now()).getTime()-1e3*60*60*24}),ho=me(Ni,{onChange:function(s,e,t){Ni.value=e},altInput:!0,altFormat:"Z",enableTime:!0,time_24hr:!0,defaultDate:new Date(Date.now()).getTime()-1e3*60*5});function kh(s,e){lo.set("minDate",new Date(s-1e3*60*60*24)),ho.set("minDate",new Date(s)),lo.set("maxDate",new Date(e)),ho.set("maxDate",new Date(e))}function hm(s,e){ki.value=s,Ni.value=e}let Gi="All";function pi(s){const e=Dt[s.getId()];if(e===void 0){s.setStyle(Zn.Unknown);return}let t=null;s.getId()in Dt&&"vesseltype_generic"in e?t=e.vesseltype_generic:s.getId()in Dt&&"ship_type_txt"in e?t=e.ship_type_txt:t="Unknown",Gi==="All"||t.includes(Gi)?s.getId()in Dt&&"color"in e?s.setStyle((n,i)=>new lt({fill:new qe({color:e.color}),stroke:new He({color:e.color,width:sr(i)})})):s.setStyle(Zn[t]):s.setStyle(Ph)}function Nh(s){if(Gi==="All")for(const e of s.getFeatures()){const t=Dt[e.getId()];let n="Unknown";t===void 0||("vesseltype_generic"in t?n=t.vesseltype_generic:"ship_type_txt"in t&&(n=t.ship_type_txt)),e.setStyle(Zn[n])}else for(const e of s.getFeatures()){const t=Dt[e.getId()];let n="Unknown";t===void 0||("vesseltype_generic"in t?n=t.vesseltype_generic:"ship_type_txt"in t&&(n=t.ship_type_txt)),n.includes(Gi)?e.setStyle(Zn[n]):e.setStyle(Ph)}}function xs(s,e,t){t===void 0&&(t="●");const n=document.createElement("div"),i=`<div class="colordot" style="color: rgb(${N[s]});">${t}</div>`;n.className="hiddenmenu-item",n.innerHTML=`<div>${s}</div>&ensp;${i}`,n.dataset.value=e,n.addEventListener("click",()=>{Gi=n.dataset.value,Nh(Ki),na.innerHTML=`Vessel Type ${i}`,Ys.classList.toggle("show")}),Ys.append(n)}async function Or(){for(;ge==null;)await new Promise(s=>setTimeout(s,25))}async function cm(){const s=document.querySelector("#selectbtn");s.addEventListener("click",async()=>{await Or(),ge.removeInteraction(gn),ge.removeInteraction(rt),pn.clear(),ge.addInteraction(gn),ge.addInteraction(rt),document.body.style.cursor="crosshair"}),Hi.addEventListener("click",async()=>{let e=new Date(ki.value),t=new Date(Ni.value);await oa();const n=1e3*60*60*24,i=new Date(ho.config.maxDate.getTime()),r=new Date(lo.config.minDate.getTime());e.getTime()<r.getTime()&&(ve.textContent=`Warning: No data before ${r.toISOString()}	 got: ${e.toISOString()}`,console.log(ve.textContent),window.statusmsg=ve.textContent,e=r,ki.value=r.toISOString()),t.getTime()>i.getTime()&&(ve.textContent=`Warning: No data before ${i.toISOString()}	 got: ${t.toISOString()}`,console.log(ve.textContent),window.statusmsg=ve.textContent,t=i,Ni.value=i.toISOString()),Gn===!1?(await Cs(),await hl(Ne)):window.searcharea===null?(ve.textContent="Error: No area selected",window.statusmsg=ve.textContent):e===""||t===""?(ve.textContent="Error: No time selected",window.statusmsg=ve.textContent):e.getTime()>=t.getTime()?(ve.textContent="Error: Start must occur before end",window.statusmsg=ve.textContent):Math.floor((t.getTime()-e.getTime())/n)>31&&(ua===void 0||ua===null)?(ve.textContent="Error: select a time range of one month or less",window.statusmsg=ve.textContent):Gn===!0&&(await Cs(),await lm(Math.round(e.getTime()/1e3),Math.round(t.getTime()/1e3),Ne)),await Or(),ge.removeInteraction(gn),ge.removeInteraction(rt),document.body.style.cursor="initial"}),Oh.addEventListener("click",async()=>{s.textContent="Select Area",await la(),window.statusmsg="",ve.textContent="",Gn===!1&&(await Cs(),await hl(Ne)),await Or(),ge.removeInteraction(gn),ge.removeInteraction(rt),document.body.style.cursor="initial",pn.clear(),Ki.clear()}),xs("All","All","⋀");for(const e of ta)xs(e,e);return xs("Unknown","None","○"),na.addEventListener("click",()=>{Ys.classList.toggle("show")}),zn!==null&&zn!==void 0&&console.log("done select form initialization"),s}const Gm=Object.freeze(Object.defineProperty({__proto__:null,clearbtn:Oh,createVesselMenuItem:xs,initialize_selectform:cm,resetSearchState:ia,searchbtn:Hi,setSearchValue:hm,setValidSearchRange:kh,set_track_style:pi,update_vesseltype_styles:Nh,vesselmenu:Ys,vesseltypeselect:na,waitForSearchState:am},Symbol.toStringTag,{value:"Module"}));let Xe;const Mt=new Array(128).fill(void 0);Mt.push(void 0,null,!0,!1);function Q(s){return Mt[s]}function co(s){const e=typeof s;if(e=="number"||e=="boolean"||s==null)return`${s}`;if(e=="string")return`"${s}"`;if(e=="symbol"){const i=s.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=s.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(s)){const i=s.length;let r="[";i>0&&(r+=co(s[0]));for(let o=1;o<i;o++)r+=", "+co(s[o]);return r+="]",r}const t=/\[object ([^\]]+)\]/.exec(toString.call(s));let n;if(t.length>1)n=t[1];else return toString.call(s);if(n=="Object")try{return"Object("+JSON.stringify(s)+")"}catch{return"Object"}return s instanceof Error?`${s.name}: ${s.message}
${s.stack}`:n}let Us=0,hi=null;function vs(){return(hi===null||hi.byteLength===0)&&(hi=new Uint8Array(Xe.memory.buffer)),hi}const Es=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},um=typeof Es.encodeInto=="function"?function(s,e){return Es.encodeInto(s,e)}:function(s,e){const t=Es.encode(s);return e.set(t),{read:s.length,written:t.length}};function cl(s,e,t){if(t===void 0){const a=Es.encode(s),l=e(a.length,1)>>>0;return vs().subarray(l,l+a.length).set(a),Us=a.length,l}let n=s.length,i=e(n,1)>>>0;const r=vs();let o=0;for(;o<n;o++){const a=s.charCodeAt(o);if(a>127)break;r[i+o]=a}if(o!==n){o!==0&&(s=s.slice(o)),i=t(i,n,n=o+s.length*3,1)>>>0;const a=vs().subarray(i+o,i+n),l=um(s,a);o+=l.written}return Us=o,i}let ci=null;function ri(){return(ci===null||ci.byteLength===0)&&(ci=new Int32Array(Xe.memory.buffer)),ci}const Gh=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Gh.decode();function kr(s,e){return s=s>>>0,Gh.decode(vs().subarray(s,s+e))}let yi=Mt.length;function Ee(s){yi===Mt.length&&Mt.push(Mt.length+1);const e=yi;return yi=Mt[e],Mt[e]=s,e}function dm(s){s<132||(Mt[s]=yi,yi=s)}function uo(s){const e=Q(s);return dm(s),e}function Nr(s){return s==null}let ui=null;function fm(){return(ui===null||ui.byteLength===0)&&(ui=new Float64Array(Xe.memory.buffer)),ui}function Bh(s){const e=Xe.process_response(Ee(s));return uo(e)}function Gr(s,e){try{return s.apply(this,e)}catch(t){Xe.__wbindgen_exn_store(Ee(t))}}async function gm(s,e){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,e)}catch(n){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await s.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(s,e);return t instanceof WebAssembly.Instance?{instance:t,module:s}:t}}function _m(){const s={};return s.wbg={},s.wbg.__wbindgen_debug_string=function(e,t){const n=co(Q(t)),i=cl(n,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),r=Us;ri()[e/4+1]=r,ri()[e/4+0]=i},s.wbg.__wbindgen_error_new=function(e,t){const n=new Error(kr(e,t));return Ee(n)},s.wbg.__wbindgen_is_object=function(e){const t=Q(e);return typeof t=="object"&&t!==null},s.wbg.__wbindgen_string_new=function(e,t){const n=kr(e,t);return Ee(n)},s.wbg.__wbindgen_object_clone_ref=function(e){const t=Q(e);return Ee(t)},s.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=Q(e)[Q(t)];return Ee(n)},s.wbg.__wbindgen_is_undefined=function(e){return Q(e)===void 0},s.wbg.__wbindgen_in=function(e,t){return Q(e)in Q(t)},s.wbg.__wbindgen_object_drop_ref=function(e){uo(e)},s.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Q(e))},s.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Q(e).length},s.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Q(e)[t>>>0];return Ee(n)},s.wbg.__wbindgen_number_get=function(e,t){const n=Q(t),i=typeof n=="number"?n:void 0;fm()[e/8+1]=Nr(i)?0:i,ri()[e/4+0]=!Nr(i)},s.wbg.__wbg_isSafeInteger_bb8e18dd21c97288=function(e){return Number.isSafeInteger(Q(e))},s.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Ee(Symbol.iterator)},s.wbg.__wbg_get_97b561fb56f034b5=function(){return Gr(function(e,t){const n=Reflect.get(Q(e),Q(t));return Ee(n)},arguments)},s.wbg.__wbindgen_is_function=function(e){return typeof Q(e)=="function"},s.wbg.__wbg_call_cb65541d95d71282=function(){return Gr(function(e,t){const n=Q(e).call(Q(t));return Ee(n)},arguments)},s.wbg.__wbg_next_526fc47e980da008=function(e){const t=Q(e).next;return Ee(t)},s.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Gr(function(e){const t=Q(e).next();return Ee(t)},arguments)},s.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Q(e).done},s.wbg.__wbg_value_1695675138684bd5=function(e){const t=Q(e).value;return Ee(t)},s.wbg.__wbg_new_898a68150f225f2e=function(){const e=new Array;return Ee(e)},s.wbg.__wbindgen_number_new=function(e){return Ee(e)},s.wbg.__wbg_set_502d29070ea18557=function(e,t,n){Q(e)[t>>>0]=uo(n)},s.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Q(e).length},s.wbg.__wbindgen_memory=function(){const e=Xe.memory;return Ee(e)},s.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Q(e).buffer;return Ee(t)},s.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Q(e));return Ee(t)},s.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Q(e).set(Q(t),n>>>0)},s.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Q(e)==Q(t)},s.wbg.__wbindgen_boolean_get=function(e){const t=Q(e);return typeof t=="boolean"?t?1:0:2},s.wbg.__wbindgen_string_get=function(e,t){const n=Q(t),i=typeof n=="string"?n:void 0;var r=Nr(i)?0:cl(i,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),o=Us;ri()[e/4+1]=o,ri()[e/4+0]=r},s.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Q(e)instanceof Uint8Array}catch{t=!1}return t},s.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Q(e)instanceof ArrayBuffer}catch{t=!1}return t},s.wbg.__wbindgen_throw=function(e,t){throw new Error(kr(e,t))},s}function mm(s,e){return Xe=s.exports,Wh.__wbindgen_wasm_module=e,ui=null,ci=null,hi=null,Xe}async function Wh(s){if(Xe!==void 0)return Xe;typeof s>"u"&&(s=new URL("/assets/client_bg-7ffe6c6e.wasm",self.location));const e=_m();(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:t,module:n}=await gm(await s,e);return mm(t,n)}window.statusmsg=null;let zh=!1,sa=!1,Yh=!1,Dt={};window.vesselInfo=Dt;let Ne=null,ra=null;console.log("CAUTION: connecting to websocket over unencrypted connection!"),ra=`ws://${Lc}:${Ac}`;const Vi=(s,e)=>Promise.race([s,new Promise((t,n)=>setTimeout(n,e))]);async function oa(){async function s(){for(;zh===!1;)await new Promise(e=>setTimeout(e,50))}await Vi(s(),1e4).catch(e=>{console.error("timed out waiting for timerange from server")})}async function Uh(){async function s(){for(;sa===!1;)await new Promise(e=>setTimeout(e,50))}await Vi(s(),1e4).catch(e=>{console.error("timed out waiting for zones from server")})}async function Cs(){async function s(){for(;Yh===!1;)await new Promise(e=>setTimeout(e,50))}await Vi(s(),1e4).catch(e=>{console.error("timed out waiting for DB socket")})}async function jh(){sa=!1}const pm=new TextEncoder;function Xh(s){return Uint8Array.from(pm.encode(JSON.stringify(s)))}const ym=new TextDecoder;function Hh(s){return JSON.parse(ym.decode(new Uint8Array(s)))}function xm(s){const e=Hh(Bh({rawdata:Xh(s)}));e.type="Polygon",e.coordinates=[e.coordinates],Jh(e,s.meta)}async function vm(s){let e=null,t=null;try{t=await s.data.text()}catch(n){console.error(`could not get event data!
`,n);return}switch(e=JSON.parse(t),"msgtype"in e||console.error("unknown response type:",e),e.msgtype){case"track_vector":{const n=Xh(e),i=Bh({rawdata:n}),r=Hh(i);ec(r,e.meta.mmsi);break}case"vesselinfo":{console.error("vesselinfo is handled by socket in vessel_metadata.ts");break}case"zone":{xm(e);break}case"heatmap":{Qh(e.xy),await Ne.send(JSON.stringify({msgtype:"ack"}));break}case"done":{document.querySelector("#status-div").textContent=e.status,window.statusmsg=e.status,Hi.textContent="Search",await ia();break}case"doneZones":{sa=!0;break}case"doneMetadata":{console.error("vesselinfo is handled by socket in db.js");break}case"validrange":{zh=!0,kh(e.start*1e3,e.end*1e3);break}default:{const n="Unknown response from server";console.log(e),document.querySelector("#status-div").textContent=n,window.statusmsg=n}}}async function Vh(){await Wh(),Ne=new WebSocket(ra),window.onbefureunload=function(){Ne.addEventListener("close",()=>{}),Ne.close()},Ne.addEventListener("close",async s=>{const e="Error: session was terminated. Retrying...";console.log(e),document.querySelector("#status-div").textContent=e,window.statusmsg=e,await new Promise(t=>setTimeout(t,Math.random()*5e3+5e3)),Vh()}),Ne.onerror=async s=>{Ne.close()},Ne.onmessage=vm,Ne.addEventListener("open",async()=>{document.querySelector("#status-div").textContent="",window.statusmsg="",Zi.clear(),await jh(),await Vi(Promise.all([Ne.send(JSON.stringify({msgtype:"validrange"})),Ne.send(JSON.stringify({msgtype:"zones"})),oa(),Uh()]),15e3).catch(()=>console.log("timed out loading data from server!")),Yh=!0}),zn!==null&&zn!==void 0&&console.log("done db socket initialization")}const Bm=Object.freeze(Object.defineProperty({__proto__:null,get db_socket(){return Ne},get db_socket_host(){return ra},initialize_db_socket:Vh,resetLoadingZones:jh,timeout:Vi,vesselInfo:Dt,waitForSocket:Cs,waitForTimerange:oa,waitForZones:Uh},Symbol.toStringTag,{value:"Module"})),Em=[-63.5,44.46],Cm=10;window.searcharea=null;const pn=new Qn({wrapX:!1}),wm=new Xi({source:pn,zIndex:5}),Zi=new Qn({}),aa=new Xi({source:Zi,style:li,zIndex:1}),Ki=new Qn({}),Zh=new Xi({source:Ki,style:Zn.Unspecified,zIndex:3}),Kh=new Qn({}),Tm=new Xi({source:Kh,zIndex:4}),$h=new Qn({}),Rm=new F_({source:$h,blur:33,radius:2.5,zIndex:2}),qh=new mt({center:Cl(Em),zoom:Cm});let ge=null,rt=null,gn=null;async function la(){let s=180,e=-180;for(const t of Zi.getFeatures())if(t.get("selected")===!0){window.searcharea===null&&(window.searcharea={x0:180,x1:-180,y1:90,y0:-90});const n=t.getGeometry().clone().transform("EPSG:3857","EPSG:4326").getCoordinates()[0];for(const i of n)t.get("meta_string").includes("_b")&&i[0]<s?s=i[0]:!t.get("meta_string").includes("_c")&&i[0]<window.searcharea.x0&&(window.searcharea.x0=i[0]),t.get("meta_string").includes("_c")&&i[0]>e?e=i[0]:!t.get("meta_string").includes("_b")&&i[0]>window.searcharea.x1&&(window.searcharea.x1=i[0]),i[1]<window.searcharea.y0&&(window.searcharea.y0=i[1]),i[1]>window.searcharea.y1&&(window.searcharea.y1=i[1])}s!==180&&(window.searcharea.x0=s),e!==-180&&(window.searcharea.x1=e)}const Jh=function(s,e){const n=new vh().readFeature(s,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});n.setId(e.name),n.set("meta",e),n.set("meta_string",e.name),Zi.addFeature(n)},Qh=function(s){s.forEach(async e=>{const t=new Xt({geometry:new $t(Cl(e))});$h.addFeature(t)})},ec=function(s,e){const n=new vh().readFeature(s,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});n.setId(e),pi(n),Ki.addFeature(n)};function Sm(s){return s===Zh||s===aa}function Im(s){return s===aa}async function bm(){let s=null;if(lr!==void 0&&lr!==""&&lr!=="0"){const{CustomBingMaps:l}=await ha(()=>import("./tileserver-1f00d82c.js"),["assets/tileserver-1f00d82c.js","assets/TileImage-d1e95ef2.js","assets/proj-20c50701.js","assets/constants-36dce06f.js","assets/main-17f2d9e3.js","assets/index-f2c4f58e.css"]);s=new rl({source:new l({}),zIndex:0})}else{const{default:l}=await ha(()=>import("./OSM-c0adbc31.js"),["assets/OSM-c0adbc31.js","assets/TileImage-d1e95ef2.js","assets/proj-20c50701.js","assets/main-17f2d9e3.js","assets/index-f2c4f58e.css","assets/constants-36dce06f.js"]);s=new rl({source:new l({url:"https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"})})}ge=new tf({target:"mapDiv",layers:[s,aa,Zh,Rm,Tm,wm],view:qh,interactions:ql({doubleClickZoom:!1})});const e=new Qc({coordinateFormat:function(l){const h=[l[0].toFixed(4),l[1].toFixed(4)];return`${h[0]}, ${h[1]}`},projection:"EPSG:4326"}),t=new af({units:"metric",bar:!0,text:!0,steps:4,minWidth:200,maxWidth:256});ge.getControls().extend([e]),ge.getControls().extend([t]),gn=new Ig({type:"Point"}),rt=new $l({}),rt.on("boxend",()=>{window.geom=rt.getGeometry();const l=new Xt({geometry:rt.getGeometry(),name:"selectionArea"});l.setStyle(rm),pn.addFeature(l),ge.removeInteraction(rt),document.body.style.cursor="initial"}),pn.on("addfeature",async()=>{const l=pn.getFeatures()[0].getGeometry().clone().transform("EPSG:3857","EPSG:4326").getCoordinates()[0],h=Math.min(l[0][0],l[1][0],l[2][0],l[3][0],l[4][0]),c=Math.max(l[0][0],l[1][0],l[2][0],l[3][0],l[4][0]),u=Math.min(l[0][1],l[1][1],l[2][1],l[3][1],l[4][1]),d=Math.max(l[0][1],l[1][1],l[2][1],l[3][1],l[4][1]);window.searcharea={x0:h,x1:c,y0:u,y1:d},ge.removeInteraction(gn),ge.removeInteraction(rt)});const n=document.querySelector("#overlay"),i=document.querySelector("#overlay-content"),r=new sf({element:n});ge.addOverlay(r);let o=null,a=null;ge.on("pointermove",l=>{if(o!==null&&o.get("selected")!==!0?(o.setStyle(Fr),o=null):o!==null&&(o=null),a!==null&&o!==null&&a.getId()!==o.getId()&&(a.set("selected",!1),a.getGeometry().getType()==="LineString"?pi(a):a.setStyle(li(a))),ge.forEachFeatureAtPixel(l.pixel,h=>{o=h;const c=h.getGeometry().getType();return h.get("selected")!==!0&&(c==="Polygon"?h.setStyle(ll(h)):c==="LineString"?h.setStyle(Fr()):console.log(`unexpected feature ${c}`)),(o===null||a!==null&&a.getStyle()===Fr)&&(a.set("selected",!1),a.getGeometry().getType()==="LineString"?pi(a):a.setStyle(li(a))),(a===null||a.getId()!==h.getId())&&(a=h),!0},{layerFilter:Sm}),o!=null){r.setPosition(l.coordinate);const h=Dt[o.getId()];h!==void 0&&"meta_string"in h?i.innerHTML=h.meta_string:isNaN(o.getId())?i.innerHTML=`${o.getId()}<br>`:i.innerHTML=`MMSI: ${o.getId()}<br>`}else r.setPosition(void 0),a!==null&&(a.set("selected",!1),a.getGeometry().getType()==="LineString"?pi(a):a.setStyle(li(a)))}),ge.on("click",async l=>{ge.forEachFeatureAtPixel(l.pixel,async h=>(h.get("selected")!==!0?(h.setStyle(ll(h)),h.set("selected",!0)):(h.setStyle(li(h)),h.set("selected",!1)),window.searcharea=null,await la(),!0),{layerFilter:Im})}),zn!==null&&zn!==void 0&&console.log("done map initialization")}const Wm=Object.freeze(Object.defineProperty({__proto__:null,get dragBox(){return rt},get draw(){return gn},drawSource:pn,init_maplayers:bm,lineSource:Ki,get map(){return ge},mapview:qh,newHeatmapFeatures:Qh,newPolygonFeature:Jh,newTrackFeature:ec,pointSource:Kh,polySource:Zi,setSearchAreaFromSelected:la},Symbol.toStringTag,{value:"Module"}));export{eu as D,Pt as E,Xt as F,W_ as I,mn as L,sl as R,pg as S,K_ as T,pi as a,Nm as b,km as c,wl as d,Du as e,Pm as f,H as g,X as h,Am as i,Fm as j,q as k,Ki as l,Z as m,Gm as n,Bm as o,Wm as p,ra as s,Mi as t,Nh as u,Dt as v,am as w};
